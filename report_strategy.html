<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ë‹¹ì„  ì „ëµ ë³´ê³ ì„œ Â· ElectionAI</title>
<link rel="stylesheet" href="css/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* â”€â”€ ì»¤ë²„ â”€â”€ */
.strat-cover {
  background: linear-gradient(140deg,#0f172a 0%,#1e3a8a 55%,#1d4ed8 100%);
  color: white; border-radius: var(--radius); padding: 48px 44px;
  position: relative; overflow: hidden; margin-bottom: 28px;
}
.strat-cover::before {
  content:'ğŸ†'; font-size:220px; opacity:.04;
  position:absolute; right:-20px; top:-30px; line-height:1;
}
.strat-label {
  display:inline-block; background:rgba(245,158,11,.18);
  border:1px solid rgba(245,158,11,.45); color:#fcd34d;
  padding:4px 14px; border-radius:20px; font-size:12px; font-weight:700;
  margin-bottom:18px; letter-spacing:.5px;
}
.strat-cover h1 { font-size:28px; font-weight:900; line-height:1.3; margin-bottom:8px; }
.strat-cover .subtitle { font-size:14px; opacity:.75; margin-bottom:28px; }
.strat-cover-meta { display:flex; flex-wrap:wrap; gap:28px; }
.strat-cover-meta-item .lbl { font-size:10px; opacity:.55; text-transform:uppercase; letter-spacing:.8px; margin-bottom:3px; }
.strat-cover-meta-item .val { font-size:15px; font-weight:700; }

/* â”€â”€ ì „ëµ ìœ í˜• ë°°ì§€ â”€â”€ */
.strat-type-banner {
  display:flex; align-items:center; gap:16px;
  border-radius:var(--radius); padding:20px 24px; margin-bottom:24px; color:white;
}
.strat-type-icon { font-size:40px; flex-shrink:0; }
.strat-type-title { font-size:20px; font-weight:900; }
.strat-type-desc { font-size:13px; opacity:.85; margin-top:3px; }

/* â”€â”€ ì„¹ì…˜ í—¤ë” â”€â”€ */
.s-header {
  display:flex; align-items:center; gap:10px;
  font-size:16px; font-weight:800; padding:12px 18px;
  border-radius:var(--radius-sm); margin-bottom:16px; color:white;
}
.s-num {
  background:rgba(255,255,255,0.2); width:26px; height:26px;
  border-radius:50%; display:flex; align-items:center; justify-content:center;
  font-size:12px; font-weight:900; flex-shrink:0;
}

/* â”€â”€ í¬ì§€ì…˜ ì§„ë‹¨ ì¹´ë“œ â”€â”€ */
.pos-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:12px; margin-bottom:16px; }
.pos-card {
  background:white; border-radius:var(--radius-sm); padding:16px;
  border:1px solid var(--border); text-align:center;
}
.pos-card .pc-label { font-size:11px; color:var(--text-muted); font-weight:600; margin-bottom:6px; }
.pos-card .pc-val { font-size:30px; font-weight:900; }
.pos-card .pc-sub { font-size:11px; color:var(--text-muted); margin-top:3px; }

/* â”€â”€ ê²©ì°¨ ì›ì¸ ë¶„í•´ â”€â”€ */
.cause-item {
  background:white; border-radius:var(--radius-sm); border:1px solid var(--border);
  padding:14px 18px; margin-bottom:10px;
}
.cause-header { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
.cause-metric { font-size:14px; font-weight:700; }
.cause-gap { font-size:13px; font-weight:800; padding:2px 10px; border-radius:12px; }
.cause-reasons { padding-left:0; list-style:none; display:flex; flex-direction:column; gap:5px; }
.cause-reasons li {
  font-size:12px; color:var(--text-muted); padding:5px 10px;
  background:#f8fafc; border-radius:6px; border-left:3px solid;
  display:flex; gap:7px; align-items:flex-start;
}
.cause-reasons li::before { content:'â†’'; font-weight:700; flex-shrink:0; }
.cause-action {
  margin-top:8px; font-size:12px; font-weight:700; color:#1e40af;
  background:#eff6ff; padding:5px 10px; border-radius:6px;
}

/* â”€â”€ ì‹œë®¬ë ˆì´ì…˜ â”€â”€ */
.sim-row {
  background:white; border:1px solid var(--border); border-radius:var(--radius-sm);
  padding:14px 18px; margin-bottom:10px;
  display:flex; align-items:center; gap:16px; flex-wrap:wrap;
}
.sim-metric { font-size:13px; font-weight:700; width:90px; flex-shrink:0; }
.sim-delta { font-size:13px; font-weight:800; color:#16a34a; width:50px; flex-shrink:0; }
.sim-result { flex:1; }
.sim-result .sim-before { font-size:12px; color:var(--text-muted); }
.sim-result .sim-after { font-size:13px; font-weight:700; }
.sim-prob {
  font-size:12px; font-weight:700; padding:4px 12px; border-radius:20px;
  white-space:nowrap;
}

/* â”€â”€ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ â”€â”€ */
.attack-card {
  background:white; border-radius:var(--radius-sm); border:1px solid var(--border);
  border-left:4px solid #dc2626; padding:14px 18px; margin-bottom:10px;
}
.attack-head { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
.attack-level { font-size:11px; font-weight:700; padding:2px 8px; border-radius:10px; }
.attack-point { font-size:14px; font-weight:700; color:#dc2626; }
.attack-scenario { font-size:13px; color:var(--text-muted); margin-bottom:8px; }
.defense-row { font-size:13px; background:#f0fdf4; border-radius:6px; padding:8px 12px; color:#166534; }
.defense-row strong { font-weight:700; }

/* â”€â”€ 90ì¼ í”Œëœ â”€â”€ */
.plan-phase {
  background:white; border-radius:var(--radius-sm); border:1px solid var(--border);
  overflow:hidden; margin-bottom:12px;
}
.plan-phase-header {
  padding:12px 18px; color:white; font-weight:800; font-size:14px;
  display:flex; align-items:center; gap:10px;
}
.plan-phase-body { padding:14px 18px; }
.plan-task { font-size:13px; padding:5px 0; border-bottom:1px solid #f1f5f9; display:flex; gap:8px; }
.plan-task:last-child { border-bottom:none; }
.plan-task::before { content:'âœ“'; color:#16a34a; font-weight:700; flex-shrink:0; }

/* â”€â”€ ê°•ì  ìœ ì§€ ì§€ìˆ˜ / ì•½ì  ë¦¬ìŠ¤í¬ â”€â”€ */
.index-bars { display:flex; flex-direction:column; gap:8px; }
.index-bar-row { display:flex; align-items:center; gap:10px; }
.index-bar-label { width:80px; font-size:12px; font-weight:600; flex-shrink:0; }
.index-bar-track { flex:1; height:10px; background:#f1f5f9; border-radius:5px; overflow:hidden; }
.index-bar-fill { height:100%; border-radius:5px; transition:width .4s; }
.index-bar-val { width:36px; text-align:right; font-size:12px; font-weight:700; }

/* â”€â”€ ì¸ì‡„ â”€â”€ */
@page {
  size: A4;
  margin: 14mm 14mm 22mm 14mm;
  @bottom-right {
    content: counter(page) " / " counter(pages);
    font-size: 9pt; color: #94a3b8;
    font-family: 'Noto Sans KR', sans-serif;
  }
}
@media print {
  * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
  .no-print { display:none !important; }
  body { background:white !important; }
  .page-container { padding: 0; }
  .strat-cover { border-radius:0; margin:0 0 20px; }
  .report-section { page-break-before: always; }
  .report-section:first-child { page-break-before: auto; }
}
</style>
</head>
<body>
<header class="app-header no-print">
  <div class="header-inner">
    <div class="header-logo">âš–ï¸ Election<span>AI</span></div>
    <div class="header-subtitle">AI ê¸°ë°˜ ì„ ê±° í›„ë³´ì ë¹„êµ ë¶„ì„ í”Œë«í¼</div>
    <div class="header-date" id="header-date"></div>
  </div>
</header>
<nav class="main-nav no-print"><div class="nav-inner" id="main-nav"></div></nav>

<div class="page-container">
  <!-- ìƒë‹¨ ì•¡ì…˜ ë°” -->
  <div class="no-print" style="display:flex;align-items:center;gap:12px;margin-bottom:20px;flex-wrap:wrap">
    <a href="index.html" style="font-size:13px;color:var(--text-muted);text-decoration:none">â† í›„ë³´ ì¬ì„ íƒ</a>
    <div style="flex:1;font-size:14px;color:var(--text-muted)" id="targetLabel"></div>
    <button onclick="printStrategy()"
      style="background:#f59e0b;color:#1c1917;border:none;padding:10px 22px;border-radius:8px;font-family:inherit;font-size:14px;font-weight:800;cursor:pointer">
      ğŸ“¥ PDF ì €ì¥
    </button>
  </div>

  <div id="page-content"></div>
</div>

<script src="js/shared.js"></script>
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë©”íŠ¸ë¦­ ì›ì¸ ë°ì´í„°ë² ì´ìŠ¤
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const GAP_CAUSES = {
  ê³µìµì„±: {
    reasons: ['ì§€ì—­ ê³µìµ ì •ì±…ì˜ ëŒ€ì¤‘ ê°€ì‹œì„± ë¶€ì¡±','ì£¼ë¯¼ ì²´ê° ì„±ê³¼ í™ë³´ ë° ìŠ¤í† ë¦¬í…”ë§ ë¯¸í¡','ì†Œì™¸ ê³„ì¸µ ì§€ì› ì´ë ¥ ìˆ˜ì¹˜í™”Â·ê³µê°œ ë¶€ì¡±'],
    action: 'ê³µìµ ì„±ê³¼ ë°ì´í„°ë¥¼ ìŠ¤í† ë¦¬ í˜•ì‹ìœ¼ë¡œ SNSÂ·ì–¸ë¡ ì— ë°°í¬'
  },
  ì •ì±…ì‹¤í–‰ë ¥: {
    reasons: ['ê³µì•½ ì´í–‰ ì‹¤ì ì˜ êµ¬ì²´ì  ìˆ˜ì¹˜ ì œì‹œ ë¶€ì¡±','ì™„ë£Œëœ ì •ì±… ì„±ê³¼ë¥¼ ì‹œê°í™”í•œ ë°±ì„œ ë¯¸ë°œê°„','íƒ€ í›„ë³´ ëŒ€ë¹„ ì™„ë£Œìœ¨Â·ì†ë„ ë¹„êµ ìë£Œ ë¶€ì¬'],
    action: 'ê³µì•½ ì´í–‰ë¥  100ì¼ ë¦¬í¬íŠ¸ ë°œí–‰, ì™„ë£Œ ì‚¬ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸ ê³µê°œ'
  },
  ì „ë¬¸ì„±: {
    reasons: ['í•µì‹¬ ì •ì±… ë¶„ì•¼ ì „ë¬¸ ìê²©Â·ì´ë ¥ ê°•ì¡° ë¶€ì¡±','ì™¸ë¶€ ì „ë¬¸ê¸°ê´€ ê²€ì¦Â·ì¸ì¦ ì´ë ¥ ë¯¸ê³µê°œ','ì •ì±… ì—°êµ¬ ë°œí‘œÂ·ë…¼ë¬¸Â·ê¸°ê³  í™œë™ ë¶€ì¬'],
    action: 'ì „ë¬¸ì„± ì¦ë¹™ ìë£Œ ì§‘ì¤‘ ë°œí‘œ, ì „ë¬¸ê°€ ê·¸ë£¹ ê³µë™ ì •ì±… ë°œí‘œ'
  },
  ëŒ€ì‘ì„±: {
    reasons: ['ë¯¼ì›Â·ì´ìŠˆ ë°œìƒ ì‹œ ê³µì‹ ëŒ€ì‘ ì†ë„ ì§€ì—°','SNS ì‹¤ì‹œê°„ ì†Œí†µ ì±„ë„ í™œìš© ë¯¸í¡','í˜„ì¥ ë°©ë¬¸Â·ì¦‰ë‹µ ê¸°íšŒ ë¶€ì¡±'],
    action: '48ì‹œê°„ ë¯¼ì› ê³µì‹ ì‘ë‹µ ì²´ê³„ êµ¬ì¶•, ì£¼ê°„ í˜„ì¥ ë¼ì´ë¸Œ ì§„í–‰'
  },
  ì±…ì„ì„±: {
    reasons: ['ê³µì•½ ì´í–‰ í˜„í™© ì •ê¸° ê³µê°œ ë¶€ì¬','ì˜ˆì‚° ì§‘í–‰ ë‚´ì—­ íˆ¬ëª…ì„± ê³µê°œ ë¯¸í¡','ê³¼ê±° ì•½ì† ë¯¸ì´í–‰ ê±´ì— ëŒ€í•œ í•´ëª… ê³µê°œ ë¶€ì¬'],
    action: 'ê³µì•½ ì´í–‰ ëŒ€ì‹œë³´ë“œ ê³µê°œ, ë¶„ê¸°ë³„ ì±…ì„ ì´í–‰ ë³´ê³ ì„œ ë°œê°„'
  },
  ì†Œí†µëŠ¥ë ¥: {
    reasons: ['ìœ ê¶Œìì™€ì˜ ì§ì ‘ ì†Œí†µ í–‰ì‚¬(ê°„ë‹´íšŒÂ·íƒ€ìš´í™€) ë¹ˆë„ ë¶€ì¡±','SNS ëŒ“ê¸€Â·DM ì‘ë‹µë¥  ë‚®ìŒ','ì–¸ì–´Â·ë©”ì‹œì§€ ì¹œê·¼ì„± ê°œì„  í•„ìš”'],
    action: 'ì›” 2íšŒ ì§€ì—­êµ¬ íƒ€ìš´í™€ ê°œìµœ, SNS ì‘ë‹µë¥  ëª©í‘œì¹˜ ì„¤ì •'
  },
  ë¦¬ë”ì‹­: {
    reasons: ['ê²°ë‹¨ë ¥ ìˆëŠ” ì£¼ë„ ì‚¬ë¡€ ë¯¸ë¶€ê°','ìœ„ê¸° ìƒí™© ì„ ë„ ê²½í—˜ ìŠ¤í† ë¦¬í™” ë¶€ì¡±','ë¹„ì „ ì„ ì–¸ ë°œì–¸ì˜ ì–¸ë¡  ë…¸ì¶œ ë¹ˆë„ ë¶€ì¡±'],
    action: 'ë¦¬ë”ì‹­ ì‚¬ë¡€ ì¸í„°ë·° ê¸°ì‚¬ ë°°í¬, ë¹„ì „ ì„ ì–¸ í¼í¬ë¨¼ìŠ¤ ê¸°íš'
  },
  ë¹„ì „ëª…í™•ì„±: {
    reasons: ['ì¥ê¸° ë¹„ì „ ë©”ì‹œì§€ ëª¨í˜¸Â·ì¶”ìƒì ','êµ¬ì²´ì  ìˆ˜ì¹˜ ëª©í‘œ(5ë…„ í›„ ì§€ì—­ ë³€í™”) ë¯¸ì œì‹œ','ê²½ìŸ í›„ë³´ ëŒ€ë¹„ ë¹„ì „ ì°¨ë³„ì„± ì•½í•¨'],
    action: '"â—‹â—‹ë…„ê¹Œì§€ â—‹â—‹ë¥¼ â—‹â—‹% ë‹¬ì„±" ìˆ˜ì¹˜í˜• ë¹„ì „ ì„ ì–¸ ë°œí‘œ'
  },
  ì²­ë ´ì„±: {
    reasons: ['ì¬ì •Â·ì´í•´ê´€ê³„ íˆ¬ëª…ì„± ê³µê°œ ìë£Œ ë¶€ì¡±','ê¸°ë¶€Â·ë´‰ì‚¬ í™œë™ ì´ë ¥ í™ë³´ ë¯¸í¡','ì™¸ë¶€ ê°ì‚¬Â·í‰ê°€ ê²°ê³¼ ê³µê°œ ë¶€ì¬'],
    action: 'ì¬ì‚° ë‚´ì—­Â·ì´í•´ì¶©ëŒ ë°©ì§€ ì„œì•½ì„œ ê³µê°œ, ì²­ë ´ ì„œì•½ì‹ ë¯¸ë””ì–´ í™ë³´'
  },
  ìœ¤ë¦¬ì„±: {
    reasons: ['ì´í•´ì¶©ëŒ ì˜ˆë°© ì´ë ¥ ë° ìê¸°ê·œìœ¨ ê³µê°œ ë¶€ì¬','ê³¼ê±° ë…¼ë€ ì´ìŠˆì— ëŒ€í•œ ëª…í™•í•œ í•´ëª… ë¯¸í¡','ìœ¤ë¦¬ìœ„ì›íšŒ ê²€í† Â·ì¤€ìˆ˜ ì‹¤ì  ê³µê°œ ë¶€ì¡±'],
    action: 'í–‰ë™ê°•ë ¹ ê³µê°œ ì„œì•½, ìœ¤ë¦¬ ìë¬¸ë‹¨ êµ¬ì„± ë° ìš´ì˜ ê²°ê³¼ ê³µê°œ'
  }
};

const STRATEGY_TYPE = {
  1: {
    color: '#16a34a', bg: 'linear-gradient(135deg,#14532d,#16a34a)',
    icon: 'ğŸ›¡ï¸', title: '1ìœ„ ìœ ì§€ ë°©ì–´ ì „ëµ ë³´ê³ ì„œ',
    desc: 'í˜„ì¬ ì„ ë‘ ìœ„ì¹˜ë¥¼ ë°©ì–´í•˜ê³  ë¦¬ìŠ¤í¬ë¥¼ ì‚¬ì „ ì°¨ë‹¨í•©ë‹ˆë‹¤.',
    goal: 'ë¦¬ë“œ ìœ ì§€ + ì•½ì  ë…¸ì¶œ ì°¨ë‹¨ + ì§€ì§€ì¸µ ê³ ì •'
  },
  2: {
    color: '#d97706', bg: 'linear-gradient(135deg,#78350f,#d97706)',
    icon: 'âš¡', title: 'ì—­ì „ ì¶”ê²© ì „ëµ ë³´ê³ ì„œ',
    desc: '1ìœ„ì™€ì˜ ê²©ì°¨ë¥¼ ë¶„ì„í•˜ê³  ì—­ì „ ê°€ëŠ¥í•œ ì§€í‘œë¥¼ ê³µëµí•©ë‹ˆë‹¤.',
    goal: 'í•µì‹¬ ì§€í‘œ ì—­ì „ + ê²©ì°¨ ì¶•ì†Œ + ìŠ¹ë¶€ì²˜ ì§‘ì¤‘ ê³µëµ'
  },
  3: {
    color: '#7c3aed', bg: 'linear-gradient(135deg,#3b0764,#7c3aed)',
    icon: 'ğŸš€', title: 'í¬ì§€ì…˜ ë¦¬ë¹Œë”© ì „ëµ ë³´ê³ ì„œ',
    desc: 'ì°¨ë³„í™” í¬ì¸íŠ¸ë¥¼ ë°œêµ´í•˜ê³  ë‹¨ê¸° ë„ì•½ êµ¬ì¡°ë¥¼ ì„¤ê³„í•©ë‹ˆë‹¤.',
    goal: 'ì¸ì§€ë„ ì í”„ + ë©”ì‹œì§€ ì¬í¬ì§€ì…”ë‹ + íƒ€ê²Ÿ ìœ ê¶Œì ì§‘ì¤‘'
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë©”ì¸ ë Œë”ë§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', () => {
  const data = requireData();
  if (!data) return;

  const { candidates, district, analysis_date } = data;
  const targetIdx = getTargetIdx();

  // targetIdx ê²€ì¦
  if (targetIdx === null || targetIdx >= candidates.length) {
    document.getElementById('page-content').innerHTML = `
      <div class="no-data" style="text-align:center;padding:60px 20px">
        <div style="font-size:48px;margin-bottom:16px">âš ï¸</div>
        <h3>ëŒ€ìƒ í›„ë³´ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</h3>
        <p style="color:var(--text-muted);margin-bottom:20px">í™ˆ í˜ì´ì§€ì—ì„œ ì „ëµ ë³´ê³ ì„œ ëŒ€ìƒ í›„ë³´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
        <a href="index.html" class="btn btn-primary">ğŸ  í™ˆìœ¼ë¡œ ì´ë™</a>
      </div>`;
    return;
  }

  const target = candidates[targetIdx];
  const col = CANDIDATE_COLORS[targetIdx % 5];

  // ìˆœìœ„ ê³„ì‚°
  const sorted = [...candidates]
    .map((c,i) => ({...c, origIdx: i}))
    .sort((a,b) => b.total_score - a.total_score);
  const rank = sorted.findIndex(c => c.origIdx === targetIdx) + 1;
  const leader = sorted[0];
  const stratKey = rank === 1 ? 1 : rank === 2 ? 2 : 3;
  const strat = STRATEGY_TYPE[stratKey];

  document.getElementById('targetLabel').textContent =
    `${target.name} Â· ${target.party} Â· ì¢…í•© ${rank}ìœ„`;

  const html =
    buildCover(target, col, rank, strat, district, analysis_date) +
    buildSection1_Position(target, col, rank, sorted, candidates) +
    buildSection2_Strategy(target, col, rank, strat, sorted, candidates) +
    buildSection3_Causes(target, col, rank, leader, candidates) +
    buildSection4_Simulation(target, col, rank, sorted, candidates) +
    buildSection5_Attack(target, col, candidates) +
    buildSection6_Plan(target, col, rank, strat);

  document.getElementById('page-content').innerHTML = html;

  // ë ˆì´ë” ì°¨íŠ¸ ë Œë”ë§
  renderRadar(target, col, candidates);
});

/* â”€â”€ í‘œì§€ â”€â”€ */
function buildCover(target, col, rank, strat, district, analysis_date) {
  const rankLabel = ['','1ìœ„','2ìœ„','3ìœ„','4ìœ„','5ìœ„'][rank];
  return `
  <div class="strat-cover">
    <div class="strat-label">AI ì„ ê±° ì „ëµ ì¸í…”ë¦¬ì „ìŠ¤ ë¦¬í¬íŠ¸ Â· ${strat.title}</div>
    <h1>${target.name} í›„ë³´<br>ë‹¹ì„  ì „ëµ ì„¤ê³„ ë³´ê³ ì„œ</h1>
    <div class="subtitle">ê°ê´€ì  ë°ì´í„° ê¸°ë°˜ ë¶„ì„ Â· ì „ëµì  ì„ íƒì§€ ì œì‹œ Â· ì˜ì‚¬ê²°ì • ì§€ì›</div>
    <div class="strat-cover-meta">
      <div class="strat-cover-meta-item">
        <div class="lbl">ëŒ€ìƒ í›„ë³´</div>
        <div class="val">${target.name} Â· ${target.party}</div>
      </div>
      <div class="strat-cover-meta-item">
        <div class="lbl">í˜„ì¬ ìˆœìœ„</div>
        <div class="val">${rankLabel} (${target.total_score}ì )</div>
      </div>
      <div class="strat-cover-meta-item">
        <div class="lbl">ì„ ê±°êµ¬</div>
        <div class="val">${district || 'â€”'}</div>
      </div>
      <div class="strat-cover-meta-item">
        <div class="lbl">ë¶„ì„ ì¼ì</div>
        <div class="val">${analysis_date || new Date().toISOString().split('T')[0]}</div>
      </div>
    </div>
  </div>`;
}

/* â”€â”€ Section 1: í¬ì§€ì…˜ ì§„ë‹¨ â”€â”€ */
function buildSection1_Position(target, col, rank, sorted, candidates) {
  const n = candidates.length;
  const leader = sorted[0];
  const gapToLeader = target.total_score - leader.total_score;

  // ê°•ì  ìœ ì§€ ì§€ìˆ˜: ìƒìœ„ 3 ë©”íŠ¸ë¦­ í‰ê·  / ì „ì²´ í‰ê· 
  const metScores = METRICS.map(m => target.metrics?.[m] ?? 0);
  const avgAll = metScores.reduce((a,b)=>a+b,0) / metScores.length;
  const top3 = [...metScores].sort((a,b)=>b-a).slice(0,3);
  const bot3 = [...metScores].sort((a,b)=>a-b).slice(0,3);
  const strengthIdx = Math.round((top3.reduce((a,b)=>a+b,0)/3 - avgAll + 30) / 60 * 100);
  const riskIdx = Math.round((avgAll - bot3.reduce((a,b)=>a+b,0)/3) / avgAll * 100);

  // ìƒëŒ€ ìœ„ì¹˜: ê° ë©”íŠ¸ë¦­ì—ì„œ ëª‡ ìœ„ì¸ì§€
  const metricRanks = METRICS.map(m => {
    const sc = target.metrics?.[m] ?? 0;
    const others = candidates.map(c => c.metrics?.[m] ?? 0);
    return others.filter(s => s > sc).length + 1;
  });
  const avg1stCount = metricRanks.filter(r => r === 1).length;

  const rankLabel = ['','1ìœ„','2ìœ„','3ìœ„','4ìœ„','5ìœ„'][rank];

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#1e3a8a,#1d4ed8)">
      <div class="s-num">1</div>ğŸ“ í¬ì§€ì…˜ ì§„ë‹¨
    </div>

    <!-- í•µì‹¬ ì§€í‘œ ì¹´ë“œ -->
    <div class="pos-grid">
      <div class="pos-card">
        <div class="pc-label">ì¢…í•© ìˆœìœ„</div>
        <div class="pc-val" style="color:${col.border}">${rankLabel}</div>
        <div class="pc-sub">${n}ëª… ì¤‘</div>
      </div>
      <div class="pos-card">
        <div class="pc-label">ì¢…í•© ì ìˆ˜</div>
        <div class="pc-val" style="color:${col.border}">${target.total_score}</div>
        <div class="pc-sub">/ 1000ì </div>
      </div>
      <div class="pos-card">
        <div class="pc-label">1ìœ„ ëŒ€ë¹„ ê²©ì°¨</div>
        <div class="pc-val" style="color:${gapToLeader===0?'#16a34a':'#dc2626'}">
          ${gapToLeader === 0 ? '0' : gapToLeader}
        </div>
        <div class="pc-sub">ì  ${gapToLeader===0?'(ì„ ë‘)':'ì°¨ì´'}</div>
      </div>
      <div class="pos-card">
        <div class="pc-label">í•­ëª© 1ìœ„ ìˆ˜</div>
        <div class="pc-val" style="color:${col.border}">${avg1stCount}</div>
        <div class="pc-sub">/ 10ê°œ í•­ëª©</div>
      </div>
      <div class="pos-card">
        <div class="pc-label">ê°•ì  ìœ ì§€ ì§€ìˆ˜</div>
        <div class="pc-val" style="color:${strengthIdx>=70?'#16a34a':strengthIdx>=50?'#d97706':'#dc2626'}">${strengthIdx}</div>
        <div class="pc-sub">/ 100ì </div>
      </div>
      <div class="pos-card">
        <div class="pc-label">ì•½ì  ë¦¬ìŠ¤í¬ ì§€ìˆ˜</div>
        <div class="pc-val" style="color:${riskIdx>=40?'#dc2626':riskIdx>=25?'#d97706':'#16a34a'}">${riskIdx}</div>
        <div class="pc-sub">/ 100ì  (ë‚®ì„ìˆ˜ë¡ ì•ˆì „)</div>
      </div>
    </div>

    <div class="two-col" style="display:grid;grid-template-columns:1fr 1fr;gap:18px">
      <!-- ë ˆì´ë” ì°¨íŠ¸ -->
      <div class="card" style="padding:18px">
        <div class="card-title" style="font-size:13px">ğŸ•¸ï¸ 10ê°œ í•­ëª© ìƒëŒ€ ìœ„ì¹˜</div>
        <div style="height:260px"><canvas id="stratRadar"></canvas></div>
      </div>

      <!-- í•­ëª©ë³„ ê°•ì /ë¦¬ìŠ¤í¬ ë°” -->
      <div class="card" style="padding:18px">
        <div class="card-title" style="font-size:13px">ğŸ“Š ê°•ì Â·ë¦¬ìŠ¤í¬ ë¶„í¬</div>
        <div class="index-bars">
          ${METRICS.map((m,i) => {
            const s = target.metrics?.[m] ?? 0;
            const isTop = metricRanks[i] === 1;
            const isBot = metricRanks[i] === n;
            const fillColor = isTop ? '#16a34a' : isBot ? '#dc2626' : col.border;
            return `<div class="index-bar-row">
              <div class="index-bar-label" style="color:${fillColor};font-size:11px">${METRIC_LABELS[m]}</div>
              <div class="index-bar-track">
                <div class="index-bar-fill" style="width:${s}%;background:${fillColor}"></div>
              </div>
              <div class="index-bar-val" style="color:${fillColor}">${s}</div>
            </div>`;
          }).join('')}
        </div>
      </div>
    </div>

    <!-- ìƒëŒ€ í›„ë³´ ëŒ€ë¹„ í…Œì´ë¸” -->
    <div class="card">
      <div class="card-title">ğŸ“‹ í›„ë³´ì ê°„ ì¢…í•© ìˆœìœ„ í˜„í™©</div>
      <div class="table-wrap"><table>
        <thead><tr><th>ìˆœìœ„</th><th>í›„ë³´ì</th><th>ì •ë‹¹</th><th>ì¢…í•© ì ìˆ˜</th><th>${target.name} ëŒ€ë¹„</th><th>ê²©ì°¨</th></tr></thead>
        <tbody>
          ${sorted.map((c, r) => {
            const isTarget = c.origIdx === sorted.find(x=>x.origIdx===candidates.indexOf(target))?.origIdx
              || candidates[c.origIdx] === target;
            const gap = c.total_score - target.total_score;
            const cCol = CANDIDATE_COLORS[c.origIdx % 5];
            return `<tr style="${candidates[c.origIdx]===target?`background:${col.light}`:``}">
              <td>${rankTag(r+1)}</td>
              <td style="font-weight:700;color:${cCol.border}">${c.name}${candidates[c.origIdx]===target?' â˜…':''}</td>
              <td style="font-size:12px;color:var(--text-muted)">${c.party}</td>
              <td style="font-weight:800">${c.total_score}ì </td>
              <td style="font-weight:700;color:${gap===0?'var(--text-muted)':gap>0?'#dc2626':'#16a34a'}">
                ${gap===0?'â€” ë³¸ì¸':gap>0?`+${gap}ì  ìš°ìœ„`:`${gap}ì  ì—´ì„¸`}
              </td>
              <td style="font-size:12px;color:var(--text-muted)">${r+1}ìœ„</td>
            </tr>`;
          }).join('')}
        </tbody>
      </table></div>
    </div>
  </div>`;
}

/* â”€â”€ Section 2: ì „ëµ ìœ í˜• ë¶„ê¸° â”€â”€ */
function buildSection2_Strategy(target, col, rank, strat, sorted, candidates) {
  const leader = sorted[0];
  let stratContent = '';

  if (rank === 1) {
    // 1ìœ„: ë°©ì–´ ì „ëµ
    const metScores = METRICS.map(m => ({ m, s: target.metrics?.[m]??0 })).sort((a,b)=>a.s-b.s);
    const vulnerable = metScores.slice(0,3);
    const challenger = sorted[1];

    stratContent = `
    <div class="card">
      <div class="card-title">ğŸ›¡ï¸ 1ìœ„ ë°©ì–´ í•µì‹¬ ì „ëµ</div>
      <div class="insight-box" style="background:#f0fdf4;border-color:#86efac;color:#14532d;margin-bottom:14px">
        <strong>${target.name}</strong>ì€(ëŠ”) í˜„ì¬ ì„ ë‘ì…ë‹ˆë‹¤. ëª©í‘œëŠ” <strong>ë¦¬ë“œ ìœ ì§€ + ì•½ì  ë…¸ì¶œ ì°¨ë‹¨ + ì§€ì§€ì¸µ ê³ ì •</strong>ì…ë‹ˆë‹¤.
        2ìœ„ ${challenger?.name}(${challenger?.total_score}ì )ê³¼ì˜ ê²©ì°¨ëŠ” <strong>${target.total_score - (challenger?.total_score||0)}ì </strong>ì…ë‹ˆë‹¤.
      </div>
      <div class="table-wrap"><table>
        <thead><tr><th>ì „ëµ ì˜ì—­</th><th>ì„¸ë¶€ ë‚´ìš©</th><th>ìš°ì„ ìˆœìœ„</th></tr></thead>
        <tbody>
          <tr><td><strong>ì•½ì  ì°¨ë‹¨</strong></td><td>${vulnerable.map(x=>METRIC_LABELS[x.m]).join(', ')} ì ìˆ˜ ë°©ì–´ ì§‘ì¤‘</td><td><span style="color:#dc2626;font-weight:700">ğŸ”´ ì¦‰ì‹œ</span></td></tr>
          <tr><td><strong>ê³µê²© ì˜ˆì¸¡</strong></td><td>2ìœ„ ${challenger?.name} ì¸¡ ì˜ˆìƒ ê³µê²© í¬ì¸íŠ¸ ì‚¬ì „ ëŒ€ì‘</td><td><span style="color:#dc2626;font-weight:700">ğŸ”´ ì¦‰ì‹œ</span></td></tr>
          <tr><td><strong>ì§€ì§€ì¸µ ê³ ì •</strong></td><td>í•µì‹¬ ì§€ì§€ì¸µ ëŒ€ìƒ ê°ì‚¬ ì†Œí†µ, ê²°ì§‘ ì´ë²¤íŠ¸</td><td><span style="color:#d97706;font-weight:700">ğŸŸ¡ 2ì£¼ ë‚´</span></td></tr>
          <tr><td><strong>ì¤‘ë„ì¸µ ê´€ë¦¬</strong></td><td>í˜„ì•ˆ ì´ìŠˆ ì¤‘ë„ì  ì…ì¥ ëª…í™•í™”</td><td><span style="color:#d97706;font-weight:700">ğŸŸ¡ 2ì£¼ ë‚´</span></td></tr>
          <tr><td><strong>ì‹¤ìˆ˜ ìµœì†Œí™”</strong></td><td>ë°œì–¸Â·SNS ì‚¬ì „ ê²€í†  ì²´ê³„ ê°•í™”</td><td><span style="color:#16a34a;font-weight:700">ğŸŸ¢ ì§€ì†</span></td></tr>
        </tbody>
      </table></div>
    </div>
    <div class="card">
      <div class="card-title">âš ï¸ ë…¸ì¶œ ì·¨ì•½ ì§€í‘œ (ë°©ì–´ ìš°ì„ ìˆœìœ„)</div>
      ${vulnerable.map(x => `
        <div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid #f1f5f9">
          <span style="width:90px;font-weight:700;font-size:13px">${METRIC_LABELS[x.m]}</span>
          <div style="flex:1;height:8px;background:#f1f5f9;border-radius:4px;overflow:hidden">
            <div style="width:${x.s}%;height:100%;background:#dc2626;border-radius:4px"></div>
          </div>
          <span style="color:#dc2626;font-weight:700">${x.s}ì  â€” ë°©ì–´ í•„ìš”</span>
        </div>`).join('')}
    </div>`;

  } else if (rank === 2) {
    // 2ìœ„: ì—­ì „ ì „ëµ
    const gapToLeader = leader.total_score - target.total_score;
    const overturnTargets = METRICS.map(m => ({
      m,
      myScore: target.metrics?.[m]??0,
      leaderScore: leader.metrics?.[m]??0,
      gap: (leader.metrics?.[m]??0) - (target.metrics?.[m]??0)
    })).filter(x => x.gap <= 3 && x.gap >= 0).slice(0, 4);

    stratContent = `
    <div class="card">
      <div class="card-title">âš¡ ì—­ì „ ì¶”ê²© í•µì‹¬ ì „ëµ</div>
      <div class="insight-box" style="background:#fffbeb;border-color:#fcd34d;color:#92400e;margin-bottom:14px">
        <strong>1ìœ„ ${leader.name}(${leader.total_score}ì )</strong>ê³¼ì˜ ê²©ì°¨ëŠ” <strong>${gapToLeader}ì </strong>ì…ë‹ˆë‹¤.
        ì—­ì „ì— í•„ìš”í•œ í•µì‹¬ ì§€í‘œë¥¼ ì§‘ì¤‘ ê³µëµí•˜ì—¬ ê²©ì°¨ë¥¼ ì¤„ì´ëŠ” ì „ëµì´ í•µì‹¬ì…ë‹ˆë‹¤.
      </div>
      <div class="table-wrap"><table>
        <thead><tr><th>ì „ëµ ì˜ì—­</th><th>ì„¸ë¶€ ë‚´ìš©</th><th>ê¸°ëŒ€ íš¨ê³¼</th></tr></thead>
        <tbody>
          <tr><td><strong>ê²©ì°¨ ì—­ì „</strong></td><td>1ìœ„ ëŒ€ë¹„ ì°¨ì´ 3ì  ì´ë‚´ í•­ëª© ì§‘ì¤‘ ê³µëµ</td><td>í•­ëª© 1ìœ„ ì „í™˜</td></tr>
          <tr><td><strong>ì•½ì  ë³´ì™„</strong></td><td>ìµœí•˜ìœ„ 2ê°œ í•­ëª© ë‹¨ê¸° ê°œì„  ì§‘ì¤‘</td><td>ì¢…í•© ì ìˆ˜ +${Math.round(gapToLeader*0.4)}ì  ëª©í‘œ</td></tr>
          <tr><td><strong>1ìœ„ ëŒ€ë¹„ ì°¨ë³„í™”</strong></td><td>${target.name}ë§Œì˜ ê°•ì  í•­ëª© ê·¹ëŒ€í™” í™ë³´</td><td>ì§€ì§€ì¸µ ì „í™˜ ìœ ë„</td></tr>
          <tr><td><strong>ì´ìŠˆ ì„ ì </strong></td><td>ì§€ì—­ í˜„ì•ˆ ì´ìŠˆ ì„ ì œ ëŒ€ì‘, í”„ë ˆì„ ì„ ì </td><td>ì–¸ë¡  ë…¸ì¶œ ì¦ê°€</td></tr>
        </tbody>
      </table></div>
    </div>
    ${overturnTargets.length > 0 ? `
    <div class="card">
      <div class="card-title">ğŸ¯ ì—­ì „ ê°€ëŠ¥ ì§€í‘œ (1ìœ„ ëŒ€ë¹„ 3ì  ì´ë‚´ í•­ëª©)</div>
      <div class="insight-box" style="margin-bottom:12px">ì´ í•­ëª©ë“¤ì€ ì†Œê·œëª¨ ì§‘ì¤‘ ë…¸ë ¥ìœ¼ë¡œ 1ìœ„ ì—­ì „ì´ ê°€ëŠ¥í•œ "ìŠ¹ë¶€ì²˜"ì…ë‹ˆë‹¤.</div>
      ${overturnTargets.map(x => `
        <div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid #f1f5f9">
          <span style="width:90px;font-weight:700;font-size:13px">${METRIC_LABELS[x.m]}</span>
          <span style="color:#d97706;font-weight:700;width:80px">${target.name}: ${x.myScore}</span>
          <span style="color:var(--text-muted);font-size:12px">vs</span>
          <span style="color:var(--text-muted);font-size:12px">${leader.name}: ${x.leaderScore}</span>
          <span style="margin-left:auto;color:#dc2626;font-weight:700">ê²©ì°¨ ${x.gap}ì  â†’ ì—­ì „ ëª©í‘œ</span>
        </div>`).join('')}
    </div>` : ''}`;

  } else {
    // 3-4ìœ„: ë¦¬ë¹Œë”© ì „ëµ
    const uniqueStrength = METRICS.map(m => ({
      m, s: target.metrics?.[m]??0,
      avgOthers: candidates.filter((_,i)=>candidates[i]!==target).reduce((a,c)=>(c.metrics?.[m]??0)+a,0)/(candidates.length-1)
    })).sort((a,b)=>(b.s-b.avgOthers)-(a.s-a.avgOthers)).slice(0,3);

    stratContent = `
    <div class="card">
      <div class="card-title">ğŸš€ í¬ì§€ì…˜ ë¦¬ë¹Œë”© í•µì‹¬ ì „ëµ</div>
      <div class="insight-box" style="background:#faf5ff;border-color:#c4b5fd;color:#4c1d95;margin-bottom:14px">
        í˜„ì¬ ${rank}ìœ„ êµ¬ì¡°ì—ì„œ ë‹¨ê¸° ë„ì•½ì„ ìœ„í•´ì„œëŠ” <strong>ì°¨ë³„í™” í¬ì¸íŠ¸ ê·¹ëŒ€í™”</strong>ì™€
        <strong>íƒ€ê²Ÿ ìœ ê¶Œì ì„¸ë¶„í™” ì§‘ì¤‘</strong> ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.
      </div>
      <div class="table-wrap"><table>
        <thead><tr><th>ì „ëµ ì˜ì—­</th><th>ì„¸ë¶€ ë‚´ìš©</th><th>ê¸°ê°„</th></tr></thead>
        <tbody>
          <tr><td><strong>ì°¨ë³„í™” í¬ì¸íŠ¸</strong></td><td>${uniqueStrength.map(x=>METRIC_LABELS[x.m]).join(', ')} ì§‘ì¤‘ ë¶€ê°</td><td>ì¦‰ì‹œ</td></tr>
          <tr><td><strong>íƒ€ê²Ÿ ì••ì¶•</strong></td><td>í•µì‹¬ ì§€ì§€ ê°€ëŠ¥ ìœ ê¶Œìì¸µ 3ê°œ ê·¸ë£¹ ì„ ì • ì§‘ì¤‘</td><td>1ì£¼ ë‚´</td></tr>
          <tr><td><strong>ë©”ì‹œì§€ ì¬ì •ì˜</strong></td><td>ê¸°ì¡´ ë©”ì‹œì§€ íê¸° í›„ ë‹¨ë¬¸Â·ê°ì„± ë©”ì‹œì§€ë¡œ ì „í™˜</td><td>1ì£¼ ë‚´</td></tr>
          <tr><td><strong>SNS ë„ì•½</strong></td><td>ë°”ì´ëŸ´ ì½˜í…ì¸  ì§‘ì¤‘ ì œì‘, ì´ìŠˆ ì„ ì  ì‹œë„</td><td>2ì£¼ ë‚´</td></tr>
          <tr><td><strong>ì—°ëŒ€ ì „ëµ</strong></td><td>ì§€ì—­ ì¸ì‚¬Â·ë‹¨ì²´ì™€ ê³µë™ í–‰ë³´ ê¸°íš</td><td>2ì£¼ ë‚´</td></tr>
        </tbody>
      </table></div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ’ íƒ€ í›„ë³´ ëŒ€ë¹„ ì°¨ë³„í™” ê°•ì  í•­ëª©</div>
      ${uniqueStrength.map(x => `
        <div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid #f1f5f9">
          <span style="width:90px;font-weight:700;font-size:13px">${METRIC_LABELS[x.m]}</span>
          <div style="flex:1;height:8px;background:#f1f5f9;border-radius:4px;overflow:hidden">
            <div style="width:${x.s}%;height:100%;background:${col.border};border-radius:4px"></div>
          </div>
          <span style="color:${col.border};font-weight:700">${x.s}ì </span>
          <span style="font-size:11px;color:#16a34a;font-weight:700">íƒ€í›„ë³´ í‰ê·  ëŒ€ë¹„ +${(x.s-x.avgOthers).toFixed(1)}</span>
        </div>`).join('')}
    </div>`;
  }

  return `
  <div class="report-section">
    <div class="s-header" style="background:${strat.bg}">
      <div class="s-num">2</div>${strat.icon} ${strat.title}
    </div>
    <div class="strat-type-banner" style="background:${strat.bg}">
      <div class="strat-type-icon">${strat.icon}</div>
      <div>
        <div class="strat-type-title">${strat.title}</div>
        <div class="strat-type-desc">ì „ëµ ëª©í‘œ: ${strat.goal}</div>
      </div>
    </div>
    ${stratContent}
  </div>`;
}

/* â”€â”€ Section 3: ê²©ì°¨ ì›ì¸ ë¶„í•´ â”€â”€ */
function buildSection3_Causes(target, col, rank, leader, candidates) {
  // 1ìœ„ ëŒ€ë¹„ ë’¤ì²˜ì§€ëŠ” ì§€í‘œ (ë˜ëŠ” 1ìœ„ë©´ í•˜ìœ„ 3ê°œ)
  const gapItems = rank === 1
    ? METRICS.map(m => ({ m, gap: 0, myScore: target.metrics?.[m]??0, leaderScore: target.metrics?.[m]??0 }))
        .sort((a,b) => a.myScore - b.myScore).slice(0, 5)
    : METRICS.map(m => ({
        m,
        myScore: target.metrics?.[m]??0,
        leaderScore: leader.metrics?.[m]??0,
        gap: (leader.metrics?.[m]??0) - (target.metrics?.[m]??0)
      })).filter(x => x.gap > 0).sort((a,b) => b.gap - a.gap).slice(0, 6);

  const items = gapItems.map(x => {
    const db = GAP_CAUSES[x.m];
    const gapColor = rank === 1 ? (x.myScore >= 80 ? '#16a34a' : x.myScore >= 70 ? '#d97706' : '#dc2626') : '#dc2626';
    const gapText = rank === 1 ? `í˜„ì¬ ${x.myScore}ì ` : `ê²©ì°¨ -${x.gap}ì `;
    return `
    <div class="cause-item">
      <div class="cause-header">
        <span class="cause-metric">${METRIC_LABELS[x.m]}</span>
        <span class="cause-gap" style="background:${gapColor}22;color:${gapColor}">${gapText}</span>
        ${rank !== 1 ? `<span style="font-size:11px;color:var(--text-muted)">${target.name} ${x.myScore}ì  vs ${leader.name} ${x.leaderScore}ì </span>` : ''}
      </div>
      <ul class="cause-reasons" style="border-color:${gapColor}">
        ${db.reasons.map(r => `<li style="border-color:${gapColor}44">${r}</li>`).join('')}
      </ul>
      <div class="cause-action">ğŸ’¡ ê°œì„  ì‹¤í–‰: ${db.action}</div>
    </div>`;
  }).join('');

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#1e3a8a,#1d4ed8)">
      <div class="s-num">3</div>ğŸ” ê²©ì°¨ ì›ì¸ ë¶„í•´ ë¶„ì„
    </div>
    <div class="insight-box" style="margin-bottom:16px">
      ${rank === 1
        ? `1ìœ„ í›„ë³´ë¡œì„œ í•˜ìœ„ ì§€í‘œì˜ <strong>ì›ì¸ê³¼ ê°œì„  ë°©í–¥</strong>ì„ ë¶„ì„í•©ë‹ˆë‹¤. ì•½ì  ë…¸ì¶œì„ ì‚¬ì „ì— ì°¨ë‹¨í•˜ì„¸ìš”.`
        : `1ìœ„ <strong>${leader.name}</strong> ëŒ€ë¹„ ë’¤ì²˜ì§€ëŠ” í•­ëª©ì˜ <strong>ì›ì¸ê³¼ ì‹¤í–‰ ì „ëµ</strong>ì„ ë¶„ì„í•©ë‹ˆë‹¤.`}
    </div>
    ${items}
  </div>`;
}

/* â”€â”€ Section 4: ì ìˆ˜ ê°œì„  ì‹œë®¬ë ˆì´ì…˜ â”€â”€ */
function buildSection4_Simulation(target, col, rank, sorted, candidates) {
  // í•˜ìœ„ 5ê°œ ë©”íŠ¸ë¦­ì— ëŒ€í•´ +5ì  ì‹œë®¬ë ˆì´ì…˜
  const metList = METRICS.map(m => ({ m, s: target.metrics?.[m]??0 })).sort((a,b)=>a.s-b.s).slice(0,5);

  const rows = metList.map(x => {
    const delta = Math.min(5, 100 - x.s); // ìµœëŒ€ 100ì ê¹Œì§€ë§Œ
    const newTotal = target.total_score + delta;
    // ìƒˆ ìˆœìœ„ ê³„ì‚°
    const newRank = sorted.filter(c => c.origIdx !== candidates.indexOf(target) && c.total_score > newTotal).length + 1;
    const rankChange = rank - newRank;
    const probPct = Math.min(95, Math.round(50 + rankChange * 20 + delta * 2));

    const probColor = probPct >= 70 ? '#16a34a' : probPct >= 45 ? '#d97706' : '#dc2626';
    const probLabel = probPct >= 70 ? 'ë†’ìŒ' : probPct >= 45 ? 'ë³´í†µ' : 'ë‚®ìŒ';

    return `
    <div class="sim-row">
      <div class="sim-metric" style="color:${col.border}">${METRIC_LABELS[x.m]}</div>
      <div class="sim-delta">+${delta}ì </div>
      <div class="sim-result">
        <div class="sim-before">í˜„ì¬: ${target.total_score}ì  (${rank}ìœ„) â†’ ê°œì„  í›„: <strong>${newTotal}ì  (${newRank}ìœ„)</strong></div>
        <div class="sim-after" style="color:${rankChange > 0 ? '#16a34a' : 'var(--text-muted)'}">
          ${rankChange > 0 ? `â¬† ${rankChange}ê³„ë‹¨ ìƒìŠ¹ ê°€ëŠ¥` : `ìˆœìœ„ ë³€ë™ ì—†ìŒ (ì ìˆ˜ +${delta}ì  í–¥ìƒ)`}
        </div>
      </div>
      <span class="sim-prob" style="background:${probColor}22;color:${probColor}">
        ì—­ì „ ê°€ëŠ¥ì„± ${probPct}% Â· ${probLabel}
      </span>
    </div>`;
  }).join('');

  // ë³µí•© ì‹œë‚˜ë¦¬ì˜¤: ìƒìœ„ 3ê°œ ë™ì‹œ ê°œì„ 
  const top3Targets = metList.slice(0,3);
  const combinedDelta = top3Targets.reduce((a,x) => a + Math.min(5, 100-x.s), 0);
  const combinedNew = target.total_score + combinedDelta;
  const combinedRank = sorted.filter(c => c.origIdx !== candidates.indexOf(target) && c.total_score > combinedNew).length + 1;

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#1e3a8a,#1d4ed8)">
      <div class="s-num">4</div>ğŸ“ˆ ì ìˆ˜ ê°œì„  ì‹œë®¬ë ˆì´ì…˜
    </div>
    <div class="insight-box" style="margin-bottom:16px">
      ê° í•­ëª©ì„ <strong>5ì  ê°œì„ </strong>í–ˆì„ ë•Œ ì¢…í•© ìˆœìœ„ì™€ ì—­ì „ ê°€ëŠ¥ì„±ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.
      ìˆ˜ì¹˜ëŠ” í˜„ì¬ ë°ì´í„° ê¸°ë°˜ì˜ ì˜ˆì¸¡ì´ë©°, ì‹¤ì œ ì„ ê±° ê²°ê³¼ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </div>
    ${rows}

    <!-- ë³µí•© ì‹œë‚˜ë¦¬ì˜¤ -->
    <div class="card" style="background:linear-gradient(135deg,#1e3a8a11,#dbeafe);border:2px solid #3b82f6;margin-top:4px">
      <div class="card-title">ğŸš€ ë³µí•© ì‹œë‚˜ë¦¬ì˜¤: í•˜ìœ„ 3ê°œ í•­ëª© ë™ì‹œ ê°œì„ </div>
      <div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap;padding:4px 0">
        <div>
          <div style="font-size:12px;color:var(--text-muted)">ê°œì„  í•­ëª©</div>
          <div style="font-weight:700">${top3Targets.map(x=>METRIC_LABELS[x.m]).join(', ')}</div>
        </div>
        <div>
          <div style="font-size:12px;color:var(--text-muted)">ì´ ê°œì„  ì ìˆ˜</div>
          <div style="font-weight:700;color:#16a34a">+${combinedDelta}ì </div>
        </div>
        <div>
          <div style="font-size:12px;color:var(--text-muted)">í˜„ì¬ â†’ ê°œì„  í›„</div>
          <div style="font-weight:700">${target.total_score}ì  â†’ ${combinedNew}ì </div>
        </div>
        <div style="margin-left:auto;text-align:center">
          <div style="font-size:12px;color:var(--text-muted)">ì˜ˆìƒ ìˆœìœ„ ë³€í™”</div>
          <div style="font-size:22px;font-weight:900;color:${combinedRank < rank?'#16a34a':'var(--text-muted)'}">
            ${rank}ìœ„ â†’ ${combinedRank}ìœ„
          </div>
        </div>
      </div>
    </div>
  </div>`;
}

/* â”€â”€ Section 5: ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„ â”€â”€ */
function buildSection5_Attack(target, col, candidates) {
  const ATTACK_DB = {
    ê³µìµì„±: { point: 'ì§€ì—­ ì†Œì™¸ ê³„ì¸µ ë°©ì¹˜ ì˜í˜¹', scenario: '"íŠ¹ì • ì§€ì—­Â·ê³„ì¸µë§Œ ì±™ê¸´ë‹¤"ëŠ” í”„ë ˆì„ ê³µì„¸ ì˜ˆìƒ', defense: 'ê³µìµ ì‚¬ì—… ìˆ˜í˜œ ëŒ€ìƒ ë°ì´í„° ê³µê°œ, ì†Œì™¸ ì§€ì—­ ë°©ë¬¸ ì¼ì • ì„ ì œ í™ë³´' },
    ì •ì±…ì‹¤í–‰ë ¥: { point: 'ê³µì•½ ë¶ˆì´í–‰ ê³µê²©', scenario: '"ë§ë§Œ ë§ê³  ì´í–‰ë¥ ì´ ë‚®ë‹¤"ëŠ” ì´ì „ ê³µì•½ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê³µì„¸ ì˜ˆìƒ', defense: 'ê³µì•½ ì´í–‰ë¥  í˜„í™© ì„ ì œ ê³µê°œ, ë¯¸ì´í–‰ ê±´ ì´ìœ  ë° ëŒ€ì•ˆ ëª…í™• ì„¤ëª…' },
    ì „ë¬¸ì„±: { point: 'ìê²©Â·ì „ë¬¸ì„± ë¶€ì¡± ì˜í˜¹', scenario: '"í•´ë‹¹ ë¶„ì•¼ ê²½í—˜ì´ ë¶€ì¡±í•˜ë‹¤"ëŠ” ê²€ì¦ ê³µì„¸ ì˜ˆìƒ', defense: 'ê´€ë ¨ ì´ë ¥Â·ìê²© ì§‘ì¤‘ í™ë³´, ì „ë¬¸ê°€ ì¶”ì²œì‚¬Â·í˜‘ë ¥ ì‚¬ë¡€ ê³µê°œ' },
    ëŒ€ì‘ì„±: { point: 'ë¯¼ì› ë¬´ëŒ€ì‘Â·ëŠ‘ì¥ ëŒ€ì‘ ì§€ì ', scenario: '"ë¯¼ì›ì„ ë¬´ì‹œí•œë‹¤"ëŠ” SNS í™•ì‚° ê°€ëŠ¥', defense: 'ì‘ë‹µ ì†ë„ ê°œì„  ì²´ê³„ ê³µê°œ, ì²˜ë¦¬ ì™„ë£Œ ê±´ ìˆ˜ì¹˜ ì œì‹œ' },
    ì±…ì„ì„±: { point: 'ê³¼ê±° ì•½ì† ìœ„ë°˜ ê³µê²©', scenario: '"ì „ì—ë„ ì§€í‚¤ì§€ ì•Šì•˜ë‹¤"ëŠ” ì•„ì¹´ì´ë¸Œ ê³µì„¸ ì˜ˆìƒ', defense: 'ì „ì²´ ê³µì•½ ì´í–‰ í˜„í™©í‘œ ì„ ì œ ê³µê°œ, ë³€ê²½ ì‚¬ìœ  íˆ¬ëª… ì„¤ëª…' },
    ì†Œí†µëŠ¥ë ¥: { point: 'ë¶ˆí†µÂ·ì—˜ë¦¬íŠ¸ ì´ë¯¸ì§€ ê³µê²©', scenario: '"í˜„ì¥ì„ ëª¨ë¥¸ë‹¤", "ì˜¤ë§Œí•˜ë‹¤"ëŠ” í”„ë ˆì„ ìœ í¬ ì˜ˆìƒ', defense: 'í˜„ì¥ ë°©ë¬¸ ë¹ˆë„ ìˆ˜ì¹˜ ê³µê°œ, ì‹œë¯¼ ê°„ë‹´íšŒ ì •ê¸° ê°œìµœ' },
    ë¦¬ë”ì‹­: { point: 'ìš°ìœ ë¶€ë‹¨Â·ê²°ë‹¨ë ¥ ë¶€ì¬ ê³µê²©', scenario: '"ì¤‘ìš”í•œ ìˆœê°„ì— ê²°ì •ì„ ëª» í•œë‹¤"ëŠ” ë¹„íŒ ì˜ˆìƒ', defense: 'ê³¼ê±° ê²°ë‹¨ ì‚¬ë¡€ ìŠ¤í† ë¦¬ ë°œêµ´, ì…ì¥ ëª…í™•í™” ë°œì–¸ ê°•í™”' },
    ë¹„ì „ëª…í™•ì„±: { point: 'ì¶”ìƒì  ë¹„ì „Â·ì‹¤í˜„ ë¶ˆê°€ ê³µì•½ ì§€ì ', scenario: '"ë§ì´ ì¢‹ì„ ë¿ êµ¬ì²´ì„±ì´ ì—†ë‹¤"ëŠ” ë¹„íŒ ì˜ˆìƒ', defense: 'ìˆ˜ì¹˜í˜• ëª©í‘œ ì¬ì„¤ì •Â·ê³µí‘œ, ë‹¨ê³„ë³„ ë¡œë“œë§µ ê³µê°œ' },
    ì²­ë ´ì„±: { point: 'ì´í•´ì¶©ëŒÂ·ì¬ì • íˆ¬ëª…ì„± ì˜í˜¹', scenario: 'ì¬ì‚°Â·í›„ì›ê¸ˆ ê´€ë ¨ ì˜í˜¹ ì œê¸° ê°€ëŠ¥ì„±', defense: 'ì¬ì‚° ê³µê°œ ìë°œì  ì—…ë°ì´íŠ¸, ì´í•´ì¶©ëŒ ë°©ì§€ ì„œì•½ì„œ ê³µê°œ' },
    ìœ¤ë¦¬ì„±: { point: 'ê³¼ê±° í–‰ë™Â·ë°œì–¸ ë…¼ë€ ì¬ì†Œí™˜', scenario: 'ê³¼ê±° SNSÂ·ë°œì–¸ ì•„ì¹´ì´ë¸Œ ë°œêµ´ ê³µì„¸ ì˜ˆìƒ', defense: 'ê³¼ê±° ë…¼ë€ ì‚¬ì „ íŒŒì•…Â·í•´ëª…ë¬¸ ì¤€ë¹„, í–‰ë™ê°•ë ¹ ì¬ì„œì•½ ê³µê°œ' }
  };

  const riskMetrics = METRICS.map(m => ({ m, s: target.metrics?.[m]??0 })).sort((a,b)=>a.s-b.s).slice(0,5);

  const cards = riskMetrics.map((x, i) => {
    const db = ATTACK_DB[x.m];
    const level = x.s < 70 ? { label:'ê³ ìœ„í—˜', color:'#dc2626', bg:'#fee2e2' }
                : x.s < 78 ? { label:'ì¤‘ìœ„í—˜', color:'#d97706', bg:'#fffbeb' }
                : { label:'ì €ìœ„í—˜', color:'#16a34a', bg:'#f0fdf4' };
    return `
    <div class="attack-card" style="border-left-color:${level.color}">
      <div class="attack-head">
        <span class="attack-level" style="background:${level.bg};color:${level.color}">${level.label}</span>
        <span class="attack-point">${db.point}</span>
        <span style="margin-left:auto;font-size:12px;color:var(--text-muted)">${METRIC_LABELS[x.m]} ${x.s}ì </span>
      </div>
      <div class="attack-scenario">ğŸ“Œ ì˜ˆìƒ ê³µê²©: ${db.scenario}</div>
      <div class="defense-row">ğŸ›¡ï¸ <strong>ë°©ì–´ ì „ëµ:</strong> ${db.defense}</div>
    </div>`;
  }).join('');

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#7f1d1d,#dc2626)">
      <div class="s-num">5</div>âš”ï¸ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„ Â· ë°©ì–´ ì „ëµ
    </div>
    <div class="insight-box" style="background:#fff1f2;border-color:#fda4af;color:#9f1239;margin-bottom:16px">
      í•˜ìœ„ ì ìˆ˜ í•­ëª©ì€ <strong>ìƒëŒ€ í›„ë³´ì˜ ê³µê²© í¬ì¸íŠ¸</strong>ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      ì˜ˆìƒ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ì™€ ë°©ì–´ ì „ëµì„ ì‚¬ì „ì— ì¤€ë¹„í•˜ì„¸ìš”.
    </div>
    ${cards}
  </div>`;
}

/* â”€â”€ Section 6: 90ì¼ ì‹¤í–‰ í”Œëœ â”€â”€ */
function buildSection6_Plan(target, col, rank, strat) {
  const plans = {
    1: [
      { phase:'1~30ì¼ (ì¦‰ì‹œ ì‹¤í–‰)', color:'#dc2626', tasks:[
        'ì·¨ì•½ ì§€í‘œ Top 3 ë°©ì–´ ìº í˜ì¸ ê¸°íš ë° ì‹¤í–‰',
        'ì§€ì§€ì¸µ í•µì‹¬ ëª…ë‹¨ íŒŒì•… ë° ê°ì‚¬ ì†Œí†µ í–‰ì‚¬ ê°œìµœ',
        'ê³µê²© ì˜ˆìƒ í¬ì¸íŠ¸ ì‚¬ì „ í•´ëª… ìë£Œ ì¤€ë¹„',
        'SNS ë°œì–¸ ì‚¬ì „ ê²€í†  ì²´ê³„ êµ¬ì¶•',
        'ì–¸ë¡  ê¸ì • ê¸°ì‚¬ ì†Œì¬ ë°°í¬ ì¼ì • ìˆ˜ë¦½'
      ]},
      { phase:'31~60ì¼ (ê°•í™”)', color:'#d97706', tasks:[
        'ê³µì•½ ì´í–‰ í˜„í™© 100ì¼ ë¦¬í¬íŠ¸ ë°œê°„',
        'ì¤‘ë„ì¸µ ìœ ì…ì„ ìœ„í•œ ì •ì±… í† ë¡ íšŒ ê°œìµœ',
        'ì§€ì—­ í˜„ì•ˆ ì´ìŠˆ ì„ ì  ë³´ë„ìë£Œ ë°œì†¡',
        '2ìœ„ í›„ë³´ ì „ëµ ëª¨ë‹ˆí„°ë§ ë° ëŒ€ì‘ ì¤€ë¹„',
        'ì§€ì§€ì¸µ ëŒ€ìƒ ê²°ì§‘ ì´ë²¤íŠ¸ ê°œìµœ'
      ]},
      { phase:'61~90ì¼ (ë§ˆë¬´ë¦¬)', color:'#16a34a', tasks:[
        'ìµœì¢… ë¹„ì „ ì„ ì–¸ í¼í¬ë¨¼ìŠ¤ ê¸°íš',
        'í•µì‹¬ ì§€ì§€ì¸µ íˆ¬í‘œ ë…ë ¤ ìº í˜ì¸',
        'ë§ˆì§€ë§‰ ì´ìŠˆ ëŒ€ì‘ ì‹œë®¬ë ˆì´ì…˜ ì ê²€',
        'ë¯¸ë””ì–´ ë…¸ì¶œ ì§‘ì¤‘ ë§ˆë¬´ë¦¬ ì „ëµ ì‹¤í–‰',
        'ì•ˆì „í•œ ìŠ¹ë¦¬ë¥¼ ìœ„í•œ ì‹¤ìˆ˜ ìµœì†Œí™” ì²´ê³„ ì ê²€'
      ]}
    ],
    2: [
      { phase:'1~30ì¼ (ê²©ì°¨ ì¶•ì†Œ)', color:'#dc2626', tasks:[
        '1ìœ„ ëŒ€ë¹„ ê²©ì°¨ 3ì  ì´ë‚´ í•­ëª© ì§‘ì¤‘ ê³µëµ ì‹œì‘',
        'í•˜ìœ„ ì§€í‘œ ì›ì¸ ë¶„ì„ í›„ ê°œì„  ìº í˜ì¸ ì‹¤í–‰',
        'ì°¨ë³„í™” ë©”ì‹œì§€ ë°œêµ´ ë° ë¸Œëœë”© ì¬ì„¤ì •',
        'ì§€ì—­ í˜„ì•ˆ ê´€ë ¨ ì„ ì œ ì…ì¥ í‘œëª…',
        'í•µì‹¬ ì§€ì§€ì¸µ ê²°ì§‘ ì†Œí†µ í–‰ì‚¬ ê°œìµœ'
      ]},
      { phase:'31~60ì¼ (ì—­ì „ ì‹œë„)', color:'#d97706', tasks:[
        'ìŠ¹ë¶€ì²˜ í•­ëª© ì§‘ì¤‘ í™ë³´ ìº í˜ì¸ ì‹¤í–‰',
        '1ìœ„ í›„ë³´ ì•½ì  ë¶„ì„ ê¸°ë°˜ ë¹„êµ ë©”ì‹œì§€ ì„¤ê³„',
        'ê³µì•½ ì´í–‰ë ¥Â·ì „ë¬¸ì„± ì¦ë¹™ ìë£Œ ëŒ€ëŸ‰ ë°°í¬',
        'ì¤‘ë„ì¸µ ìœ ì…ì„ ìœ„í•œ ì •ì±… ì´ìŠˆ ì„ ì ',
        'ì–¸ë¡  ì¸í„°ë·°Â·ê¸°ê³ ë¬¸ ë…¸ì¶œ ì§‘ì¤‘'
      ]},
      { phase:'61~90ì¼ (ìµœì¢… ì—­ì „)', color:'#16a34a', tasks:[
        'ì§€ì§€ìœ¨ ê²©ì°¨ í˜„í™© ì ê²€ ë° ì „ëµ ì¬ì¡°ì •',
        'í•µì‹¬ ì´ìŠˆ ìµœì¢… ì„ ì  ìº í˜ì¸',
        'íˆ¬í‘œì¸µ ì „í™˜ì„ ìœ„í•œ ì§ì ‘ ì†Œí†µ ê°•í™”',
        'ë§ˆì§€ë§‰ ì—­ì „ ê¸°íšŒ ì´ìŠˆ í¬ì°© ëŒ€ë¹„',
        'ì§€ì§€ì¸µ íˆ¬í‘œìœ¨ ê·¹ëŒ€í™” ìº í˜ì¸'
      ]}
    ],
    3: [
      { phase:'1~30ì¼ (ì¸ì§€ë„ ì í”„)', color:'#7c3aed', tasks:[
        'ê¸°ì¡´ ë©”ì‹œì§€ ì „ë©´ ì¬ì„¤ê³„, ë‹¨ë¬¸Â·ê°ì„± ìŠ¬ë¡œê±´ í™•ì •',
        'ë°”ì´ëŸ´ ê°€ëŠ¥í•œ SNS ì½˜í…ì¸  ì§‘ì¤‘ ì œì‘ (ì£¼ 3ê±´ ì´ìƒ)',
        'íƒ€ê²Ÿ ìœ ê¶Œì 3ê°œ ê·¸ë£¹ ì„ ì • ë° ë§ì¶¤ ì†Œí†µ ì‹œì‘',
        'ì§€ì—­ ì¸ì‚¬Â·ë‹¨ì²´ì™€ ê³µë™ í–‰ë³´ ê¸°íš',
        'ì–¸ë¡  ë…¸ì¶œ 0â†’1 ì „ëµ: ì§€ì—­ ì´ìŠˆ ì„ ì  ì‹œë„'
      ]},
      { phase:'31~60ì¼ (ì°¨ë³„í™” ê°•í™”)', color:'#d97706', tasks:[
        'ì°¨ë³„í™” ê°•ì  í•­ëª© ì§‘ì¤‘ í™ë³´ ìº í˜ì¸',
        'íƒ€ê²Ÿ ì§€ì§€ì¸µ í–‰ì‚¬Â·ê°„ë‹´íšŒ ì§‘ì¤‘ ê°œìµœ',
        'íƒ€í›„ë³´ ëŒ€ë¹„ ì°¨ë³„ì„± ë©”ì‹œì§€ ë¹„êµ ìë£Œ ë°°í¬',
        'ì´ìŠˆ ì„ ì  ì„±ê³µ ì‚¬ë¡€ ì¶•ì  ë° í™ë³´',
        'ì§€ì—­ ë§¤ì²´ ì¸í„°ë·° ì§‘ì¤‘ í™•ë³´'
      ]},
      { phase:'61~90ì¼ (ê²°ì§‘)', color:'#16a34a', tasks:[
        'í™•ë³´ëœ ì§€ì§€ì¸µ ê²°ì§‘ ì§‘ì¤‘ ê´€ë¦¬',
        'ìµœí›„ ì´ìŠˆ ì„ ì  ì‹œë„',
        'íˆ¬í‘œ ë…ë ¤ ì§ì ‘ ì†Œí†µ ê°•í™”',
        'í¬ì§€ì…˜ ë³€í™” ì„±ê³¼ ì´ì •ë¦¬ ë°°í¬',
        'ë§ˆì§€ë§‰ ì¸ìƒ ê´€ë¦¬ ë° ë§ˆë¬´ë¦¬ ìº í˜ì¸'
      ]}
    ]
  };

  const planData = plans[rank <= 2 ? rank : 3];

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#1e3a8a,#1d4ed8)">
      <div class="s-num">6</div>ğŸ“… 90ì¼ ì‹¤í–‰ í”Œëœ
    </div>
    <div class="insight-box" style="margin-bottom:16px">
      ë°ì´í„° ê¸°ë°˜ ì „ëµì  ì„ íƒì§€ë¥¼ ì œì‹œí•©ë‹ˆë‹¤. êµ¬ì²´ì  ì‹¤í–‰ì€ í˜„ì¥ ìƒí™©ì— ë§ê²Œ ì¡°ì •í•˜ì„¸ìš”.
    </div>
    ${planData.map(p => `
    <div class="plan-phase">
      <div class="plan-phase-header" style="background:${p.color}">
        ğŸ“Œ ${p.phase}
      </div>
      <div class="plan-phase-body">
        ${p.tasks.map(t => `<div class="plan-task">${t}</div>`).join('')}
      </div>
    </div>`).join('')}

    <!-- ë©´ì±… ì¡°í•­ -->
    <div class="insight-box" style="background:#f8fafc;border-color:var(--border);color:var(--text-muted);font-size:12px;margin-top:16px">
      âš ï¸ <strong>ì¤‘ìš” ì•ˆë‚´:</strong> ë³¸ ë³´ê³ ì„œëŠ” ê³µê°œëœ ë°ì´í„° ê¸°ë°˜ì˜ ê°ê´€ì  ë¶„ì„ì´ë©°,
      íŠ¹ì • í›„ë³´ì— ëŒ€í•œ ì§€ì§€ ë˜ëŠ” ì„ ê±° ê²°ê³¼ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      ì „ëµì  ì„ íƒì§€ ì œì‹œì™€ ì˜ì‚¬ê²°ì • ì§€ì›ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.
      ì„ ê±° ê´€ë ¨ ë²•ë ¹ ì¤€ìˆ˜ëŠ” í›„ë³´ìì™€ ìº í”„ì˜ ì±…ì„ì…ë‹ˆë‹¤.
    </div>
  </div>`;
}

/* â”€â”€ ë ˆì´ë” ì°¨íŠ¸ â”€â”€ */
function renderRadar(target, col, candidates) {
  const ctx = document.getElementById('stratRadar');
  if (!ctx) return;
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: METRICS.map(m => METRIC_LABELS[m]),
      datasets: [
        {
          label: target.name,
          data: METRICS.map(m => target.metrics?.[m]??0),
          borderColor: col.border,
          backgroundColor: col.bg,
          borderWidth: 3,
          pointRadius: 4,
          pointBackgroundColor: col.border,
        },
        ...candidates.filter(c => c !== target).map((c,i) => {
          const oc = CANDIDATE_COLORS[(candidates.indexOf(c)) % 5];
          return {
            label: c.name,
            data: METRICS.map(m => c.metrics?.[m]??0),
            borderColor: oc.border + '80',
            backgroundColor: 'transparent',
            borderWidth: 1.5,
            pointRadius: 2,
            borderDash: [4,3],
            pointBackgroundColor: oc.border,
          };
        })
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      scales: {
        r: {
          min: 50, max: 100,
          ticks: { stepSize: 10, font: { size: 9 } },
          pointLabels: { font: { size: 10, weight: '600' } },
          grid: { color: '#e2e8f0' }
        }
      },
      plugins: {
        legend: { position: 'bottom', labels: { font: { size: 11 }, padding: 10 } }
      }
    }
  });
}

/* â”€â”€ PDF ì €ì¥ â”€â”€ */
async function printStrategy() {
  const canvases = Array.from(document.querySelectorAll('canvas'));
  const replacements = [];
  for (const canvas of canvases) {
    const rect = canvas.getBoundingClientRect();
    const img = document.createElement('img');
    img.src = canvas.toDataURL('image/png', 1.0);
    img.style.cssText = `width:100%;height:${rect.height}px;display:block;object-fit:contain`;
    replacements.push({ canvas, img, parent: canvas.parentNode });
    canvas.parentNode.replaceChild(img, canvas);
  }
  await new Promise(r => setTimeout(r, 500));
  window.print();
  setTimeout(() => {
    replacements.forEach(({ img, canvas, parent }) => {
      try { if (img.parentNode === parent) parent.replaceChild(canvas, img); } catch(e) {}
    });
  }, 1500);
}
</script>
</body>
</html>
