<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ë‹¹ì„  ì „ëµ ë³´ê³ ì„œ Â· ElectionAI</title>
<link rel="stylesheet" href="css/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* â”€â”€ ì»¤ë²„ â”€â”€ */
.strat-cover {
  background: linear-gradient(140deg,#0f172a 0%,#1e3a8a 55%,#1d4ed8 100%);
  color: white; border-radius: var(--radius); padding: 48px 44px;
  position: relative; overflow: hidden; margin-bottom: 28px;
}
.strat-cover::before {
  content:'ğŸ†'; font-size:220px; opacity:.04;
  position:absolute; right:-20px; top:-30px; line-height:1;
}
.strat-label {
  display:inline-block; background:rgba(245,158,11,.18);
  border:1px solid rgba(245,158,11,.45); color:#fcd34d;
  padding:4px 14px; border-radius:20px; font-size:12px; font-weight:700;
  margin-bottom:18px; letter-spacing:.5px;
}
.strat-cover h1 { font-size:28px; font-weight:900; line-height:1.3; margin-bottom:8px; }
.strat-cover .subtitle { font-size:14px; opacity:.92; margin-bottom:28px; }
.strat-cover-meta { display:flex; flex-wrap:wrap; gap:28px; }
.strat-cover-meta-item .lbl { font-size:10px; opacity:.82; text-transform:uppercase; letter-spacing:.8px; margin-bottom:3px; }
.strat-cover-meta-item .val { font-size:15px; font-weight:700; }

/* â”€â”€ ì „ëµ ìœ í˜• ë°°ì§€ â”€â”€ */
.strat-type-banner {
  display:flex; align-items:center; gap:16px;
  border-radius:var(--radius); padding:20px 24px; margin-bottom:24px; color:white;
}
.strat-type-icon { font-size:40px; flex-shrink:0; }
.strat-type-title { font-size:20px; font-weight:900; }
.strat-type-desc { font-size:13px; opacity:.95; margin-top:3px; }

/* â”€â”€ ì„¹ì…˜ í—¤ë” â”€â”€ */
.s-header {
  display:flex; align-items:center; gap:10px;
  font-size:16px; font-weight:800; padding:12px 18px;
  border-radius:var(--radius-sm); margin-bottom:16px; color:white;
}
.s-num {
  background:rgba(255,255,255,0.2); width:26px; height:26px;
  border-radius:50%; display:flex; align-items:center; justify-content:center;
  font-size:12px; font-weight:900; flex-shrink:0;
}

/* â”€â”€ í¬ì§€ì…˜ ì§„ë‹¨ ì¹´ë“œ â”€â”€ */
.pos-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:12px; margin-bottom:16px; }
.pos-card {
  background:white; border-radius:var(--radius-sm); padding:16px;
  border:1px solid var(--border); text-align:center;
}
.pos-card .pc-label { font-size:11px; color:var(--text-muted); font-weight:600; margin-bottom:6px; }
.pos-card .pc-val { font-size:30px; font-weight:900; }
.pos-card .pc-sub { font-size:11px; color:var(--text-muted); margin-top:3px; }

/* â”€â”€ ê²©ì°¨ ì›ì¸ ë¶„í•´ â”€â”€ */
.cause-item {
  background:white; border-radius:var(--radius-sm); border:1px solid var(--border);
  padding:14px 18px; margin-bottom:10px;
}
.cause-header { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
.cause-metric { font-size:14px; font-weight:700; }
.cause-gap { font-size:13px; font-weight:800; padding:2px 10px; border-radius:12px; }
.cause-reasons { padding-left:0; list-style:none; display:flex; flex-direction:column; gap:5px; }
.cause-reasons li {
  font-size:12px; color:var(--text-muted); padding:5px 10px;
  background:#f8fafc; border-radius:6px; border-left:3px solid;
  display:flex; gap:7px; align-items:flex-start;
}
.cause-reasons li::before { content:'â†’'; font-weight:700; flex-shrink:0; }
.cause-action {
  margin-top:8px; font-size:12px; font-weight:700; color:#1e40af;
  background:#eff6ff; padding:5px 10px; border-radius:6px;
}

/* â”€â”€ ì‹œë®¬ë ˆì´ì…˜ â”€â”€ */
.sim-row {
  background:white; border:1px solid var(--border); border-radius:var(--radius-sm);
  padding:14px 18px; margin-bottom:10px;
  display:flex; align-items:center; gap:16px; flex-wrap:wrap;
}
.sim-metric { font-size:13px; font-weight:700; width:90px; flex-shrink:0; }
.sim-delta { font-size:13px; font-weight:800; color:#16a34a; width:50px; flex-shrink:0; }
.sim-result { flex:1; }
.sim-result .sim-before { font-size:12px; color:var(--text-muted); }
.sim-result .sim-after { font-size:13px; font-weight:700; }
.sim-prob {
  font-size:12px; font-weight:700; padding:4px 12px; border-radius:20px;
  white-space:nowrap;
}

/* â”€â”€ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ â”€â”€ */
.attack-card {
  background:white; border-radius:var(--radius-sm); border:1px solid var(--border);
  border-left:4px solid #dc2626; padding:14px 18px; margin-bottom:10px;
}
.attack-head { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
.attack-level { font-size:11px; font-weight:700; padding:2px 8px; border-radius:10px; }
.attack-point { font-size:14px; font-weight:700; color:#dc2626; }
.attack-scenario { font-size:13px; color:var(--text-muted); margin-bottom:8px; }
.defense-row { font-size:13px; background:#f0fdf4; border-radius:6px; padding:8px 12px; color:#166534; }
.defense-row strong { font-weight:700; }

/* â”€â”€ 90ì¼ í”Œëœ â”€â”€ */
.plan-phase {
  background:white; border-radius:var(--radius-sm); border:1px solid var(--border);
  overflow:hidden; margin-bottom:12px;
}
.plan-phase-header {
  padding:12px 18px; color:white; font-weight:800; font-size:14px;
  display:flex; align-items:center; gap:10px;
}
.plan-phase-body { padding:14px 18px; }
.plan-task { font-size:13px; padding:5px 0; border-bottom:1px solid #f1f5f9; display:flex; gap:8px; }
.plan-task:last-child { border-bottom:none; }
.plan-task::before { content:'âœ“'; color:#16a34a; font-weight:700; flex-shrink:0; }

/* â”€â”€ ê°•ì  ìœ ì§€ ì§€ìˆ˜ / ì•½ì  ë¦¬ìŠ¤í¬ â”€â”€ */
.index-bars { display:flex; flex-direction:column; gap:8px; }
.index-bar-row { display:flex; align-items:center; gap:10px; }
.index-bar-label { width:80px; font-size:12px; font-weight:600; flex-shrink:0; }
.index-bar-track { flex:1; height:10px; background:#f1f5f9; border-radius:5px; overflow:hidden; }
.index-bar-fill { height:100%; border-radius:5px; transition:width .4s; }
.index-bar-val { width:36px; text-align:right; font-size:12px; font-weight:700; }

/* â”€â”€ ê²½ìŸ í›„ë³´ ëŒ€ì‘ ì¹´ë“œ â”€â”€ */
.comp-card {
  background:white; border-radius:var(--radius-sm); border:1px solid var(--border);
  padding:18px; margin-bottom:14px;
}
.comp-card-header {
  display:flex; align-items:center; gap:12px; margin-bottom:14px;
  padding-bottom:12px; border-bottom:1px solid #f1f5f9;
}
.comp-name { font-size:16px; font-weight:800; }
.comp-badge { font-size:11px; font-weight:700; padding:3px 10px; border-radius:10px; }
.comp-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-top:12px; }
.comp-col-title { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.5px; margin-bottom:8px; }
.comp-tag {
  display:inline-block; font-size:11px; padding:3px 8px;
  border-radius:6px; margin:2px; font-weight:600;
}
.comp-strategy-row {
  font-size:13px; padding:7px 12px; border-radius:6px;
  background:#f8fafc; margin-top:4px; border-left:3px solid;
}

/* â”€â”€ ì§€ì§€ìœ¨ ì „í™˜ ëª¨ë¸ â”€â”€ */
.support-model {
  background:white; border-radius:var(--radius-sm); border:1px solid var(--border);
  padding:16px 18px; margin-bottom:10px;
}
.support-bar-row { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
.support-bar-label { font-size:12px; font-weight:600; width:100px; flex-shrink:0; }
.support-bar-track {
  flex:1; height:14px; background:#f1f5f9; border-radius:7px; overflow:hidden;
  position:relative;
}
.support-bar-fill { height:100%; border-radius:7px; transition:width .5s; }
.support-bar-val { font-size:12px; font-weight:700; width:90px; text-align:right; }

/* â”€â”€ ë©”ì‹œì§€ ì „ëµ â”€â”€ */
.msg-slogan-box {
  background:linear-gradient(135deg,#1e3a8a,#3b82f6); color:white;
  border-radius:var(--radius-sm); padding:18px 22px; margin-bottom:10px;
}
.msg-slogan-label { font-size:10px; opacity:.9; text-transform:uppercase; letter-spacing:1px; margin-bottom:6px; }
.msg-slogan-text { font-size:18px; font-weight:900; line-height:1.4; }
.msg-slogan-sub { font-size:12px; opacity:.95; margin-top:6px; }
.keyword-grid { display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
.keyword-chip { font-size:12px; font-weight:700; padding:5px 12px; border-radius:20px; }
.speak-row {
  display:flex; gap:12px; padding:10px 0;
  border-bottom:1px solid #f1f5f9; align-items:flex-start;
}
.speak-row:last-child { border-bottom:none; }
.speak-label {
  font-size:11px; font-weight:700; padding:3px 8px; border-radius:6px;
  white-space:nowrap; flex-shrink:0; width:60px; text-align:center;
}
.speak-text { font-size:13px; color:var(--text-muted); flex:1; line-height:1.5; }
.sns-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:12px; }
.sns-card {
  background:white; border-radius:var(--radius-sm); border:1px solid var(--border); padding:14px;
}
.sns-platform { font-size:13px; font-weight:800; margin-bottom:8px; }
.sns-rule { font-size:11px; color:var(--text-muted); padding:3px 0; line-height:1.4; }

/* â”€â”€ ìº í”„ ì¡°ì§ë³„ ë¶„ë°° â”€â”€ */
.org-table-wrap { overflow-x:auto; }
.org-table { width:100%; border-collapse:collapse; font-size:13px; }
.org-table th {
  background:#1e3a8a; color:white; padding:9px 14px;
  text-align:left; font-size:11px; font-weight:700; letter-spacing:.3px;
}
.org-table td { padding:10px 14px; border-bottom:1px solid #f1f5f9; vertical-align:top; }
.org-table tr:last-child td { border-bottom:none; }
.org-table tr:nth-child(even) td { background:#f8fafc; }
.org-role { font-weight:700; }
.org-task-list { list-style:none; padding:0; margin:0; }
.org-task-list li { font-size:12px; color:var(--text-muted); padding:2px 0; }
.org-task-list li::before { content:'Â· '; font-weight:700; }

/* â”€â”€ ë¦¬ìŠ¤í¬ ë§¤ë‰´ì–¼ â”€â”€ */
.risk-card {
  background:white; border-radius:var(--radius-sm);
  overflow:hidden; margin-bottom:12px; border:1px solid var(--border);
}
.risk-header {
  padding:12px 18px; color:white; font-weight:800; font-size:14px;
  display:flex; align-items:center; gap:10px;
}
.risk-body { padding:14px 18px; }
.risk-timeline { display:flex; flex-direction:column; gap:10px; }
.risk-step { display:flex; gap:12px; align-items:flex-start; }
.risk-step-time {
  font-size:11px; font-weight:700; padding:4px 8px; border-radius:10px;
  white-space:nowrap; flex-shrink:0; min-width:72px; text-align:center;
}
.risk-step-text { font-size:13px; color:var(--text-muted); flex:1; line-height:1.5; padding-top:3px; }

/* â”€â”€ ì¸ì‡„ â”€â”€ */
@page {
  size: A4;
  margin: 14mm 14mm 22mm 14mm;
  @bottom-right {
    content: counter(page) " / " counter(pages);
    font-size: 9pt; color: #94a3b8;
    font-family: 'Noto Sans KR', sans-serif;
  }
}
@media print {
  * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
  .no-print { display:none !important; }
  body { background:white !important; }
  .page-container { padding: 0; }
  .strat-cover { border-radius:0; margin:0 0 20px; }
  .report-section { page-break-before: always; }
  .report-section:first-child { page-break-before: auto; }

  /* íƒ­ ë°” ì¸ì‡„ ìŠ¤íƒ€ì¼ */
  .candidate-tab-bar {
    border-radius: 0 !important;
    border-left: none !important;
    border-right: none !important;
    border-top: none !important;
    border-bottom: 2px solid #f8bbd0 !important;
    box-shadow: none !important;
    padding: 10px 0 10px !important;
    margin-bottom: 0 !important;
    background: linear-gradient(135deg, #fff0f5 0%, #fce4ec 100%) !important;
  }
  .cand-tab {
    border-radius: 6px !important;
    padding: 6px 14px !important;
  }
  /* ë¹„í™œì„± íƒ­ì€ íë¦¬ê²Œ */
  .cand-tab:not(.active) {
    opacity: 0.45;
  }
  /* í™œì„± íƒ­ì€ ì„ ëª…í•˜ê²Œ ê°•ì¡° */
  .cand-tab.active {
    box-shadow: 0 2px 8px rgba(0,0,0,0.12) !important;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì¸ì‡„ ì „ìš© í‘œì§€ + ëª©ì°¨
   í™”ë©´: display:none  /  ì¸ì‡„: display:flex (JS beforeprint ì œì–´)
   â€» ìì‹ ìŠ¤íƒ€ì¼ì€ ë°˜ë“œì‹œ @media print ë°–ì— ì„ ì–¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sc-print-cover { display: none; }
@media print {
  .sc-print-cover {
    display: flex !important;
    flex-direction: column;
    min-height: 95vh;
    break-after: page;
    page-break-after: always;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
}
.spc-title {
  background: linear-gradient(140deg,#0f172a 0%,#1e3a8a 55%,#1d4ed8 100%);
  padding: 48px 52px 40px;
  color: white;
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
  -webkit-print-color-adjust: exact;
  print-color-adjust: exact;
}
.spc-title::after {
  content: 'ğŸ†';
  font-size: 220px;
  position: absolute;
  right: 20px; top: 50%;
  transform: translateY(-50%);
  opacity: 0.05; line-height: 1; pointer-events: none;
}
.spc-eyebrow {
  display: inline-block;
  background: rgba(245,158,11,.18);
  border: 1px solid rgba(245,158,11,.45);
  color: #fcd34d;
  padding: 4px 14px; border-radius: 20px;
  font-size: 11px; font-weight: 700; letter-spacing: .5px; margin-bottom: 16px;
}
.spc-main-title {
  font-size: 36px; font-weight: 900; line-height: 1.2; margin-bottom: 10px;
}
.spc-main-title .spc-name { color: #fde047; }
.spc-subtitle {
  font-size: 13px; color: rgba(255,255,255,.7); line-height: 1.6; margin-bottom: 24px;
}
.spc-meta-row {
  display: flex; gap: 28px; align-items: center; flex-wrap: wrap;
}
.spc-meta-item { text-align: center; }
.spc-meta-num {
  font-size: 24px; font-weight: 900; color: #fcd34d;
  line-height: 1; margin-bottom: 3px; letter-spacing: -1px;
}
.spc-meta-label { font-size: 10px; color: rgba(255,255,255,.5); font-weight: 500; }
.spc-meta-div { width: 1px; height: 40px; background: rgba(255,255,255,.15); }
.spc-info-bar {
  background: #0a1628;
  padding: 11px 52px;
  display: flex; align-items: center; justify-content: space-between;
  font-size: 12px; color: rgba(255,255,255,.5); flex-shrink: 0;
  -webkit-print-color-adjust: exact; print-color-adjust: exact;
}
.spc-info-bar strong { color: rgba(255,255,255,.8); }
.spc-toc {
  flex: 1; background: #f8fafc;
  padding: 32px 52px 28px;
  -webkit-print-color-adjust: exact; print-color-adjust: exact;
}
.spc-toc-heading {
  font-size: 17px; font-weight: 900; color: #1e3a8a;
  margin-bottom: 5px;
  display: flex; align-items: center; gap: 10px;
}
.spc-toc-heading::after {
  content: ''; flex: 1; height: 2px;
  background: linear-gradient(90deg,#1e3a8a,transparent); border-radius: 1px;
}
.spc-toc-sub { font-size: 11px; color: #374151; margin-bottom: 20px; }
.spc-toc-list {
  display: grid; grid-template-columns: 1fr 1fr; gap: 9px 28px;
}
.spc-toc-item {
  display: flex; align-items: flex-start; gap: 11px;
  padding: 10px 14px; background: white;
  border: 1px solid #e2e8f0; border-radius: 8px;
  border-left: 4px solid #1e3a8a;
}
.spc-toc-item:nth-child(1) { border-left-color: #2563eb; }
.spc-toc-item:nth-child(2) { border-left-color: #7c3aed; }
.spc-toc-item:nth-child(3) { border-left-color: #dc2626; }
.spc-toc-item:nth-child(4) { border-left-color: #d97706; }
.spc-toc-item:nth-child(5) { border-left-color: #16a34a; }
.spc-toc-item:nth-child(6) { border-left-color: #0891b2; }
.spc-toc-item:nth-child(7) { border-left-color: #e11d48; }
.spc-toc-item:nth-child(8) { border-left-color: #f59e0b; }
.spc-toc-item:nth-child(9) { border-left-color: #6d28d9; }
.spc-toc-num {
  font-size: 11px; font-weight: 900; color: #6b7280;
  min-width: 22px; flex-shrink: 0; line-height: 1.4;
}
.spc-toc-title { font-size: 12px; font-weight: 800; color: #0f172a; line-height: 1.3; margin-bottom: 2px; }
.spc-toc-desc  { font-size: 10px; color: #374151; line-height: 1.5; }
.spc-footer {
  background: #0f172a;
  padding: 11px 52px;
  display: flex; align-items: center; justify-content: space-between;
  font-size: 11px; color: rgba(255,255,255,.4); flex-shrink: 0;
  -webkit-print-color-adjust: exact; print-color-adjust: exact;
}
.spc-footer strong { color: rgba(255,255,255,.65); }
.spc-footer-logo { font-size: 12px; font-weight: 900; color: white; }

/* â”€â”€ í™”ë©´ ëª©ì°¨ (íˆì–´ë¡œ ì•„ë˜) â”€â”€ */
.strat-toc {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 14px;
  overflow: hidden;
  margin-bottom: 28px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
}
.strat-toc-head {
  background: linear-gradient(90deg, #1e3a8a, #2563eb);
  padding: 16px 26px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.strat-toc-head-title { font-size: 15px; font-weight: 900; color: white; }
.strat-toc-head-sub   { font-size: 12px; color: rgba(255,255,255,.65); margin-left: auto; }
.strat-toc-body {
  padding: 18px 22px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 9px 22px;
}
@media (max-width: 600px) { .strat-toc-body { grid-template-columns: 1fr; } }
.strat-toc-item {
  display: flex;
  align-items: flex-start;
  gap: 11px;
  padding: 10px 13px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  border-left: 4px solid #1e3a8a;
  background: #fafafa;
}
.strat-toc-item:nth-child(1) { border-left-color: #2563eb; }
.strat-toc-item:nth-child(2) { border-left-color: #7c3aed; }
.strat-toc-item:nth-child(3) { border-left-color: #dc2626; }
.strat-toc-item:nth-child(4) { border-left-color: #d97706; }
.strat-toc-item:nth-child(5) { border-left-color: #16a34a; }
.strat-toc-item:nth-child(6) { border-left-color: #0891b2; }
.strat-toc-item:nth-child(7) { border-left-color: #e11d48; }
.strat-toc-item:nth-child(8) { border-left-color: #f59e0b; }
.strat-toc-item:nth-child(9) { border-left-color: #6d28d9; }
.strat-toc-num   { font-size: 11px; font-weight: 900; color: #6b7280; min-width: 22px; flex-shrink: 0; line-height: 1.4; }
.strat-toc-title { font-size: 12px; font-weight: 800; color: #0f172a; line-height: 1.3; margin-bottom: 2px; }
.strat-toc-desc  { font-size: 10px; color: #374151; line-height: 1.5; }

/* â”€â”€ í›„ë³´ íƒ­ ë°” â”€â”€ */
.candidate-tab-bar {
  display: flex;
  align-items: stretch;
  gap: 0;
  background: linear-gradient(135deg, #fff0f5 0%, #fce4ec 100%);
  border: 1px solid #f8bbd0;
  border-radius: 12px;
  padding: 10px 14px;
  margin-bottom: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  flex-wrap: wrap;
  gap: 6px;
}
.candidate-tab-bar .tab-group {
  display: flex;
  gap: 6px;
  flex: 1;
  flex-wrap: wrap;
}
.cand-tab {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  padding: 8px 18px;
  border-radius: 8px;
  border: 1.5px solid #e2e8f0;
  background: #f8fafc;
  cursor: pointer;
  transition: all 0.18s;
  min-width: 90px;
  position: relative;
  font-family: inherit;
}
.cand-tab:hover {
  background: #f1f5f9;
  border-color: #cbd5e1;
  transform: translateY(-1px);
}
.cand-tab.active {
  background: white;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  border-bottom-width: 3px;
}
.cand-tab .tab-rank {
  font-size: 10px;
  font-weight: 800;
  padding: 1px 7px;
  border-radius: 10px;
  background: #f1f5f9;
  color: #374151;
  margin-bottom: 1px;
}
.cand-tab.active .tab-rank {
  color: white;
}
.cand-tab .tab-name {
  font-size: 14px;
  font-weight: 800;
  color: #0f172a;
  white-space: nowrap;
}
.cand-tab .tab-party {
  font-size: 10px;
  color: #4b5563;
  white-space: nowrap;
}
.cand-tab.active .tab-name { color: inherit; }
.tab-pdf-btn {
  display: inline-flex;
  align-items: center;
  gap: 7px;
  background: #f59e0b;
  color: #1c1917;
  border: none;
  padding: 10px 22px;
  border-radius: 8px;
  font-family: inherit;
  font-size: 14px;
  font-weight: 800;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
  align-self: center;
  flex-shrink: 0;
}
.tab-pdf-btn:hover { background: #d97706; transform: translateY(-1px); }
</style>
</head>
<body>
<header class="app-header no-print">
  <div class="header-inner">
    <div class="header-logo">âš–ï¸ Election<span class="logo-analysis">Analysis</span><span class="logo-report">Report</span><span class="logo-ai">AI</span></div>
    <div class="header-subtitle">AI ê¸°ë°˜ ì„ ê±° í›„ë³´ì ë¹„êµ ë¶„ì„ í”Œë«í¼</div>
    <div class="header-date" id="header-date"></div>
  </div>
</header>
<nav class="main-nav no-print"><div class="nav-inner" id="main-nav"></div></nav>

<div class="page-container">
  <!-- í›„ë³´ íƒ­ ë°” (í™”ë©´ + PDF ëª¨ë‘ ì¶œë ¥ / PDF ë²„íŠ¼ë§Œ ì¸ì‡„ ì‹œ ìˆ¨ê¹€) -->
  <div class="candidate-tab-bar" id="candidate-tab-bar">
    <div class="tab-group" id="tab-group">
      <!-- JSë¡œ ë™ì  ìƒì„± -->
    </div>
    <button class="tab-pdf-btn no-print" onclick="printStrategy()">ğŸ“¥ PDF ì €ì¥</button>
  </div>

  <!-- â˜… ì¸ì‡„ ì „ìš© í‘œì§€ + ëª©ì°¨ (í™”ë©´ì—ì„œ ìˆ¨ê¹€, PDF ì²« í˜ì´ì§€ ì¶œë ¥) -->
  <div class="sc-print-cover" id="sc-print-cover">
    <div class="spc-title">
      <div class="spc-eyebrow" id="spc-eyebrow">AI ì„ ê±° ì „ëµ ì¸í…”ë¦¬ì „ìŠ¤ ë¦¬í¬íŠ¸</div>
      <div class="spc-main-title">
        <span class="spc-name" id="spc-name">â€”</span> í›„ë³´<br>03. ë‹¹ì„  ì „ëµ ì„¤ê³„ ë³´ê³ ì„œ
      </div>
      <div class="spc-subtitle">ê°ê´€ì  ë°ì´í„° ê¸°ë°˜ ë¶„ì„ Â· ê²½ìŸ í›„ë³´ ë§ì¶¤ ëŒ€ì‘ Â· 90ì¼ ì‹¤í–‰ ë¡œë“œë§µ Â· ë¦¬ìŠ¤í¬ ëŒ€ì‘ ë§¤ë‰´ì–¼</div>
      <div class="spc-meta-row">
        <div class="spc-meta-item">
          <div class="spc-meta-num" id="spc-score">â€”</div>
          <div class="spc-meta-label">ì¢…í•© ì ìˆ˜</div>
        </div>
        <div class="spc-meta-div"></div>
        <div class="spc-meta-item">
          <div class="spc-meta-num" id="spc-rank">â€”</div>
          <div class="spc-meta-label">í˜„ì¬ ìˆœìœ„</div>
        </div>
        <div class="spc-meta-div"></div>
        <div class="spc-meta-item">
          <div class="spc-meta-num">9</div>
          <div class="spc-meta-label">ë³´ê³ ì„œ ì„¹ì…˜</div>
        </div>
        <div class="spc-meta-div"></div>
        <div class="spc-meta-item">
          <div class="spc-meta-num">4</div>
          <div class="spc-meta-label">AI ëª¨ë¸ ë¶„ì„</div>
        </div>
      </div>
    </div>

    <div class="spc-info-bar">
      <span>ë°œí–‰: <strong>ì‹¬ì¬ìš° ëŒ€í‘œ</strong> Â· ElectionAnalysis Report AI</span>
      <span>ì„ ê±°êµ¬: <strong id="spc-district">â€”</strong> Â· ë¶„ì„ì¼: <strong id="spc-date">â€”</strong></span>
      <span>ë¬¸ì˜: <strong>010-2397-5734</strong></span>
    </div>

    <div class="spc-toc">
      <div class="spc-toc-heading">ëª© ì°¨</div>
      <div class="spc-toc-sub">ë‹¹ì„  ì „ëµ ì„¤ê³„ ë³´ê³ ì„œ êµ¬ì„± â€” ì´ 9ê°œ ì„¹ì…˜</div>
      <div class="spc-toc-list">
        <div class="spc-toc-item">
          <div class="spc-toc-num">01</div>
          <div>
            <div class="spc-toc-title">í¬ì§€ì…˜ ì§„ë‹¨</div>
            <div class="spc-toc-desc">í˜„ì¬ ìˆœìœ„Â·ê°•ì ì§€ìˆ˜Â·ë¦¬ìŠ¤í¬ì§€ìˆ˜Â·ë ˆì´ë” ì°¨íŠ¸</div>
          </div>
        </div>
        <div class="spc-toc-item">
          <div class="spc-toc-num">02</div>
          <div>
            <div class="spc-toc-title">ì „ëµ ìœ í˜• ì„¤ê³„</div>
            <div class="spc-toc-desc">ë°©ì–´Â·ì¶”ê²©Â·ë¦¬ë¹Œë”© ì „ëµ ë¶„ê¸° Â· ì¤‘ë„ì¸µ í¡ìˆ˜ ë°©ì•ˆ</div>
          </div>
        </div>
        <div class="spc-toc-item">
          <div class="spc-toc-num">03</div>
          <div>
            <div class="spc-toc-title">ê²½ìŸ í›„ë³´ ë§ì¶¤ ëŒ€ì‘</div>
            <div class="spc-toc-desc">í›„ë³´ë³„ ì•½ì  ê³µëµ Â· ì°¨ë³„í™” í¬ì§€ì…”ë‹ ì „ëµ</div>
          </div>
        </div>
        <div class="spc-toc-item">
          <div class="spc-toc-num">04</div>
          <div>
            <div class="spc-toc-title">ê²©ì°¨ ì›ì¸ ë¶„í•´</div>
            <div class="spc-toc-desc">í•­ëª©ë³„ ê²©ì°¨ ì›ì¸ ì§„ë‹¨ Â· ê°œì„  ì•¡ì…˜ í”Œëœ</div>
          </div>
        </div>
        <div class="spc-toc-item">
          <div class="spc-toc-num">05</div>
          <div>
            <div class="spc-toc-title">ì ìˆ˜ ê°œì„  ì‹œë®¬ë ˆì´ì…˜</div>
            <div class="spc-toc-desc">ì „ëµ ì‹¤í–‰ ì‹œ ì ìˆ˜ ë³€í™” Â· ìŠ¹ë¥  ìƒìŠ¹ ì˜ˆì¸¡</div>
          </div>
        </div>
        <div class="spc-toc-item">
          <div class="spc-toc-num">06</div>
          <div>
            <div class="spc-toc-title">ë©”ì‹œì§€ êµ¬ì¡° ì„¤ê³„</div>
            <div class="spc-toc-desc">í•µì‹¬ ìŠ¬ë¡œê±´ Â· ê¸ˆì§€ í‘œí˜„ Â· ìœ ê¶Œìë³„ ë§ì¶¤ ë©”ì‹œì§€</div>
          </div>
        </div>
        <div class="spc-toc-item">
          <div class="spc-toc-num">07</div>
          <div>
            <div class="spc-toc-title">ê³µê²©Â·ë°©ì–´ ì‹œë‚˜ë¦¬ì˜¤</div>
            <div class="spc-toc-desc">ì˜ˆìƒ ê³µê²© ë¦¬ìŠ¤íŠ¸ Â· ë°©ì–´ ë…¼ë¦¬ Â· ì—­ê³µ ì „ëµ</div>
          </div>
        </div>
        <div class="spc-toc-item">
          <div class="spc-toc-num">08</div>
          <div>
            <div class="spc-toc-title">90ì¼ ì‹¤í–‰ í”Œëœ</div>
            <div class="spc-toc-desc">ì£¼ì°¨ë³„ ìº í˜ì¸ ì¼ì • Â· ìº í”„ ì¡°ì§ë³„ ì—­í•  ë°°ë¶„</div>
          </div>
        </div>
        <div class="spc-toc-item">
          <div class="spc-toc-num">09</div>
          <div>
            <div class="spc-toc-title">ë¦¬ìŠ¤í¬ ëŒ€ì‘ ë§¤ë‰´ì–¼</div>
            <div class="spc-toc-desc">ìŠ¤ìº”ë“¤Â·ì´ìŠˆë³„ 24ì‹œê°„ ëŒ€ì‘ í”„ë¡œí† ì½œ</div>
          </div>
        </div>
      </div>
    </div>

    <div class="spc-footer">
      <div class="spc-footer-logo">Election<span style="color:#93c5fd">Analysis</span><span style="color:#86efac">Report</span><span style="color:#fcd34d">AI</span></div>
      <span>Â© 2026 ElectionAnalysisReportAI Â· ë¬´ë‹¨ ë³µì œ ë° ë°°í¬ ê¸ˆì§€ Â· Powered by Claude AI</span>
      <span>ë‹´ë‹¹: <strong>ì‹¬ì¬ìš°</strong> 010-2397-5734</span>
    </div>
  </div><!-- /sc-print-cover -->

  <div id="page-content"></div>

  <!-- ë¦¬í¬íŠ¸ í•˜ë‹¨ í‘¸í„° (í™”ë©´ + PDF ëª¨ë‘ ì¶œë ¥) -->
  <div class="report-print-footer">
    <div class="rpf-inner">
      <div class="rpf-brand">
        <div class="rpf-logo">âš–ï¸ Election<span class="logo-analysis">Analysis</span><span class="logo-report">Report</span><span class="logo-ai">AI</span></div>
        <div class="rpf-tagline">AI ê¸°ë°˜ ì„ ê±° í›„ë³´ì ë¹„êµ ë¶„ì„ í”Œë«í¼ Â· ë‹¹ì„  ì „ëµ ë³´ê³ ì„œ</div>
      </div>
      <div class="rpf-contact">
        <div class="rpf-contact-name">ì‹¬ì¬ìš° ëŒ€í‘œ</div>
        <div class="rpf-contact-items">
          <span>ğŸ“ 010-2397-5734</span>
          <span>âœ‰ï¸ jaiwshim@gmail.com</span>
        </div>
      </div>
    </div>
    <div class="rpf-bottom">
      <span>Â© 2026 ElectionAnalysisReportAI Â· ë¬´ë‹¨ ë³µì œ ë° ë°°í¬ ê¸ˆì§€</span>
      <span>Powered by Claude AI Â· ElectionAI Pricing Engine v1.0</span>
    </div>
  </div>
</div>

<script src="js/shared.js"></script>
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë©”íŠ¸ë¦­ ì›ì¸ ë°ì´í„°ë² ì´ìŠ¤
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const GAP_CAUSES = {
  ê³µìµì„±: {
    reasons: ['ì§€ì—­ ê³µìµ ì •ì±…ì˜ ëŒ€ì¤‘ ê°€ì‹œì„± ë¶€ì¡±','ì£¼ë¯¼ ì²´ê° ì„±ê³¼ í™ë³´ ë° ìŠ¤í† ë¦¬í…”ë§ ë¯¸í¡','ì†Œì™¸ ê³„ì¸µ ì§€ì› ì´ë ¥ ìˆ˜ì¹˜í™”Â·ê³µê°œ ë¶€ì¡±'],
    action: 'ê³µìµ ì„±ê³¼ ë°ì´í„°ë¥¼ ìŠ¤í† ë¦¬ í˜•ì‹ìœ¼ë¡œ SNSÂ·ì–¸ë¡ ì— ë°°í¬'
  },
  ì •ì±…ì‹¤í–‰ë ¥: {
    reasons: ['ê³µì•½ ì´í–‰ ì‹¤ì ì˜ êµ¬ì²´ì  ìˆ˜ì¹˜ ì œì‹œ ë¶€ì¡±','ì™„ë£Œëœ ì •ì±… ì„±ê³¼ë¥¼ ì‹œê°í™”í•œ ë°±ì„œ ë¯¸ë°œê°„','íƒ€ í›„ë³´ ëŒ€ë¹„ ì™„ë£Œìœ¨Â·ì†ë„ ë¹„êµ ìë£Œ ë¶€ì¬'],
    action: 'ê³µì•½ ì´í–‰ë¥  100ì¼ ë¦¬í¬íŠ¸ ë°œí–‰, ì™„ë£Œ ì‚¬ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸ ê³µê°œ'
  },
  ì „ë¬¸ì„±: {
    reasons: ['í•µì‹¬ ì •ì±… ë¶„ì•¼ ì „ë¬¸ ìê²©Â·ì´ë ¥ ê°•ì¡° ë¶€ì¡±','ì™¸ë¶€ ì „ë¬¸ê¸°ê´€ ê²€ì¦Â·ì¸ì¦ ì´ë ¥ ë¯¸ê³µê°œ','ì •ì±… ì—°êµ¬ ë°œí‘œÂ·ë…¼ë¬¸Â·ê¸°ê³  í™œë™ ë¶€ì¬'],
    action: 'ì „ë¬¸ì„± ì¦ë¹™ ìë£Œ ì§‘ì¤‘ ë°œí‘œ, ì „ë¬¸ê°€ ê·¸ë£¹ ê³µë™ ì •ì±… ë°œí‘œ'
  },
  ëŒ€ì‘ì„±: {
    reasons: ['ë¯¼ì›Â·ì´ìŠˆ ë°œìƒ ì‹œ ê³µì‹ ëŒ€ì‘ ì†ë„ ì§€ì—°','SNS ì‹¤ì‹œê°„ ì†Œí†µ ì±„ë„ í™œìš© ë¯¸í¡','í˜„ì¥ ë°©ë¬¸Â·ì¦‰ë‹µ ê¸°íšŒ ë¶€ì¡±'],
    action: '48ì‹œê°„ ë¯¼ì› ê³µì‹ ì‘ë‹µ ì²´ê³„ êµ¬ì¶•, ì£¼ê°„ í˜„ì¥ ë¼ì´ë¸Œ ì§„í–‰'
  },
  ì±…ì„ì„±: {
    reasons: ['ê³µì•½ ì´í–‰ í˜„í™© ì •ê¸° ê³µê°œ ë¶€ì¬','ì˜ˆì‚° ì§‘í–‰ ë‚´ì—­ íˆ¬ëª…ì„± ê³µê°œ ë¯¸í¡','ê³¼ê±° ì•½ì† ë¯¸ì´í–‰ ê±´ì— ëŒ€í•œ í•´ëª… ê³µê°œ ë¶€ì¬'],
    action: 'ê³µì•½ ì´í–‰ ëŒ€ì‹œë³´ë“œ ê³µê°œ, ë¶„ê¸°ë³„ ì±…ì„ ì´í–‰ ë³´ê³ ì„œ ë°œê°„'
  },
  ì†Œí†µëŠ¥ë ¥: {
    reasons: ['ìœ ê¶Œìì™€ì˜ ì§ì ‘ ì†Œí†µ í–‰ì‚¬(ê°„ë‹´íšŒÂ·íƒ€ìš´í™€) ë¹ˆë„ ë¶€ì¡±','SNS ëŒ“ê¸€Â·DM ì‘ë‹µë¥  ë‚®ìŒ','ì–¸ì–´Â·ë©”ì‹œì§€ ì¹œê·¼ì„± ê°œì„  í•„ìš”'],
    action: 'ì›” 2íšŒ ì§€ì—­êµ¬ íƒ€ìš´í™€ ê°œìµœ, SNS ì‘ë‹µë¥  ëª©í‘œì¹˜ ì„¤ì •'
  },
  ë¦¬ë”ì‹­: {
    reasons: ['ê²°ë‹¨ë ¥ ìˆëŠ” ì£¼ë„ ì‚¬ë¡€ ë¯¸ë¶€ê°','ìœ„ê¸° ìƒí™© ì„ ë„ ê²½í—˜ ìŠ¤í† ë¦¬í™” ë¶€ì¡±','ë¹„ì „ ì„ ì–¸ ë°œì–¸ì˜ ì–¸ë¡  ë…¸ì¶œ ë¹ˆë„ ë¶€ì¡±'],
    action: 'ë¦¬ë”ì‹­ ì‚¬ë¡€ ì¸í„°ë·° ê¸°ì‚¬ ë°°í¬, ë¹„ì „ ì„ ì–¸ í¼í¬ë¨¼ìŠ¤ ê¸°íš'
  },
  ë¹„ì „ëª…í™•ì„±: {
    reasons: ['ì¥ê¸° ë¹„ì „ ë©”ì‹œì§€ ëª¨í˜¸Â·ì¶”ìƒì ','êµ¬ì²´ì  ìˆ˜ì¹˜ ëª©í‘œ(5ë…„ í›„ ì§€ì—­ ë³€í™”) ë¯¸ì œì‹œ','ê²½ìŸ í›„ë³´ ëŒ€ë¹„ ë¹„ì „ ì°¨ë³„ì„± ì•½í•¨'],
    action: '"â—‹â—‹ë…„ê¹Œì§€ â—‹â—‹ë¥¼ â—‹â—‹% ë‹¬ì„±" ìˆ˜ì¹˜í˜• ë¹„ì „ ì„ ì–¸ ë°œí‘œ'
  },
  ì²­ë ´ì„±: {
    reasons: ['ì¬ì •Â·ì´í•´ê´€ê³„ íˆ¬ëª…ì„± ê³µê°œ ìë£Œ ë¶€ì¡±','ê¸°ë¶€Â·ë´‰ì‚¬ í™œë™ ì´ë ¥ í™ë³´ ë¯¸í¡','ì™¸ë¶€ ê°ì‚¬Â·í‰ê°€ ê²°ê³¼ ê³µê°œ ë¶€ì¬'],
    action: 'ì¬ì‚° ë‚´ì—­Â·ì´í•´ì¶©ëŒ ë°©ì§€ ì„œì•½ì„œ ê³µê°œ, ì²­ë ´ ì„œì•½ì‹ ë¯¸ë””ì–´ í™ë³´'
  },
  ìœ¤ë¦¬ì„±: {
    reasons: ['ì´í•´ì¶©ëŒ ì˜ˆë°© ì´ë ¥ ë° ìê¸°ê·œìœ¨ ê³µê°œ ë¶€ì¬','ê³¼ê±° ë…¼ë€ ì´ìŠˆì— ëŒ€í•œ ëª…í™•í•œ í•´ëª… ë¯¸í¡','ìœ¤ë¦¬ìœ„ì›íšŒ ê²€í† Â·ì¤€ìˆ˜ ì‹¤ì  ê³µê°œ ë¶€ì¡±'],
    action: 'í–‰ë™ê°•ë ¹ ê³µê°œ ì„œì•½, ìœ¤ë¦¬ ìë¬¸ë‹¨ êµ¬ì„± ë° ìš´ì˜ ê²°ê³¼ ê³µê°œ'
  }
};

const STRATEGY_TYPE = {
  1: {
    color: '#16a34a', bg: 'linear-gradient(135deg,#14532d,#16a34a)',
    icon: 'ğŸ›¡ï¸', title: '1ìœ„ ìœ ì§€ ë°©ì–´ ì „ëµ ë³´ê³ ì„œ',
    desc: 'í˜„ì¬ ì„ ë‘ ìœ„ì¹˜ë¥¼ ë°©ì–´í•˜ê³  ë¦¬ìŠ¤í¬ë¥¼ ì‚¬ì „ ì°¨ë‹¨í•©ë‹ˆë‹¤.',
    goal: 'ë¦¬ë“œ ìœ ì§€ + ì•½ì  ë…¸ì¶œ ì°¨ë‹¨ + ì§€ì§€ì¸µ ê³ ì •'
  },
  2: {
    color: '#d97706', bg: 'linear-gradient(135deg,#78350f,#d97706)',
    icon: 'âš¡', title: 'ì—­ì „ ì¶”ê²© ì „ëµ ë³´ê³ ì„œ',
    desc: '1ìœ„ì™€ì˜ ê²©ì°¨ë¥¼ ë¶„ì„í•˜ê³  ì—­ì „ ê°€ëŠ¥í•œ ì§€í‘œë¥¼ ê³µëµí•©ë‹ˆë‹¤.',
    goal: 'í•µì‹¬ ì§€í‘œ ì—­ì „ + ê²©ì°¨ ì¶•ì†Œ + ìŠ¹ë¶€ì²˜ ì§‘ì¤‘ ê³µëµ'
  },
  3: {
    color: '#7c3aed', bg: 'linear-gradient(135deg,#3b0764,#7c3aed)',
    icon: 'ğŸš€', title: 'í¬ì§€ì…˜ ë¦¬ë¹Œë”© ì „ëµ ë³´ê³ ì„œ',
    desc: 'ì°¨ë³„í™” í¬ì¸íŠ¸ë¥¼ ë°œêµ´í•˜ê³  ë‹¨ê¸° ë„ì•½ êµ¬ì¡°ë¥¼ ì„¤ê³„í•©ë‹ˆë‹¤.',
    goal: 'ì¸ì§€ë„ ì í”„ + ë©”ì‹œì§€ ì¬í¬ì§€ì…”ë‹ + íƒ€ê²Ÿ ìœ ê¶Œì ì§‘ì¤‘'
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì „ì—­ ìƒíƒœ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _stratData = null;   // ë¶„ì„ ë°ì´í„° ìºì‹œ
let _activeIdx = 0;      // í˜„ì¬ ì„ íƒëœ í›„ë³´ ì¸ë±ìŠ¤

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì´ˆê¸°í™”
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', () => {
  _stratData = requireData();
  if (!_stratData) return;

  const { candidates } = _stratData;

  // íƒ­ ë Œë”ë§
  renderTabs(candidates);

  // ì´ˆê¸° í›„ë³´ ì„ íƒ: localStorage ì €ì¥ê°’ ìš°ì„ , ì—†ìœ¼ë©´ 0
  const saved = getTargetIdx();
  const initIdx = (saved !== null && saved < candidates.length) ? saved : 0;
  selectCandidate(initIdx);
});

/* â”€â”€ íƒ­ ë Œë”ë§ â”€â”€ */
function renderTabs(candidates) {
  const sorted = [...candidates]
    .map((c, i) => ({ ...c, origIdx: i }))
    .sort((a, b) => b.total_score - a.total_score);

  const rankMap = {};
  sorted.forEach((c, r) => { rankMap[c.origIdx] = r + 1; });

  const tabGroup = document.getElementById('tab-group');
  tabGroup.innerHTML = candidates.map((c, i) => {
    const col = CANDIDATE_COLORS[i % 5];
    const rank = rankMap[i];
    const rankLabel = ['', '1ìœ„', '2ìœ„', '3ìœ„', '4ìœ„', '5ìœ„'][rank] || `${rank}ìœ„`;
    return `
      <button class="cand-tab" id="tab-${i}"
        onclick="selectCandidate(${i})"
        style="--tab-color:${col.border}">
        <span class="tab-rank">${rankLabel}</span>
        <span class="tab-name">${c.name}</span>
        <span class="tab-party">${c.party}</span>
      </button>`;
  }).join('');
}

/* â”€â”€ í›„ë³´ ì„ íƒ & ë³´ê³ ì„œ ë Œë”ë§ â”€â”€ */
function selectCandidate(idx) {
  if (!_stratData) return;
  _activeIdx = idx;
  setTargetIdx(idx);

  const { candidates, district, analysis_date } = _stratData;
  const target = candidates[idx];
  const col    = CANDIDATE_COLORS[idx % 5];

  const sorted = [...candidates]
    .map((c, i) => ({ ...c, origIdx: i }))
    .sort((a, b) => b.total_score - a.total_score);
  const rank    = sorted.findIndex(c => c.origIdx === idx) + 1;
  const leader  = sorted[0];
  const stratKey = rank === 1 ? 1 : rank === 2 ? 2 : 3;
  const strat   = STRATEGY_TYPE[stratKey];

  // â”€â”€ íƒ­ í™œì„±í™” ìŠ¤íƒ€ì¼ ê°±ì‹  â”€â”€
  document.querySelectorAll('.cand-tab').forEach((btn, i) => {
    const c = CANDIDATE_COLORS[i % 5];
    if (i === idx) {
      btn.classList.add('active');
      btn.style.borderColor = c.border;
      btn.style.borderBottomColor = c.border;
      btn.style.color = c.border;
      btn.querySelector('.tab-rank').style.background = c.border;
      btn.querySelector('.tab-rank').style.color = 'white';
    } else {
      btn.classList.remove('active');
      btn.style.borderColor = '#e2e8f0';
      btn.style.color = '';
      btn.querySelector('.tab-rank').style.background = '#f1f5f9';
      btn.querySelector('.tab-rank').style.color = '#374151';
    }
  });

  // â”€â”€ ë³´ê³ ì„œ HTML ìƒì„± â”€â”€
  const html =
    buildCover(target, col, rank, strat, district, analysis_date) +
    buildStratTOC(target, strat, district) +
    buildSection1_Position(target, col, rank, sorted, candidates) +
    buildSection2_Strategy(target, col, rank, strat, sorted, candidates) +
    buildSection3_CompetitorResponse(target, col, rank, sorted, candidates) +
    buildSection4_Causes(target, col, rank, leader, candidates) +
    buildSection5_Simulation(target, col, rank, sorted, candidates) +
    buildSection6_Message(target, col, rank, strat) +
    buildSection7_Attack(target, col, candidates) +
    buildSection8_Plan(target, col, rank, strat) +
    buildSection9_RiskManual(target, col);

  document.getElementById('page-content').innerHTML = html;
  renderRadar(target, col, candidates);

  // â”€â”€ PDF í‘œì§€ ë©”íƒ€ ë°ì´í„° ê°±ì‹  â”€â”€
  const rankLabel = ['', '1ìœ„', '2ìœ„', '3ìœ„', '4ìœ„', '5ìœ„'][rank] || `${rank}ìœ„`;
  const nameEl = document.getElementById('spc-name');
  if (nameEl) {
    nameEl.textContent = target.name;
    document.getElementById('spc-eyebrow').textContent  = `AI ì„ ê±° ì „ëµ ì¸í…”ë¦¬ì „ìŠ¤ ë¦¬í¬íŠ¸ Â· ${strat.title}`;
    document.getElementById('spc-score').textContent    = target.total_score ?? 'â€”';
    document.getElementById('spc-rank').textContent     = rankLabel;
    document.getElementById('spc-district').textContent = district || 'â€”';
    document.getElementById('spc-date').textContent     = analysis_date || 'â€”';
  }

  // ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* â”€â”€ í‘œì§€ â”€â”€ */
function buildCover(target, col, rank, strat, district, analysis_date) {
  const rankLabel = ['','1ìœ„','2ìœ„','3ìœ„','4ìœ„','5ìœ„'][rank];
  return `
  <div class="strat-cover">
    <div class="strat-label">AI ì„ ê±° ì „ëµ ì¸í…”ë¦¬ì „ìŠ¤ ë¦¬í¬íŠ¸ Â· ${strat.title}</div>
    <h1><span style="color:#fde047">${target.name}</span> í›„ë³´<br>03. ë‹¹ì„  ì „ëµ ì„¤ê³„ ë³´ê³ ì„œ</h1>
    <div class="subtitle">ê°ê´€ì  ë°ì´í„° ê¸°ë°˜ ë¶„ì„ Â· ê²½ìŸ í›„ë³´ ë§ì¶¤ ëŒ€ì‘ Â· 90ì¼ ì‹¤í–‰ ë¡œë“œë§µ Â· ë¦¬ìŠ¤í¬ ëŒ€ì‘ ë§¤ë‰´ì–¼</div>
    <div class="strat-cover-meta">
      <div class="strat-cover-meta-item">
        <div class="lbl">ëŒ€ìƒ í›„ë³´</div>
        <div class="val">${target.name} Â· ${target.party}</div>
      </div>
      <div class="strat-cover-meta-item">
        <div class="lbl">í˜„ì¬ ìˆœìœ„</div>
        <div class="val">${rankLabel} (${target.total_score}ì )</div>
      </div>
      <div class="strat-cover-meta-item">
        <div class="lbl">ì„ ê±°êµ¬</div>
        <div class="val">${district || 'â€”'}</div>
      </div>
      <div class="strat-cover-meta-item">
        <div class="lbl">ë¶„ì„ ì¼ì</div>
        <div class="val">${analysis_date || new Date().toISOString().split('T')[0]}</div>
      </div>
      <div class="strat-cover-meta-item">
        <div class="lbl">ë³´ê³ ì„œ êµ¬ì„±</div>
        <div class="val">9ê°œ ì„¹ì…˜ Â· ì „ëµ ì„¤ê³„ ì™„ì„±í˜•</div>
      </div>
    </div>
  </div>`;
}

/* â”€â”€ í™”ë©´ ëª©ì°¨ (íˆì–´ë¡œ ì•„ë˜) â”€â”€ */
function buildStratTOC(target, strat, district) {
  return `
  <div class="strat-toc">
    <div class="strat-toc-head">
      <div class="strat-toc-head-title">ğŸ“‹ ëª© ì°¨</div>
      <div class="strat-toc-head-sub">${target.name} Â· ${strat.title} Â· ì´ 9ê°œ ì„¹ì…˜</div>
    </div>
    <div class="strat-toc-body">
      <div class="strat-toc-item">
        <div class="strat-toc-num">01</div>
        <div><div class="strat-toc-title">í¬ì§€ì…˜ ì§„ë‹¨</div>
        <div class="strat-toc-desc">í˜„ì¬ ìˆœìœ„Â·ê°•ì ì§€ìˆ˜Â·ë¦¬ìŠ¤í¬ì§€ìˆ˜Â·ë ˆì´ë” ì°¨íŠ¸</div></div>
      </div>
      <div class="strat-toc-item">
        <div class="strat-toc-num">02</div>
        <div><div class="strat-toc-title">ì „ëµ ìœ í˜• ì„¤ê³„</div>
        <div class="strat-toc-desc">ë°©ì–´Â·ì¶”ê²©Â·ë¦¬ë¹Œë”© ì „ëµ ë¶„ê¸° Â· ì¤‘ë„ì¸µ í¡ìˆ˜ ë°©ì•ˆ</div></div>
      </div>
      <div class="strat-toc-item">
        <div class="strat-toc-num">03</div>
        <div><div class="strat-toc-title">ê²½ìŸ í›„ë³´ ë§ì¶¤ ëŒ€ì‘</div>
        <div class="strat-toc-desc">í›„ë³´ë³„ ì•½ì  ê³µëµ Â· ì°¨ë³„í™” í¬ì§€ì…”ë‹ ì „ëµ</div></div>
      </div>
      <div class="strat-toc-item">
        <div class="strat-toc-num">04</div>
        <div><div class="strat-toc-title">ê²©ì°¨ ì›ì¸ ë¶„í•´</div>
        <div class="strat-toc-desc">í•­ëª©ë³„ ê²©ì°¨ ì›ì¸ ì§„ë‹¨ Â· ê°œì„  ì•¡ì…˜ í”Œëœ</div></div>
      </div>
      <div class="strat-toc-item">
        <div class="strat-toc-num">05</div>
        <div><div class="strat-toc-title">ì ìˆ˜ ê°œì„  ì‹œë®¬ë ˆì´ì…˜</div>
        <div class="strat-toc-desc">ì „ëµ ì‹¤í–‰ ì‹œ ì ìˆ˜ ë³€í™” Â· ìŠ¹ë¥  ìƒìŠ¹ ì˜ˆì¸¡</div></div>
      </div>
      <div class="strat-toc-item">
        <div class="strat-toc-num">06</div>
        <div><div class="strat-toc-title">ë©”ì‹œì§€ êµ¬ì¡° ì„¤ê³„</div>
        <div class="strat-toc-desc">í•µì‹¬ ìŠ¬ë¡œê±´ Â· ê¸ˆì§€ í‘œí˜„ Â· ìœ ê¶Œìë³„ ë§ì¶¤ ë©”ì‹œì§€</div></div>
      </div>
      <div class="strat-toc-item">
        <div class="strat-toc-num">07</div>
        <div><div class="strat-toc-title">ê³µê²©Â·ë°©ì–´ ì‹œë‚˜ë¦¬ì˜¤</div>
        <div class="strat-toc-desc">ì˜ˆìƒ ê³µê²© ë¦¬ìŠ¤íŠ¸ Â· ë°©ì–´ ë…¼ë¦¬ Â· ì—­ê³µ ì „ëµ</div></div>
      </div>
      <div class="strat-toc-item">
        <div class="strat-toc-num">08</div>
        <div><div class="strat-toc-title">90ì¼ ì‹¤í–‰ í”Œëœ</div>
        <div class="strat-toc-desc">ì£¼ì°¨ë³„ ìº í˜ì¸ ì¼ì • Â· ìº í”„ ì¡°ì§ë³„ ì—­í•  ë°°ë¶„</div></div>
      </div>
      <div class="strat-toc-item">
        <div class="strat-toc-num">09</div>
        <div><div class="strat-toc-title">ë¦¬ìŠ¤í¬ ëŒ€ì‘ ë§¤ë‰´ì–¼</div>
        <div class="strat-toc-desc">ìŠ¤ìº”ë“¤Â·ì´ìŠˆë³„ 24ì‹œê°„ ëŒ€ì‘ í”„ë¡œí† ì½œ</div></div>
      </div>
    </div>
  </div>`;
}

/* â”€â”€ Section 1: í¬ì§€ì…˜ ì§„ë‹¨ â”€â”€ */
function buildSection1_Position(target, col, rank, sorted, candidates) {
  const n = candidates.length;
  const leader = sorted[0];
  const gapToLeader = target.total_score - leader.total_score;

  const metScores = METRICS.map(m => target.metrics?.[m] ?? 0);
  const avgAll = metScores.reduce((a,b)=>a+b,0) / metScores.length;
  const top3 = [...metScores].sort((a,b)=>b-a).slice(0,3);
  const bot3 = [...metScores].sort((a,b)=>a-b).slice(0,3);
  const strengthIdx = Math.round((top3.reduce((a,b)=>a+b,0)/3 - avgAll + 30) / 60 * 100);
  const riskIdx = Math.round((avgAll - bot3.reduce((a,b)=>a+b,0)/3) / avgAll * 100);

  const metricRanks = METRICS.map(m => {
    const sc = target.metrics?.[m] ?? 0;
    const others = candidates.map(c => c.metrics?.[m] ?? 0);
    return others.filter(s => s > sc).length + 1;
  });
  const avg1stCount = metricRanks.filter(r => r === 1).length;
  const rankLabel = ['','1ìœ„','2ìœ„','3ìœ„','4ìœ„','5ìœ„'][rank];

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#1e3a8a,#1d4ed8)">
      <div class="s-num">1</div>ğŸ“ í¬ì§€ì…˜ ì •ë°€ ì§„ë‹¨
    </div>

    <div class="pos-grid">
      <div class="pos-card">
        <div class="pc-label">ì¢…í•© ìˆœìœ„</div>
        <div class="pc-val" style="color:${col.border}">${rankLabel}</div>
        <div class="pc-sub">${n}ëª… ì¤‘</div>
      </div>
      <div class="pos-card">
        <div class="pc-label">ì¢…í•© ì ìˆ˜</div>
        <div class="pc-val" style="color:${col.border}">${target.total_score}</div>
        <div class="pc-sub">/ 1000ì </div>
      </div>
      <div class="pos-card">
        <div class="pc-label">1ìœ„ ëŒ€ë¹„ ê²©ì°¨</div>
        <div class="pc-val" style="color:${gapToLeader===0?'#16a34a':'#dc2626'}">
          ${gapToLeader === 0 ? '0' : gapToLeader}
        </div>
        <div class="pc-sub">ì  ${gapToLeader===0?'(ì„ ë‘)':'ì°¨ì´'}</div>
      </div>
      <div class="pos-card">
        <div class="pc-label">í•­ëª© 1ìœ„ ìˆ˜</div>
        <div class="pc-val" style="color:${col.border}">${avg1stCount}</div>
        <div class="pc-sub">/ 10ê°œ í•­ëª©</div>
      </div>
      <div class="pos-card">
        <div class="pc-label">ê°•ì  ìœ ì§€ ì§€ìˆ˜</div>
        <div class="pc-val" style="color:${strengthIdx>=70?'#16a34a':strengthIdx>=50?'#d97706':'#dc2626'}">${strengthIdx}</div>
        <div class="pc-sub">/ 100ì </div>
      </div>
      <div class="pos-card">
        <div class="pc-label">ì•½ì  ë¦¬ìŠ¤í¬ ì§€ìˆ˜</div>
        <div class="pc-val" style="color:${riskIdx>=40?'#dc2626':riskIdx>=25?'#d97706':'#16a34a'}">${riskIdx}</div>
        <div class="pc-sub">/ 100ì  (ë‚®ì„ìˆ˜ë¡ ì•ˆì „)</div>
      </div>
    </div>

    <div class="two-col" style="display:grid;grid-template-columns:1fr 1fr;gap:18px">
      <div class="card" style="padding:18px">
        <div class="card-title" style="font-size:13px">ğŸ•¸ï¸ 10ê°œ í•­ëª© ìƒëŒ€ ìœ„ì¹˜</div>
        <div style="height:260px"><canvas id="stratRadar"></canvas></div>
      </div>
      <div class="card" style="padding:18px">
        <div class="card-title" style="font-size:13px">ğŸ“Š ê°•ì Â·ë¦¬ìŠ¤í¬ ë¶„í¬</div>
        <div class="index-bars">
          ${METRICS.map((m,i) => {
            const s = target.metrics?.[m] ?? 0;
            const isTop = metricRanks[i] === 1;
            const isBot = metricRanks[i] === n;
            const fillColor = isTop ? '#16a34a' : isBot ? '#dc2626' : col.border;
            return `<div class="index-bar-row">
              <div class="index-bar-label" style="color:${fillColor};font-size:11px">${METRIC_LABELS[m]}</div>
              <div class="index-bar-track">
                <div class="index-bar-fill" style="width:${s}%;background:${fillColor}"></div>
              </div>
              <div class="index-bar-val" style="color:${fillColor}">${s}</div>
            </div>`;
          }).join('')}
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">ğŸ“‹ í›„ë³´ì ê°„ ì¢…í•© ìˆœìœ„ í˜„í™©</div>
      <div class="table-wrap"><table>
        <thead><tr><th>ìˆœìœ„</th><th>í›„ë³´ì</th><th>ì •ë‹¹</th><th>ì¢…í•© ì ìˆ˜</th><th>${target.name} ëŒ€ë¹„</th><th>ê²©ì°¨</th></tr></thead>
        <tbody>
          ${sorted.map((c, r) => {
            const isTarget = candidates[c.origIdx] === target;
            const gap = c.total_score - target.total_score;
            const cCol = CANDIDATE_COLORS[c.origIdx % 5];
            return `<tr style="${isTarget?`background:${col.light}`:''}">
              <td>${rankTag(r+1)}</td>
              <td style="font-weight:700;color:${cCol.border}">${c.name}${isTarget?' â˜…':''}</td>
              <td style="font-size:12px;color:var(--text-muted)">${c.party}</td>
              <td style="font-weight:800">${c.total_score}ì </td>
              <td style="font-weight:700;color:${gap===0?'var(--text-muted)':gap>0?'#dc2626':'#16a34a'}">
                ${gap===0?'â€” ë³¸ì¸':gap>0?`+${gap}ì  ìš°ìœ„`:`${gap}ì  ì—´ì„¸`}
              </td>
              <td style="font-size:12px;color:var(--text-muted)">${r+1}ìœ„</td>
            </tr>`;
          }).join('')}
        </tbody>
      </table></div>
    </div>
    ${(()=>{
      const rankLabel=['','1ìœ„','2ìœ„','3ìœ„','4ìœ„','5ìœ„'][rank];
      const gapToLeader = target.total_score - sorted[0].total_score;
      const metScores = METRICS.map(m=>({m,s:target.metrics?.[m]??0}));
      const topM = [...metScores].sort((a,b)=>b.s-a.s).slice(0,3).map(x=>METRIC_LABELS[x.m]).join(', ');
      const botM = [...metScores].sort((a,b)=>a.s-b.s).slice(0,2).map(x=>METRIC_LABELS[x.m]).join(', ');
      return summaryBox('í¬ì§€ì…˜ ì§„ë‹¨ ì¢…í•© ì„¤ëª…', [
        `<strong>${target.name}</strong>(${target.party})ì€(ëŠ”) í˜„ì¬ ${candidates.length}ëª… ì¤‘ <strong>${rankLabel}(${target.total_score}ì )</strong>ì„ ê¸°ë¡í•˜ê³  ìˆìŠµë‹ˆë‹¤. 1ìœ„ì™€ì˜ ì ìˆ˜ ê²©ì°¨ëŠ” <strong>${Math.abs(gapToLeader)}ì </strong>ìœ¼ë¡œ, ${gapToLeader===0?'í˜„ì¬ ì„ ë‘ë¥¼ ë‹¬ë¦¬ê³  ìˆì–´ ë¦¬ë“œ ìœ ì§€ ì „ëµì´ í•µì‹¬ì…ë‹ˆë‹¤.':Math.abs(gapToLeader)<=20?'ì†Œìˆ˜ í•­ëª©ì˜ ì§‘ì¤‘ ê°œì„ ìœ¼ë¡œ ì—­ì „ì´ ê°€ëŠ¥í•œ ë²”ìœ„ì— ìˆìŠµë‹ˆë‹¤.':'ìƒë‹¹í•œ ê²©ì°¨ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ ì „ëµì  í¬ì§€ì…”ë‹ê³¼ í•µì‹¬ í•­ëª© ì§‘ì¤‘ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.'}`,
        `ê°•ì  í•­ëª©ì€ <strong>${topM}</strong>ìœ¼ë¡œ, ì´ ì˜ì—­ì—ì„œì˜ ìš°ìœ„ë¥¼ ìœ ê¶Œì ì†Œí†µì— ì ê·¹ í™œìš©í•´ì•¼ í•©ë‹ˆë‹¤. ê°œì„  í•„ìš” í•­ëª©ì¸ <strong>${botM}</strong>ì€ ìƒëŒ€ í›„ë³´ì˜ ê³µì„¸ ëŒ€ìƒì´ ë  ìˆ˜ ìˆì–´ ì‚¬ì „ ë°©ì–´ ì „ëµ ìˆ˜ë¦½ì´ í•„ìš”í•©ë‹ˆë‹¤. ê°•ì  ìœ ì§€ ì§€ìˆ˜ì™€ ì•½ì  ë¦¬ìŠ¤í¬ ì§€ìˆ˜ë¥¼ í•¨ê»˜ í™•ì¸í•˜ì—¬ ë°©ì–´ì™€ ê³µì„¸ì˜ ê· í˜•ì„ ì„¤ì •í•˜ì‹­ì‹œì˜¤.`,
        `ë ˆì´ë” ì°¨íŠ¸ì—ì„œ ${target.name}ì˜ ë‹¤ê°í˜•ì´ ê²½ìŸ í›„ë³´(ì ì„ ) ëŒ€ë¹„ ë„“ê²Œ í¼ì³ì§„ í•­ëª©ì´ í•µì‹¬ ì°¨ë³„í™” ì˜ì—­ì´ë©°, ë°˜ëŒ€ë¡œ ì¢ì•„ì§„ í•­ëª©ì€ ì§‘ì¤‘ ë³´ê°•ì´ í•„ìš”í•œ ì·¨ì•½ì ì…ë‹ˆë‹¤. í•­ëª©ë³„ ê°•ì Â·ë¦¬ìŠ¤í¬ ë°” ì°¨íŠ¸ì—ì„œ ì´ˆë¡ ë§‰ëŒ€(1ìœ„ í•­ëª©)ëŠ” ì„ ê±° ë©”ì‹œì§€ì˜ í•µì‹¬ ì†Œì¬ë¡œ, ë¹¨ê°„ ë§‰ëŒ€(ìµœí•˜ìœ„ í•­ëª©)ëŠ” ë¦¬ìŠ¤í¬ ê´€ë¦¬ ëŒ€ìƒìœ¼ë¡œ ë¶„ë¥˜í•˜ì‹­ì‹œì˜¤.`,
        `í›„ë³´ì ê°„ ì¢…í•© ìˆœìœ„ í˜„í™© í…Œì´ë¸”ì€ ê° ê²½ìŸ í›„ë³´ì™€ì˜ ì ìˆ˜ ì°¨ì´ë¥¼ ëª…í™•íˆ ë³´ì—¬ì¤ë‹ˆë‹¤. ìš°ìœ„ì¸ í›„ë³´ì™€ëŠ” í˜„ì¬ ë¦¬ë“œë¥¼ ë°©ì–´í•˜ê³ , ì—´ì„¸ì¸ í›„ë³´ì™€ëŠ” ì—­ì „ ê°€ëŠ¥í•œ í•­ëª©ì„ ì°¾ëŠ” ë°©ì‹ìœ¼ë¡œ ì „ëµì„ ë¶„í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í¬ì§€ì…˜ ì§„ë‹¨ì€ ì´í•˜ ëª¨ë“  ì „ëµ ì„¹ì…˜ì˜ ì¶œë°œì ì´ ë©ë‹ˆë‹¤.`
      ]);
    })()}
  </div>`;
}

/* â”€â”€ Section 2: ì „ëµ ìœ í˜• ë¶„ê¸° + ì¤‘ë„ì¸µ í¡ìˆ˜ â”€â”€ */
function buildSection2_Strategy(target, col, rank, strat, sorted, candidates) {
  const leader = sorted[0];
  let stratContent = '';

  if (rank === 1) {
    const metScores = METRICS.map(m => ({ m, s: target.metrics?.[m]??0 })).sort((a,b)=>a.s-b.s);
    const vulnerable = metScores.slice(0,3);
    const challenger = sorted[1];

    stratContent = `
    <div class="card">
      <div class="card-title">ğŸ›¡ï¸ 1ìœ„ ë°©ì–´ í•µì‹¬ ì „ëµ</div>
      <div class="insight-box" style="background:#f0fdf4;border-color:#86efac;color:#14532d;margin-bottom:14px">
        <strong>${target.name}</strong>ì€(ëŠ”) í˜„ì¬ ì„ ë‘ì…ë‹ˆë‹¤. ëª©í‘œëŠ” <strong>ë¦¬ë“œ ìœ ì§€ + ì•½ì  ë…¸ì¶œ ì°¨ë‹¨ + ì§€ì§€ì¸µ ê³ ì •</strong>ì…ë‹ˆë‹¤.
        2ìœ„ ${challenger?.name}(${challenger?.total_score}ì )ê³¼ì˜ ê²©ì°¨ëŠ” <strong>${target.total_score - (challenger?.total_score||0)}ì </strong>ì…ë‹ˆë‹¤.
      </div>
      <div class="table-wrap"><table>
        <thead><tr><th>ì „ëµ ì˜ì—­</th><th>ì„¸ë¶€ ë‚´ìš©</th><th>ìš°ì„ ìˆœìœ„</th></tr></thead>
        <tbody>
          <tr><td><strong>ì•½ì  ì°¨ë‹¨</strong></td><td>${vulnerable.map(x=>METRIC_LABELS[x.m]).join(', ')} ì ìˆ˜ ë°©ì–´ ì§‘ì¤‘</td><td><span style="color:#dc2626;font-weight:700">ğŸ”´ ì¦‰ì‹œ</span></td></tr>
          <tr><td><strong>ê³µê²© ì˜ˆì¸¡</strong></td><td>2ìœ„ ${challenger?.name} ì¸¡ ì˜ˆìƒ ê³µê²© í¬ì¸íŠ¸ ì‚¬ì „ ëŒ€ì‘</td><td><span style="color:#dc2626;font-weight:700">ğŸ”´ ì¦‰ì‹œ</span></td></tr>
          <tr><td><strong>ì§€ì§€ì¸µ ê³ ì •</strong></td><td>í•µì‹¬ ì§€ì§€ì¸µ ëŒ€ìƒ ê°ì‚¬ ì†Œí†µ, ê²°ì§‘ ì´ë²¤íŠ¸</td><td><span style="color:#d97706;font-weight:700">ğŸŸ¡ 2ì£¼ ë‚´</span></td></tr>
          <tr><td><strong>ì¤‘ë„ì¸µ ê´€ë¦¬</strong></td><td>í˜„ì•ˆ ì´ìŠˆ ì¤‘ë„ì  ì…ì¥ ëª…í™•í™”</td><td><span style="color:#d97706;font-weight:700">ğŸŸ¡ 2ì£¼ ë‚´</span></td></tr>
          <tr><td><strong>ì‹¤ìˆ˜ ìµœì†Œí™”</strong></td><td>ë°œì–¸Â·SNS ì‚¬ì „ ê²€í†  ì²´ê³„ ê°•í™”</td><td><span style="color:#16a34a;font-weight:700">ğŸŸ¢ ì§€ì†</span></td></tr>
        </tbody>
      </table></div>
    </div>
    <div class="card">
      <div class="card-title">âš ï¸ ë…¸ì¶œ ì·¨ì•½ ì§€í‘œ (ë°©ì–´ ìš°ì„ ìˆœìœ„)</div>
      ${vulnerable.map(x => `
        <div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid #f1f5f9">
          <span style="width:90px;font-weight:700;font-size:13px">${METRIC_LABELS[x.m]}</span>
          <div style="flex:1;height:8px;background:#f1f5f9;border-radius:4px;overflow:hidden">
            <div style="width:${x.s}%;height:100%;background:#dc2626;border-radius:4px"></div>
          </div>
          <span style="color:#dc2626;font-weight:700">${x.s}ì  â€” ë°©ì–´ í•„ìš”</span>
        </div>`).join('')}
    </div>`;

  } else if (rank === 2) {
    const gapToLeader = leader.total_score - target.total_score;
    const overturnTargets = METRICS.map(m => ({
      m,
      myScore: target.metrics?.[m]??0,
      leaderScore: leader.metrics?.[m]??0,
      gap: (leader.metrics?.[m]??0) - (target.metrics?.[m]??0)
    })).filter(x => x.gap <= 3 && x.gap >= 0).slice(0, 4);

    stratContent = `
    <div class="card">
      <div class="card-title">âš¡ ì—­ì „ ì¶”ê²© í•µì‹¬ ì „ëµ</div>
      <div class="insight-box" style="background:#fffbeb;border-color:#fcd34d;color:#92400e;margin-bottom:14px">
        <strong>1ìœ„ ${leader.name}(${leader.total_score}ì )</strong>ê³¼ì˜ ê²©ì°¨ëŠ” <strong>${gapToLeader}ì </strong>ì…ë‹ˆë‹¤.
        ì—­ì „ì— í•„ìš”í•œ í•µì‹¬ ì§€í‘œë¥¼ ì§‘ì¤‘ ê³µëµí•˜ì—¬ ê²©ì°¨ë¥¼ ì¤„ì´ëŠ” ì „ëµì´ í•µì‹¬ì…ë‹ˆë‹¤.
      </div>
      <div class="table-wrap"><table>
        <thead><tr><th>ì „ëµ ì˜ì—­</th><th>ì„¸ë¶€ ë‚´ìš©</th><th>ê¸°ëŒ€ íš¨ê³¼</th></tr></thead>
        <tbody>
          <tr><td><strong>ê²©ì°¨ ì—­ì „</strong></td><td>1ìœ„ ëŒ€ë¹„ ì°¨ì´ 3ì  ì´ë‚´ í•­ëª© ì§‘ì¤‘ ê³µëµ</td><td>í•­ëª© 1ìœ„ ì „í™˜</td></tr>
          <tr><td><strong>ì•½ì  ë³´ì™„</strong></td><td>ìµœí•˜ìœ„ 2ê°œ í•­ëª© ë‹¨ê¸° ê°œì„  ì§‘ì¤‘</td><td>ì¢…í•© ì ìˆ˜ +${Math.round(gapToLeader*0.4)}ì  ëª©í‘œ</td></tr>
          <tr><td><strong>1ìœ„ ëŒ€ë¹„ ì°¨ë³„í™”</strong></td><td>${target.name}ë§Œì˜ ê°•ì  í•­ëª© ê·¹ëŒ€í™” í™ë³´</td><td>ì§€ì§€ì¸µ ì „í™˜ ìœ ë„</td></tr>
          <tr><td><strong>ì´ìŠˆ ì„ ì </strong></td><td>ì§€ì—­ í˜„ì•ˆ ì´ìŠˆ ì„ ì œ ëŒ€ì‘, í”„ë ˆì„ ì„ ì </td><td>ì–¸ë¡  ë…¸ì¶œ ì¦ê°€</td></tr>
        </tbody>
      </table></div>
    </div>
    ${overturnTargets.length > 0 ? `
    <div class="card">
      <div class="card-title">ğŸ¯ ì—­ì „ ê°€ëŠ¥ ì§€í‘œ (1ìœ„ ëŒ€ë¹„ 3ì  ì´ë‚´ í•­ëª©)</div>
      <div class="insight-box" style="margin-bottom:12px">ì´ í•­ëª©ë“¤ì€ ì†Œê·œëª¨ ì§‘ì¤‘ ë…¸ë ¥ìœ¼ë¡œ 1ìœ„ ì—­ì „ì´ ê°€ëŠ¥í•œ "ìŠ¹ë¶€ì²˜"ì…ë‹ˆë‹¤.</div>
      ${overturnTargets.map(x => `
        <div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid #f1f5f9">
          <span style="width:90px;font-weight:700;font-size:13px">${METRIC_LABELS[x.m]}</span>
          <span style="color:#d97706;font-weight:700;width:80px">${target.name}: ${x.myScore}</span>
          <span style="color:var(--text-muted);font-size:12px">vs</span>
          <span style="color:var(--text-muted);font-size:12px">${leader.name}: ${x.leaderScore}</span>
          <span style="margin-left:auto;color:#dc2626;font-weight:700">ê²©ì°¨ ${x.gap}ì  â†’ ì—­ì „ ëª©í‘œ</span>
        </div>`).join('')}
    </div>` : ''}`;

  } else {
    const uniqueStrength = METRICS.map(m => ({
      m, s: target.metrics?.[m]??0,
      avgOthers: candidates.filter((_,i)=>candidates[i]!==target).reduce((a,c)=>(c.metrics?.[m]??0)+a,0)/(candidates.length-1)
    })).sort((a,b)=>(b.s-b.avgOthers)-(a.s-a.avgOthers)).slice(0,3);

    stratContent = `
    <div class="card">
      <div class="card-title">ğŸš€ í¬ì§€ì…˜ ë¦¬ë¹Œë”© í•µì‹¬ ì „ëµ</div>
      <div class="insight-box" style="background:#faf5ff;border-color:#c4b5fd;color:#4c1d95;margin-bottom:14px">
        í˜„ì¬ ${rank}ìœ„ êµ¬ì¡°ì—ì„œ ë‹¨ê¸° ë„ì•½ì„ ìœ„í•´ì„œëŠ” <strong>ì°¨ë³„í™” í¬ì¸íŠ¸ ê·¹ëŒ€í™”</strong>ì™€
        <strong>íƒ€ê²Ÿ ìœ ê¶Œì ì„¸ë¶„í™” ì§‘ì¤‘</strong> ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.
      </div>
      <div class="table-wrap"><table>
        <thead><tr><th>ì „ëµ ì˜ì—­</th><th>ì„¸ë¶€ ë‚´ìš©</th><th>ê¸°ê°„</th></tr></thead>
        <tbody>
          <tr><td><strong>ì°¨ë³„í™” í¬ì¸íŠ¸</strong></td><td>${uniqueStrength.map(x=>METRIC_LABELS[x.m]).join(', ')} ì§‘ì¤‘ ë¶€ê°</td><td>ì¦‰ì‹œ</td></tr>
          <tr><td><strong>íƒ€ê²Ÿ ì••ì¶•</strong></td><td>í•µì‹¬ ì§€ì§€ ê°€ëŠ¥ ìœ ê¶Œìì¸µ 3ê°œ ê·¸ë£¹ ì„ ì • ì§‘ì¤‘</td><td>1ì£¼ ë‚´</td></tr>
          <tr><td><strong>ë©”ì‹œì§€ ì¬ì •ì˜</strong></td><td>ê¸°ì¡´ ë©”ì‹œì§€ íê¸° í›„ ë‹¨ë¬¸Â·ê°ì„± ë©”ì‹œì§€ë¡œ ì „í™˜</td><td>1ì£¼ ë‚´</td></tr>
          <tr><td><strong>SNS ë„ì•½</strong></td><td>ë°”ì´ëŸ´ ì½˜í…ì¸  ì§‘ì¤‘ ì œì‘, ì´ìŠˆ ì„ ì  ì‹œë„</td><td>2ì£¼ ë‚´</td></tr>
          <tr><td><strong>ì—°ëŒ€ ì „ëµ</strong></td><td>ì§€ì—­ ì¸ì‚¬Â·ë‹¨ì²´ì™€ ê³µë™ í–‰ë³´ ê¸°íš</td><td>2ì£¼ ë‚´</td></tr>
        </tbody>
      </table></div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ’ íƒ€ í›„ë³´ ëŒ€ë¹„ ì°¨ë³„í™” ê°•ì  í•­ëª©</div>
      ${uniqueStrength.map(x => `
        <div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid #f1f5f9">
          <span style="width:90px;font-weight:700;font-size:13px">${METRIC_LABELS[x.m]}</span>
          <div style="flex:1;height:8px;background:#f1f5f9;border-radius:4px;overflow:hidden">
            <div style="width:${x.s}%;height:100%;background:${col.border};border-radius:4px"></div>
          </div>
          <span style="color:${col.border};font-weight:700">${x.s}ì </span>
          <span style="font-size:11px;color:#16a34a;font-weight:700">íƒ€í›„ë³´ í‰ê·  ëŒ€ë¹„ +${(x.s-x.avgOthers).toFixed(1)}</span>
        </div>`).join('')}
    </div>`;
  }

  // ì¤‘ë„ì¸µ í¡ìˆ˜ ì „ëµ (ëª¨ë“  ìˆœìœ„ ê³µí†µ)
  const midVoterStrategy = `
  <div class="card">
    <div class="card-title">ğŸ¯ ì¤‘ë„ì¸µ í¡ìˆ˜ ì „ëµ</div>
    <div class="insight-box" style="margin-bottom:14px">
      ì¤‘ë„ì¸µì€ <strong>ì§€ì§€ í›„ë³´ê°€ ì—†ê±°ë‚˜ ê²°ì •í•˜ì§€ ì•Šì€ ìœ ê¶Œì</strong>ì…ë‹ˆë‹¤.
      ì´ë“¤ì€ ì •ì±…Â·ì´ë¯¸ì§€Â·ì‹ ë¢°ë„ì— ë¯¼ê°í•˜ê²Œ ë°˜ì‘í•©ë‹ˆë‹¤.
    </div>
    <div class="table-wrap"><table>
      <thead><tr><th>ê³µëµ ë°©í–¥</th><th>êµ¬ì²´ ì‹¤í–‰ì•ˆ</th><th>í•µì‹¬ ë©”ì‹œì§€</th></tr></thead>
      <tbody>
        <tr><td><strong>ì •ì±… êµ¬ì²´í™”</strong></td><td>ì¶”ìƒì  ê³µì•½ì„ "ìˆ˜ì¹˜+ê¸°í•œ" í˜•ì‹ìœ¼ë¡œ ì „í™˜ ë°œí‘œ</td><td>"ê²€ì¦ ê°€ëŠ¥í•œ ì•½ì†"</td></tr>
        <tr><td><strong>ì´ë¯¸ì§€ ì¤‘ë¦½í™”</strong></td><td>ê·¹ë‹¨ì  ë‹¹íŒŒì„± ì–¸ê¸‰ ìì œ, ì´ˆë‹¹ì  í˜„ì•ˆ í•´ê²° ê°•ì¡°</td><td>"ì§€ì—­ ì£¼ë¯¼ì„ ìœ„í•œ í›„ë³´"</td></tr>
        <tr><td><strong>ì§ì ‘ ì ‘ì´‰ í™•ëŒ€</strong></td><td>ì „í†µì‹œì¥Â·í•™êµÂ·ì•„íŒŒíŠ¸ ë‹¨ì§€ ë“± ì¤‘ë„ì¸µ ë°€ì§‘ì§€ ë°©ë¬¸</td><td>"í˜„ì¥ì—ì„œ ë§Œë‚©ë‹ˆë‹¤"</td></tr>
        <tr><td><strong>SNS ê°ì„± ì†Œí†µ</strong></td><td>ì¼ìƒÂ·ì§„ì •ì„± ì½˜í…ì¸ ë¡œ ì¸ê°„ì  ë©´ëª¨ ë…¸ì¶œ</td><td>"ë‚˜ë„ ì£¼ë¯¼ì…ë‹ˆë‹¤"</td></tr>
        <tr><td><strong>ì œ3ì ì¶”ì²œ</strong></td><td>ì •ì¹˜ì  ì¤‘ë¦½ ì¸ì‚¬(ì „ë¬¸ê°€Â·ì‹œë¯¼ë‹¨ì²´) ì§€ì§€ ì„ ì–¸ ìœ ë„</td><td>"ë¯¿ì„ ìˆ˜ ìˆëŠ” í›„ë³´"</td></tr>
      </tbody>
    </table></div>
  </div>`;

  return `
  <div class="report-section">
    <div class="s-header" style="background:${strat.bg}">
      <div class="s-num">2</div>${strat.icon} ${strat.title}
    </div>
    <div class="strat-type-banner" style="background:${strat.bg}">
      <div class="strat-type-icon">${strat.icon}</div>
      <div>
        <div class="strat-type-title">${strat.title}</div>
        <div class="strat-type-desc">ì „ëµ ëª©í‘œ: ${strat.goal}</div>
      </div>
    </div>
    ${stratContent}
    ${midVoterStrategy}
    ${(()=>{
      const stratDesc = strat.goal;
      const leaderName = sorted[0].name;
      const topM = METRICS.map(m=>({m,s:target.metrics?.[m]??0})).sort((a,b)=>b.s-a.s).slice(0,2).map(x=>METRIC_LABELS[x.m]).join(', ');
      return summaryBox(`${strat.title} ì¢…í•© ì„¤ëª…`, [
        `${rank===1?`1ìœ„ ìœ ì§€ ë°©ì–´ ì „ëµì˜ í•µì‹¬ ëª©í‘œëŠ” '${stratDesc}'ì…ë‹ˆë‹¤. ì„ ë‘ë¥¼ ë‹¬ë¦¬ê³  ìˆëŠ” ${target.name}ì—ê²Œ ê°€ì¥ í° ìœ„í˜‘ì€ ì§€ì§€ì¸µì˜ ì´ì™„ê³¼ 2ìœ„ í›„ë³´ì˜ ì—­ì „ ì‹œë„ì…ë‹ˆë‹¤. í˜„ì¬ì˜ ì ìˆ˜ ìš°ìœ„ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” ì·¨ì•½ ì§€í‘œë¥¼ ë°©ì–´í•˜ë©´ì„œ í•µì‹¬ ì§€ì§€ì¸µì„ ê²°ì§‘í•˜ëŠ” ì´ì¤‘ ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.`:rank===2?`2ìœ„ ì—­ì „ ì¶”ê²© ì „ëµì˜ í•µì‹¬ ëª©í‘œëŠ” '${stratDesc}'ì…ë‹ˆë‹¤. 1ìœ„ ${leaderName}ê³¼ì˜ ê²©ì°¨ë¥¼ ë¶„ì„í•œ ê²°ê³¼, 3ì  ì´ë‚´ ì°¨ì´ì˜ 'ì—­ì „ ê°€ëŠ¥ í•­ëª©'ì„ ì§‘ì¤‘ ê³µëµí•˜ëŠ” ê²ƒì´ ê°€ì¥ ë¹ ë¥¸ ì—­ì „ ê²½ë¡œì…ë‹ˆë‹¤. ì ìˆ˜ ì°¨ì´ê°€ ê°€ì¥ ì‘ì€ í•­ëª©ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ë’¤ì§‘ì–´ ë‚˜ê°€ëŠ” ë‹¨ê³„ë³„ ì¶”ê²© ì „ëµì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.`:`${rank}ìœ„ í¬ì§€ì…˜ ë¦¬ë¹Œë”© ì „ëµì˜ í•µì‹¬ ëª©í‘œëŠ” '${stratDesc}'ì…ë‹ˆë‹¤. í˜„ì¬ ìˆœìœ„ êµ¬ì¡°ì—ì„œ ë‹¨ê¸° ë„ì•½ì„ ì´ë£¨ë ¤ë©´ ì „ í•­ëª©ì˜ ê· ë“± ê°œì„ ë³´ë‹¤ëŠ” ${target.name}ë§Œì´ ê°€ì§„ ì°¨ë³„í™” ê°•ì ì„ ê·¹ëŒ€í™”í•˜ê³  íƒ€ê²Ÿ ìœ ê¶Œìì¸µì„ ì„¸ë°€í•˜ê²Œ ì„¤ì •í•˜ëŠ” ì§‘ì¤‘ ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.`}`,
        `ì¤‘ë„ì¸µ í¡ìˆ˜ ì „ëµì€ ëª¨ë“  ìˆœìœ„ì˜ í›„ë³´ì—ê²Œ ê³µí†µì ìœ¼ë¡œ ì¤‘ìš”í•©ë‹ˆë‹¤. ì¤‘ë„ì¸µì€ ì •ì±…ì˜ êµ¬ì²´ì„±, í›„ë³´ì˜ ì²­ë ´ì„±, ì§ì ‘ ì†Œí†µ ì—¬ë¶€ì— ë¯¼ê°í•˜ê²Œ ë°˜ì‘í•©ë‹ˆë‹¤. <strong>${topM}</strong> í•­ëª©ì—ì„œ í™•ë³´ëœ ê°•ì ì„ ì¤‘ë„ì¸µì´ ì´í•´í•˜ê¸° ì‰¬ìš´ ì–¸ì–´ì™€ ìˆ˜ì¹˜ë¡œ ì „ë‹¬í•˜ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤. ì¶”ìƒì  ê³µì•½ë³´ë‹¤ 'â—‹ë…„ê¹Œì§€ â—‹â—‹ ë‹¬ì„±'ê³¼ ê°™ì€ ì¸¡ì • ê°€ëŠ¥í•œ ëª©í‘œ ì œì‹œê°€ ì‹ ë¢°ë¥¼ ë†’ì…ë‹ˆë‹¤.`,
        `ì „ëµ ìœ í˜•ë³„ ì„±ê³µ ì¡°ê±´ì„ ìš”ì•½í•˜ë©´: 1ìœ„ëŠ” 'ì‹¤ìˆ˜ ì—†ëŠ” ì•ˆì •ì  ìš´ìš©', 2ìœ„ëŠ” 'ìŠ¹ë¶€ì²˜ í•­ëª© ì§‘ì¤‘ ê³µëµ', 3~4ìœ„ëŠ” 'ê°•ì  ê·¹ëŒ€í™”ì™€ ë©”ì‹œì§€ ì¬í¬ì§€ì…”ë‹'ì…ë‹ˆë‹¤. ì–´ëŠ ì „ëµì´ë“  ìº í”„ ë‚´ë¶€ì˜ ì‹ ì†í•œ ì˜ì‚¬ê²°ì •ê³¼ ì¼ê´€ëœ ë©”ì‹œì§€ ê´€ë¦¬ê°€ ì„ í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.`,
        `ì´ ì„¹ì…˜ì˜ ì „ëµ ë°©í–¥ì€ ì´í•˜ ê²©ì°¨ ì›ì¸ ë¶„í•´(4ë²ˆ), ì‹œë®¬ë ˆì´ì…˜(5ë²ˆ), ë©”ì‹œì§€ ì„¤ê³„(6ë²ˆ), 90ì¼ ë¡œë“œë§µ(8ë²ˆ) ì„¹ì…˜ê³¼ ì—°ê³„í•˜ì—¬ í†µí•©ì ìœ¼ë¡œ ì ìš©í•˜ì‹­ì‹œì˜¤. ê° ì„¹ì…˜ì—ì„œ ì œì‹œëœ êµ¬ì²´ì  ì‹¤í–‰ì•ˆì€ ë³¸ ì „ëµ ë°©í–¥ì„ í˜„ì¥ì—ì„œ êµ¬í˜„í•˜ëŠ” ì‹¤í–‰ ë§¤ë‰´ì–¼ë¡œ í™œìš©ë©ë‹ˆë‹¤.`
      ]);
    })()}
  </div>`;
}

/* â”€â”€ Section 3: ê²½ìŸ í›„ë³´ë³„ ë§ì¶¤ ëŒ€ì‘ ì „ëµ (NEW) â”€â”€ */
function buildSection3_CompetitorResponse(target, col, rank, sorted, candidates) {
  const targetIdx = candidates.indexOf(target);
  const competitors = sorted.filter(c => c.origIdx !== targetIdx);

  const cards = competitors.map((comp) => {
    const cCol = CANDIDATE_COLORS[comp.origIdx % 5];
    const compObj = candidates[comp.origIdx];
    const compRank = sorted.findIndex(c => c.origIdx === comp.origIdx) + 1;
    const scoreGap = target.total_score - comp.total_score;

    // ìƒëŒ€ê°€ ìš°ë¦¬ë³´ë‹¤ ë†’ì€ í•­ëª© (ê³µê²© ê°€ëŠ¥ì„±)
    const theirAdvantages = METRICS.map(m => ({
      m,
      theirScore: compObj.metrics?.[m]??0,
      myScore: target.metrics?.[m]??0,
      gap: (compObj.metrics?.[m]??0) - (target.metrics?.[m]??0)
    })).filter(x => x.gap > 0).sort((a,b)=>b.gap-a.gap).slice(0,3);

    // ìš°ë¦¬ê°€ ìƒëŒ€ë³´ë‹¤ ë†’ì€ í•­ëª© (ê³µëµ í¬ì¸íŠ¸)
    const ourAdvantages = METRICS.map(m => ({
      m,
      myScore: target.metrics?.[m]??0,
      theirScore: compObj.metrics?.[m]??0,
      gap: (target.metrics?.[m]??0) - (compObj.metrics?.[m]??0)
    })).filter(x => x.gap > 0).sort((a,b)=>b.gap-a.gap).slice(0,3);

    let stratMsg = '';
    let stratColor = '#1e3a8a';
    let stratBg = '#eff6ff';
    if (scoreGap > 30) {
      stratMsg = `<strong>${comp.name}</strong>ê³¼ì˜ ê²©ì°¨ê°€ <strong>+${scoreGap}ì </strong>ìœ¼ë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤. ë¦¬ë“œ ê´€ë¦¬ì— ì§‘ì¤‘í•˜ê³  ìê·¹ì  ëŒ€ì‘ì€ ìì œí•˜ì„¸ìš”.`;
      stratColor = '#166534'; stratBg = '#f0fdf4';
    } else if (scoreGap > 5) {
      stratMsg = `<strong>${comp.name}</strong>ì´ ê·¼ì ‘ ì¶”ê²© ì¤‘ì…ë‹ˆë‹¤(${scoreGap}ì  ì°¨). <strong>${theirAdvantages.map(x=>METRIC_LABELS[x.m]).join(', ')}</strong> ë¶„ì•¼ ê³µì„¸ë¥¼ ì‚¬ì „ ì°¨ë‹¨í•˜ì„¸ìš”.`;
      stratColor = '#92400e'; stratBg = '#fffbeb';
    } else if (scoreGap >= -5) {
      stratMsg = `<strong>${comp.name}</strong>ê³¼ ì‚¬ì‹¤ìƒ ë™ì (Â±${Math.abs(scoreGap)}ì )ì…ë‹ˆë‹¤. <strong>${ourAdvantages.map(x=>METRIC_LABELS[x.m]).join(', ')}</strong>ì—ì„œ ê²°ì •ì  ì°¨ì´ë¥¼ ë§Œë“œì„¸ìš”.`;
      stratColor = '#9f1239'; stratBg = '#fff1f2';
    } else {
      stratMsg = `<strong>${comp.name}</strong>ì—ê²Œ ${Math.abs(scoreGap)}ì  ë’¤ì²˜ì ¸ ìˆìŠµë‹ˆë‹¤. <strong>${ourAdvantages.map(x=>METRIC_LABELS[x.m]).join(', ')}</strong> ê°•ì ì„ ê·¹ëŒ€í™”í•´ ì—­ì „ ê¸°íšŒë¥¼ ë…¸ë¦¬ì„¸ìš”.`;
      stratColor = '#7c3aed'; stratBg = '#faf5ff';
    }

    // ì°¨ë³„í™” ë©”ì‹œì§€
    const diffMsg = ourAdvantages.length > 0
      ? `"${target.name}ì€ ${METRIC_LABELS[ourAdvantages[0].m]} ë¶„ì•¼ì—ì„œ ${ourAdvantages[0].gap}ì  ì•ì„œ ìˆìŠµë‹ˆë‹¤"`
      : `"${target.name}ë§Œì˜ ì°¨ë³„í™”ëœ ì§€ì—­ ë¹„ì „ì„ ì œì‹œí•©ë‹ˆë‹¤"`;

    return `
    <div class="comp-card">
      <div class="comp-card-header">
        <div style="width:40px;height:40px;border-radius:50%;background:${cCol.light};display:flex;align-items:center;justify-content:center;font-weight:900;color:${cCol.border};font-size:16px;flex-shrink:0">
          ${compRank}
        </div>
        <div style="flex:1">
          <div class="comp-name" style="color:${cCol.border}">${comp.name}
            <span style="font-size:12px;font-weight:400;color:var(--text-muted)"> Â· ${compObj.party}</span>
          </div>
          <div style="font-size:12px;color:var(--text-muted);margin-top:2px">${compRank}ìœ„ Â· ${comp.total_score}ì </div>
        </div>
        <span class="comp-badge" style="background:${scoreGap>=0?'#dcfce7':'#fee2e2'};color:${scoreGap>=0?'#166534':'#991b1b'}">
          ${scoreGap>=0?`ìš°ë¦¬ê°€ +${scoreGap}ì  ìš°ìœ„`:`${scoreGap}ì  ì—´ì„¸`}
        </span>
      </div>

      <div class="insight-box" style="background:${stratBg};border-color:${stratColor}33;color:${stratColor};margin-bottom:12px">
        ${stratMsg}
      </div>

      <div class="comp-grid">
        <div>
          <div class="comp-col-title" style="color:#dc2626">ğŸ”´ ìƒëŒ€ ê³µì„¸ ì˜ˆìƒ í¬ì¸íŠ¸</div>
          ${theirAdvantages.length > 0 ? theirAdvantages.map(x => `
            <div style="display:flex;align-items:center;gap:8px;padding:5px 0">
              <span class="comp-tag" style="background:#fee2e2;color:#991b1b">${METRIC_LABELS[x.m]}</span>
              <span style="font-size:11px;color:#dc2626;font-weight:600">ìƒëŒ€ +${x.gap}ì  â†’ ê³µì„¸ ê°€ëŠ¥</span>
            </div>`) .join('') : `<div style="font-size:12px;color:var(--text-muted);padding:8px 0">ê³µì„¸ ê°€ëŠ¥ í¬ì¸íŠ¸ ì—†ìŒ (ì „ í•­ëª© ì—´ì„¸)</div>`}
        </div>
        <div>
          <div class="comp-col-title" style="color:#16a34a">ğŸŸ¢ ìš°ë¦¬ ì°¨ë³„í™” ê³µëµ í¬ì¸íŠ¸</div>
          ${ourAdvantages.length > 0 ? ourAdvantages.map(x => `
            <div style="display:flex;align-items:center;gap:8px;padding:5px 0">
              <span class="comp-tag" style="background:#dcfce7;color:#166534">${METRIC_LABELS[x.m]}</span>
              <span style="font-size:11px;color:#16a34a;font-weight:600">ìš°ë¦¬ +${x.gap}ì  â†’ ê°•ì¡° ê°€ëŠ¥</span>
            </div>`).join('') : `<div style="font-size:12px;color:var(--text-muted);padding:8px 0">ì°¨ë³„í™” í¬ì¸íŠ¸ ì—†ìŒ</div>`}
        </div>
      </div>

      <div class="comp-strategy-row" style="border-color:${cCol.border}">
        ğŸ’¬ <strong>ëŒ€ì‘ ë©”ì‹œì§€ ì œì•ˆ:</strong> ${diffMsg}
      </div>
    </div>`;
  }).join('');

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#7f1d1d,#dc2626)">
      <div class="s-num">3</div>âš”ï¸ ê²½ìŸ í›„ë³´ë³„ ë§ì¶¤ ëŒ€ì‘ ì „ëµ
    </div>
    <div class="insight-box" style="background:#fff1f2;border-color:#fda4af;color:#9f1239;margin-bottom:16px">
      ê° ê²½ìŸ í›„ë³´ì˜ ê°•ì Â·ì•½ì ì„ ë¶„ì„í•˜ì—¬ <strong>í›„ë³´ë³„ ë§ì¶¤í˜• ëŒ€ì‘ ë©”ì‹œì§€ì™€ ë°©ì–´Â·ê³µëµ ì „ëµ</strong>ì„ ì„¤ê³„í•©ë‹ˆë‹¤.
    </div>
    ${cards}
    ${(()=>{
      const n2 = candidates.length;
      const competitors = sorted.filter(c=>c.origIdx!==candidates.indexOf(target));
      const ahead = competitors.filter(c=>c.total_score>target.total_score).length;
      const behind = competitors.filter(c=>c.total_score<target.total_score).length;
      const closestComp = competitors.reduce((a,b)=>Math.abs(b.total_score-target.total_score)<Math.abs(a.total_score-target.total_score)?b:a, competitors[0]);
      return summaryBox('ê²½ìŸ í›„ë³´ë³„ ë§ì¶¤ ëŒ€ì‘ ì „ëµ ì¢…í•© ì„¤ëª…', [
        `ê²½ìŸ í›„ë³´ë³„ ë§ì¶¤ ëŒ€ì‘ ë¶„ì„ì—ì„œëŠ” ${target.name}ì´(ê°€) ${ahead}ëª…ì˜ í›„ë³´ë³´ë‹¤ ë’¤ì²˜ì§€ê³  ${behind}ëª…ë³´ë‹¤ ì•ì„œ ìˆëŠ” í˜„ì¬ êµ¬ë„ë¥¼ ìƒì„¸íˆ í•´ë¶€í•©ë‹ˆë‹¤. ê° í›„ë³´ì™€ì˜ í•­ëª©ë³„ ê°•Â·ì•½ì  ë¹„êµë¥¼ í†µí•´ 'ê³µì„¸ ë‹¹í•  ìˆ˜ ìˆëŠ” ì˜ì—­'ê³¼ 'ìš°ë¦¬ê°€ ê³µëµí•  ìˆ˜ ìˆëŠ” ì˜ì—­'ì„ ëª…í™•íˆ êµ¬ë¶„í•˜ëŠ” ê²ƒì´ ì´ ë¶„ì„ì˜ í•µì‹¬ ëª©ì ì…ë‹ˆë‹¤.`,
        `${closestComp ? `ê°€ì¥ ê°€ê¹Œìš´ ê²½ìŸìì¸ <strong>${closestComp.name}</strong>(${Math.abs(closestComp.total_score-target.total_score)}ì  ì°¨ì´)ì€ ê°€ì¥ ì¦‰ê°ì ì¸ ëŒ€ì‘ì´ í•„ìš”í•œ ìƒëŒ€ì…ë‹ˆë‹¤. ì´ í›„ë³´ê°€ ì•ì„œëŠ” í•­ëª©ì€ í•´ë‹¹ í›„ë³´ì˜ ê³µì„¸ ì˜ˆìƒ í¬ì¸íŠ¸ì´ë¯€ë¡œ ì‚¬ì „ ë°©ì–´ ë©”ì‹œì§€ë¥¼ ì¤€ë¹„í•´ì•¼ í•˜ë©°, ìš°ë¦¬ê°€ ì•ì„œëŠ” í•­ëª©ì€ ë¹„êµ ìš°ìœ„ ë©”ì‹œì§€ë¡œ ì ê·¹ í™œìš©í•´ì•¼ í•©ë‹ˆë‹¤.` : ''}`,
        `ë§ì¶¤ ëŒ€ì‘ ì „ëµì˜ í•µì‹¬ ì›ì¹™ì€ 'ê³µì„¸ì™€ ë°©ì–´ë¥¼ ë™ì‹œì— ì¤€ë¹„í•˜ë˜, ê°ì •ì  ë°˜ì‘ ëŒ€ì‹  ë°ì´í„°ë¡œ ëŒ€ì‘í•œë‹¤'ëŠ” ê²ƒì…ë‹ˆë‹¤. ìƒëŒ€ í›„ë³´ì˜ ê°•ì  í•­ëª©ì—ì„œ ì§ì ‘ ì¶©ëŒí•˜ëŠ” ê²ƒì€ ë¶ˆë¦¬í•˜ë©°, ëŒ€ì‹  ìš°ë¦¬ì˜ ì°¨ë³„í™” í•­ëª©ì„ ë”ìš± ë¶€ê°í•˜ì—¬ ìœ ê¶Œìì˜ íŒë‹¨ ê¸°ì¤€ì„ ë°”ê¾¸ëŠ” 'í”„ë ˆì„ ì „í™˜' ì „ëµì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.`,
        `ê° í›„ë³´ë³„ 'ëŒ€ì‘ ë©”ì‹œì§€ ì œì•ˆ'ì€ í˜„ì¥ ìƒí™©ì— ë§ê²Œ ì¡°ì •í•˜ë˜, ìˆ˜ì¹˜ì™€ êµ¬ì²´ì  ì‚¬ë¡€ë¥¼ ë°˜ë“œì‹œ í¬í•¨ì‹œí‚¤ì‹­ì‹œì˜¤. ë§‰ì—°í•œ ë¹„êµ ë°œì–¸ì€ ì˜¤íˆë ¤ ì—­íš¨ê³¼ë¥¼ ë‚³ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë¶„ì„ì„ ìº í”„ ì „ì²´ê°€ ê³µìœ í•˜ì—¬ ì¼ê´€ëœ ëŒ€ì‘ ë©”ì‹œì§€ë¥¼ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì„ ê±° ìš´ë™ì˜ í†µì¼ì„±ì„ í™•ë³´í•˜ëŠ” ê¸°ë°˜ì´ ë©ë‹ˆë‹¤.`
      ]);
    })()}
  </div>`;
}

/* â”€â”€ Section 4: ê²©ì°¨ ì›ì¸ ë¶„í•´ (êµ¬ Section 3) â”€â”€ */
function buildSection4_Causes(target, col, rank, leader, candidates) {
  const gapItems = rank === 1
    ? METRICS.map(m => ({ m, gap: 0, myScore: target.metrics?.[m]??0, leaderScore: target.metrics?.[m]??0 }))
        .sort((a,b) => a.myScore - b.myScore).slice(0, 5)
    : METRICS.map(m => ({
        m,
        myScore: target.metrics?.[m]??0,
        leaderScore: leader.metrics?.[m]??0,
        gap: (leader.metrics?.[m]??0) - (target.metrics?.[m]??0)
      })).filter(x => x.gap > 0).sort((a,b) => b.gap - a.gap).slice(0, 6);

  const items = gapItems.map(x => {
    const db = GAP_CAUSES[x.m];
    const gapColor = rank === 1 ? (x.myScore >= 80 ? '#16a34a' : x.myScore >= 70 ? '#d97706' : '#dc2626') : '#dc2626';
    const gapText = rank === 1 ? `í˜„ì¬ ${x.myScore}ì ` : `ê²©ì°¨ -${x.gap}ì `;

    // ìš”ì¸ ë¶„ë¥˜ (ê°ì„±/ì •ì±…/ì´ë¯¸ì§€)
    const factorMap = {
      ê³µìµì„±:'ì •ì±…', ì •ì±…ì‹¤í–‰ë ¥:'ì •ì±…', ì „ë¬¸ì„±:'ì´ë¯¸ì§€',
      ëŒ€ì‘ì„±:'ì†Œí†µ', ì±…ì„ì„±:'ì´ë¯¸ì§€', ì†Œí†µëŠ¥ë ¥:'ì†Œí†µ',
      ë¦¬ë”ì‹­:'ì´ë¯¸ì§€', ë¹„ì „ëª…í™•ì„±:'ì •ì±…', ì²­ë ´ì„±:'ì´ë¯¸ì§€', ìœ¤ë¦¬ì„±:'ì´ë¯¸ì§€'
    };
    const factor = factorMap[x.m] || 'ì •ì±…';
    const factorColor = factor==='ì •ì±…'?'#2563eb':factor==='ì†Œí†µ'?'#16a34a':'#7c3aed';

    return `
    <div class="cause-item">
      <div class="cause-header">
        <span class="cause-metric">${METRIC_LABELS[x.m]}</span>
        <span class="cause-gap" style="background:${gapColor}22;color:${gapColor}">${gapText}</span>
        <span style="font-size:11px;font-weight:700;padding:2px 8px;border-radius:10px;background:${factorColor}22;color:${factorColor}">${factor} ìš”ì¸</span>
        ${rank !== 1 ? `<span style="font-size:11px;color:var(--text-muted)">${target.name} ${x.myScore}ì  vs ${leader.name} ${x.leaderScore}ì </span>` : ''}
      </div>
      <ul class="cause-reasons" style="border-color:${gapColor}">
        ${db.reasons.map(r => `<li style="border-color:${gapColor}44">${r}</li>`).join('')}
      </ul>
      <div class="cause-action">ğŸ’¡ ê°œì„  ì‹¤í–‰: ${db.action}</div>
    </div>`;
  }).join('');

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#1e3a8a,#1d4ed8)">
      <div class="s-num">4</div>ğŸ” ê²©ì°¨ ì›ì¸ ë¶„í•´ ë¶„ì„
    </div>
    <div class="insight-box" style="margin-bottom:16px">
      ${rank === 1
        ? `1ìœ„ í›„ë³´ë¡œì„œ í•˜ìœ„ ì§€í‘œì˜ <strong>ì›ì¸(ì •ì±…Â·ì´ë¯¸ì§€Â·ì†Œí†µ ìš”ì¸ ë¶„ë¥˜)ê³¼ ê°œì„  ë°©í–¥</strong>ì„ ë¶„ì„í•©ë‹ˆë‹¤.`
        : `1ìœ„ <strong>${leader.name}</strong> ëŒ€ë¹„ ë’¤ì²˜ì§€ëŠ” í•­ëª©ì˜ <strong>ì›ì¸(ìš”ì¸ ë¶„ë¥˜)ê³¼ ì‹¤í–‰ ì „ëµ</strong>ì„ ë¶„ì„í•©ë‹ˆë‹¤.`}
    </div>
    ${items}
    ${(()=>{
      const gapCount = rank===1 ? 0 : gapItems.length;
      const topCause = gapItems.length > 0 ? METRIC_LABELS[gapItems[0].m] : '';
      const factorMap = {ê³µìµì„±:'ì •ì±…',ì •ì±…ì‹¤í–‰ë ¥:'ì •ì±…',ì „ë¬¸ì„±:'ì´ë¯¸ì§€',ëŒ€ì‘ì„±:'ì†Œí†µ',ì±…ì„ì„±:'ì´ë¯¸ì§€',ì†Œí†µëŠ¥ë ¥:'ì†Œí†µ',ë¦¬ë”ì‹­:'ì´ë¯¸ì§€',ë¹„ì „ëª…í™•ì„±:'ì •ì±…',ì²­ë ´ì„±:'ì´ë¯¸ì§€',ìœ¤ë¦¬ì„±:'ì´ë¯¸ì§€'};
      const factors = gapItems.reduce((acc,x)=>{const f=factorMap[x.m]||'ê¸°íƒ€';acc[f]=(acc[f]||0)+1;return acc;},{});
      const dominantFactor = Object.entries(factors).sort((a,b)=>b[1]-a[1])[0];
      return summaryBox('ê²©ì°¨ ì›ì¸ ë¶„í•´ ë¶„ì„ ì¢…í•© ì„¤ëª…', [
        `${rank===1?`1ìœ„ ${target.name}ì˜ ê²©ì°¨ ì›ì¸ ë¶„í•´ ë¶„ì„ì—ì„œëŠ” í•˜ìœ„ ì§€í‘œì˜ ì›ì¸ê³¼ ê°œì„  ë°©í–¥ì„ ë„ì¶œí•©ë‹ˆë‹¤. ì„ ë‘ë¥¼ ìœ ì§€í•˜ë©´ì„œë„ ë‚®ì€ ì ìˆ˜ë¥¼ ë³´ì´ëŠ” í•­ëª©ë“¤ì€ ìƒëŒ€ í›„ë³´ì˜ ê³µì„¸ ëŒ€ìƒì´ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì´ë¥¼ ì‚¬ì „ì— ê°•í™”í•˜ëŠ” ê²ƒì´ ë°©ì–´ ì „ëµì˜ í•µì‹¬ì…ë‹ˆë‹¤.`:`${gapCount}ê°œì˜ ê²©ì°¨ í•­ëª© ë¶„ì„ì—ì„œ <strong>${topCause}</strong>ì´(ê°€) ê°€ì¥ í° ê²©ì°¨ë¥¼ ë³´ì˜€ìŠµë‹ˆë‹¤. ì´ í•­ëª©ë“¤ì˜ ì›ì¸ì„ ì •ì±…Â·ì´ë¯¸ì§€Â·ì†Œí†µ ìš”ì¸ìœ¼ë¡œ ë¶„ë¥˜í•˜ë©´, ${dominantFactor?`<strong>${dominantFactor[0]} ìš”ì¸</strong>ì´ ${dominantFactor[1]}ê°œ í•­ëª©ì—ì„œ ì£¼ìš” ì›ì¸ìœ¼ë¡œ ì‘ìš©í•˜ê³  ìˆì–´ í•´ë‹¹ ë¶„ì•¼ì˜ ì§‘ì¤‘ ê°œì„ ì´ ìš°ì„  ê³¼ì œì…ë‹ˆë‹¤.`:'ë³µí•©ì  ìš”ì¸ì´ ì‘ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.'}`}`,
        `ê° í•­ëª©ë³„ ì›ì¸ ë¶„ì„ì—ì„œ ì œì‹œëœ 'ê°œì„  ì‹¤í–‰ì•ˆ'ì€ ìº í”„ê°€ ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ êµ¬ì²´ì  í–‰ë™ ì§€ì¹¨ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì •ì±…ì‹¤í–‰ë ¥ í•­ëª©ì˜ ê°œì„  ì‹¤í–‰ì•ˆì€ 'ê³µì•½ ì´í–‰ë¥  ë¦¬í¬íŠ¸ ë°œí–‰'ì²˜ëŸ¼ ê²€ì¦ ê°€ëŠ¥í•œ ìˆ˜ì¹˜ë¥¼ ë™ë°˜í•œ í™œë™ì„ í¬í•¨í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ìˆ˜ì¹˜í™”ëœ ì„±ê³¼ëŠ” ìœ ê¶Œì ì‹ ë¢°ë¥¼ ì§ì ‘ì ìœ¼ë¡œ í–¥ìƒì‹œí‚µë‹ˆë‹¤.`,
        `ìš”ì¸ ë¶„ë¥˜(ì •ì±…Â·ì´ë¯¸ì§€Â·ì†Œí†µ)ì— ë”°ë¼ ëŒ€ì‘ ë°©ì‹ì„ ë‹¬ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤. ì •ì±… ìš”ì¸ì˜ ê°œì„ ì€ êµ¬ì²´ì  ìˆ˜ì¹˜ì™€ ì´í–‰ ê³„íšì´ í•„ìš”í•˜ê³ , ì´ë¯¸ì§€ ìš”ì¸ì€ ìŠ¤í† ë¦¬í…”ë§ê³¼ ë¯¸ë””ì–´ ì „ëµì´ ì¤‘ì‹¬ì´ ë˜ë©°, ì†Œí†µ ìš”ì¸ì€ ì§ì ‘ ì ‘ì´‰ ë¹ˆë„ì™€ ì±„ë„ ë‹¤ì–‘í™”ê°€ í•µì‹¬ì…ë‹ˆë‹¤. ìš”ì¸ë³„ë¡œ ë‹´ë‹¹ íŒ€ì„ ë¶„ë¦¬í•˜ì—¬ ë³‘ë ¬ ì¶”ì§„í•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì ì…ë‹ˆë‹¤.`,
        `ê²©ì°¨ ì›ì¸ ë¶„ì„ì€ ë‹¨ìˆœí•œ ì ìˆ˜ ë¹„êµë¥¼ ë„˜ì–´ 'ì™œ ì´ ì ìˆ˜ê°€ ë‚˜ì™”ëŠ”ê°€'ë¥¼ í•´ëª…í•˜ëŠ” ë¶„ì„ì…ë‹ˆë‹¤. ì´ ì¸ì‚¬ì´íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ 90ì¼ ë¡œë“œë§µ(8ë²ˆ ì„¹ì…˜)ì˜ ì‹¤í–‰ í•­ëª©ì„ ìš°ì„ ìˆœìœ„ ìˆœìœ¼ë¡œ ë°°ì¹˜í•˜ê³ , ë©”ì‹œì§€ ì„¤ê³„(6ë²ˆ ì„¹ì…˜)ì—ì„œ ê°•ì¡°í•  í‚¤ì›Œë“œë¥¼ ì„ ì •í•˜ëŠ” ë° ì§ì ‘ í™œìš©í•˜ì‹­ì‹œì˜¤.`
      ]);
    })()}
  </div>`;
}

/* â”€â”€ Section 5: ì ìˆ˜ ê°œì„  ì‹œë®¬ë ˆì´ì…˜ + ì§€ì§€ìœ¨ ì „í™˜ ëª¨ë¸ (êµ¬ Section 4) â”€â”€ */
function buildSection5_Simulation(target, col, rank, sorted, candidates) {
  const metList = METRICS.map(m => ({ m, s: target.metrics?.[m]??0 })).sort((a,b)=>a.s-b.s).slice(0,5);
  const targetIdx = candidates.indexOf(target);

  const rows = metList.map(x => {
    const delta = Math.min(5, 100 - x.s);
    const newTotal = target.total_score + delta;
    const newRank = sorted.filter(c => c.origIdx !== targetIdx && c.total_score > newTotal).length + 1;
    const rankChange = rank - newRank;
    const probPct = Math.min(95, Math.round(50 + rankChange * 20 + delta * 2));
    const probColor = probPct >= 70 ? '#16a34a' : probPct >= 45 ? '#d97706' : '#dc2626';
    const probLabel = probPct >= 70 ? 'ë†’ìŒ' : probPct >= 45 ? 'ë³´í†µ' : 'ë‚®ìŒ';

    return `
    <div class="sim-row">
      <div class="sim-metric" style="color:${col.border}">${METRIC_LABELS[x.m]}</div>
      <div class="sim-delta">+${delta}ì </div>
      <div class="sim-result">
        <div class="sim-before">í˜„ì¬: ${target.total_score}ì  (${rank}ìœ„) â†’ ê°œì„  í›„: <strong>${newTotal}ì  (${newRank}ìœ„)</strong></div>
        <div class="sim-after" style="color:${rankChange > 0 ? '#16a34a' : 'var(--text-muted)'}">
          ${rankChange > 0 ? `â¬† ${rankChange}ê³„ë‹¨ ìƒìŠ¹ ê°€ëŠ¥` : `ìˆœìœ„ ë³€ë™ ì—†ìŒ (ì ìˆ˜ +${delta}ì  í–¥ìƒ)`}
        </div>
      </div>
      <span class="sim-prob" style="background:${probColor}22;color:${probColor}">
        ì—­ì „ ê°€ëŠ¥ì„± ${probPct}% Â· ${probLabel}
      </span>
    </div>`;
  }).join('');

  // ë³µí•© ì‹œë‚˜ë¦¬ì˜¤
  const top3Targets = metList.slice(0,3);
  const combinedDelta = top3Targets.reduce((a,x) => a + Math.min(5, 100-x.s), 0);
  const combinedNew = target.total_score + combinedDelta;
  const combinedRank = sorted.filter(c => c.origIdx !== targetIdx && c.total_score > combinedNew).length + 1;

  // ì§€ì§€ìœ¨ ì „í™˜ ì¶”ì • ëª¨ë¸
  const scores = candidates.map(c => c.total_score);
  const minScore = Math.min(...scores);
  const maxScore = Math.max(...scores);
  const scoreRange = maxScore - minScore || 1;
  const totalVoteShare = 85; // ê°€ìš© ì§€ì§€ìœ¨ ì´í•© (%)
  const baseShare = Math.round(((target.total_score - minScore) / scoreRange) * 40 + 15);
  const improvedShare = Math.round(((target.total_score + combinedDelta - minScore) / scoreRange) * 40 + 15);
  const gainShare = improvedShare - baseShare;

  const supportRows = candidates.map((c, i) => {
    const cCol = CANDIDATE_COLORS[i % 5];
    const share = Math.round(((c.total_score - minScore) / scoreRange) * 40 + 15);
    const isTarget = c === target;
    return `
    <div class="support-bar-row">
      <div class="support-bar-label" style="color:${cCol.border};font-weight:${isTarget?'800':'600'}">${c.name}${isTarget?' â˜…':''}</div>
      <div class="support-bar-track">
        <div class="support-bar-fill" style="width:${share}%;background:${isTarget?col.border:cCol.border+'80'}"></div>
      </div>
      <div class="support-bar-val" style="color:${cCol.border}">${share}% ì¶”ì •</div>
    </div>`;
  }).join('');

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#1e3a8a,#1d4ed8)">
      <div class="s-num">5</div>ğŸ“ˆ ì ìˆ˜ ê°œì„  ì‹œë®¬ë ˆì´ì…˜ Â· ì§€ì§€ìœ¨ ì „í™˜ ì¶”ì •
    </div>
    <div class="insight-box" style="margin-bottom:16px">
      ê° í•­ëª©ì„ <strong>5ì  ê°œì„ </strong>í–ˆì„ ë•Œ ì¢…í•© ìˆœìœ„ì™€ ì—­ì „ ê°€ëŠ¥ì„±ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.
      ìˆ˜ì¹˜ëŠ” í˜„ì¬ ë°ì´í„° ê¸°ë°˜ì˜ ì˜ˆì¸¡ì´ë©°, ì‹¤ì œ ì„ ê±° ê²°ê³¼ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </div>
    ${rows}

    <div class="card" style="background:linear-gradient(135deg,#1e3a8a11,#dbeafe);border:2px solid #3b82f6;margin-top:4px">
      <div class="card-title">ğŸš€ ë³µí•© ì‹œë‚˜ë¦¬ì˜¤: í•˜ìœ„ 3ê°œ í•­ëª© ë™ì‹œ ê°œì„ </div>
      <div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap;padding:4px 0">
        <div>
          <div style="font-size:12px;color:var(--text-muted)">ê°œì„  í•­ëª©</div>
          <div style="font-weight:700">${top3Targets.map(x=>METRIC_LABELS[x.m]).join(', ')}</div>
        </div>
        <div>
          <div style="font-size:12px;color:var(--text-muted)">ì´ ê°œì„  ì ìˆ˜</div>
          <div style="font-weight:700;color:#16a34a">+${combinedDelta}ì </div>
        </div>
        <div>
          <div style="font-size:12px;color:var(--text-muted)">í˜„ì¬ â†’ ê°œì„  í›„</div>
          <div style="font-weight:700">${target.total_score}ì  â†’ ${combinedNew}ì </div>
        </div>
        <div style="margin-left:auto;text-align:center">
          <div style="font-size:12px;color:var(--text-muted)">ì˜ˆìƒ ìˆœìœ„ ë³€í™”</div>
          <div style="font-size:22px;font-weight:900;color:${combinedRank < rank?'#16a34a':'var(--text-muted)'}">
            ${rank}ìœ„ â†’ ${combinedRank}ìœ„
          </div>
        </div>
      </div>
    </div>

    <!-- ì§€ì§€ìœ¨ ì „í™˜ ì¶”ì • ëª¨ë¸ -->
    <div class="card" style="margin-top:4px">
      <div class="card-title">ğŸ“Š ì§€ì§€ìœ¨ ì „í™˜ ì¶”ì • ëª¨ë¸</div>
      <div class="insight-box" style="margin-bottom:14px">
        ì¢…í•© ì ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í›„ë³´ë³„ <strong>ì¶”ì • ì§€ì§€ìœ¨ ë¶„í¬</strong>ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.
        ê°œì„  ì‹œ <strong>${target.name}</strong>ì˜ ì§€ì§€ìœ¨ì€ <span style="color:#16a34a;font-weight:700">ì•½ +${gainShare}%p</span> í–¥ìƒì´ ê¸°ëŒ€ë©ë‹ˆë‹¤.
      </div>
      <div class="support-model">
        <div style="font-size:13px;font-weight:700;margin-bottom:12px">í˜„ì¬ ì§€ì§€ìœ¨ ì¶”ì • ë¶„í¬</div>
        ${supportRows}
      </div>
      <div class="support-model" style="border:2px solid #16a34a">
        <div style="font-size:13px;font-weight:700;margin-bottom:12px;color:#16a34a">ê°œì„  í›„ ${target.name} ì˜ˆìƒ ì§€ì§€ìœ¨</div>
        <div class="support-bar-row">
          <div class="support-bar-label" style="color:${col.border};font-weight:800">${target.name} (í˜„ì¬)</div>
          <div class="support-bar-track">
            <div class="support-bar-fill" style="width:${baseShare}%;background:${col.border}80"></div>
          </div>
          <div class="support-bar-val" style="color:var(--text-muted)">${baseShare}%</div>
        </div>
        <div class="support-bar-row">
          <div class="support-bar-label" style="color:#16a34a;font-weight:800">${target.name} (ê°œì„  í›„)</div>
          <div class="support-bar-track">
            <div class="support-bar-fill" style="width:${improvedShare}%;background:#16a34a"></div>
          </div>
          <div class="support-bar-val" style="color:#16a34a;font-weight:800">${improvedShare}% (+${gainShare}%p)</div>
        </div>
        <div style="font-size:11px;color:var(--text-muted);margin-top:8px">
          â€» ì¶”ì • ëª¨ë¸ì€ í˜„ì¬ ì ìˆ˜ ê¸°ë°˜ í†µê³„ì  ì¶”ì •ì´ë©°, ì‹¤ì œ ì—¬ë¡ ì¡°ì‚¬ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>
    ${summaryBox('ì ìˆ˜ ê°œì„  ì‹œë®¬ë ˆì´ì…˜ Â· ì§€ì§€ìœ¨ ì „í™˜ ëª¨ë¸ ì¢…í•© ì„¤ëª…', [
      `ì ìˆ˜ ê°œì„  ì‹œë®¬ë ˆì´ì…˜ì€ ê° í•˜ìœ„ í•­ëª©ì„ 5ì  ê°œì„ í–ˆì„ ë•Œ ì¢…í•© ìˆœìœ„ì™€ ì—­ì „ ê°€ëŠ¥ì„±ì„ ìˆ˜ì¹˜ë¡œ ì˜ˆì¸¡í•©ë‹ˆë‹¤. ì—­ì „ ê°€ëŠ¥ì„±ì´ ë†’ì€ í•­ëª©ì€ ë‹¨ê¸° ì§‘ì¤‘ íˆ¬ì ëŒ€ìƒì´ ë˜ë©°, ë‚®ì€ í•­ëª©ì€ ì¤‘ì¥ê¸° ê³¼ì œë¡œ ë¶„ë¥˜í•˜ì—¬ ìì› ë°°ë¶„ì˜ ìš°ì„ ìˆœìœ„ë¥¼ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
      `ë³µí•© ì‹œë‚˜ë¦¬ì˜¤(í•˜ìœ„ 3ê°œ í•­ëª© ë™ì‹œ ê°œì„ )ëŠ” ìº í”„ì˜ ì „ëµì  ì—­ëŸ‰ì´ í•œ ê³³ì— ì§‘ì¤‘ë  ë•Œì™€ ë¶„ì‚°ë  ë•Œì˜ ì°¨ì´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ë™ì‹œ ê°œì„ ì˜ ëˆ„ì  íš¨ê³¼ëŠ” ê°œë³„ ê°œì„ ë³´ë‹¤ í›¨ì”¬ í¬ì§€ë§Œ, ìº í”„ì˜ ì—ë„ˆì§€ì™€ ìì›ì„ ë¶„ì‚°ì‹œí‚¬ ìœ„í—˜ë„ ìˆìŠµë‹ˆë‹¤. í˜„ì‹¤ì ì¸ ì‹¤í–‰ ê°€ëŠ¥ì„±ì„ ê³ ë ¤í•˜ì—¬ 1~2ê°œ í•­ëª©ì— ì§‘ì¤‘í•˜ëŠ” ê²ƒì´ ë‹¨ê¸° ì „ëµìœ¼ë¡œ íš¨ê³¼ì ì…ë‹ˆë‹¤.`,
      `ì§€ì§€ìœ¨ ì „í™˜ ì¶”ì • ëª¨ë¸ì€ ì ìˆ˜ ê¸°ë°˜ í†µê³„ì  ì¶”ì •ì¹˜ë¡œ, ì ìˆ˜ ê°œì„ ì´ ì‹¤ì œ ì—¬ë¡  ë³€í™”ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ê°€ì‹œí™”í•©ë‹ˆë‹¤. ì¢…í•© ì ìˆ˜ 10ì  ê°œì„ ì´ ì§€ì§€ìœ¨ ì•½ ${gainShare > 0 ? Math.round(gainShare/3) : 1}~${gainShare}%p í–¥ìƒìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŒì„ ì‹œì‚¬í•©ë‹ˆë‹¤. ë‹¨, ì´ ëª¨ë¸ì€ ì´ìƒì  ì¡°ê±´ì„ ê°€ì •í•œ ì¶”ì •ì´ë©° ì„ ê±° ê²°ê³¼ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`,
      `ì´ ì‹œë®¬ë ˆì´ì…˜ì˜ ê°€ì¥ ì¤‘ìš”í•œ í™œìš© ë°©ì‹ì€ 'ì–´ëŠ í•­ëª©ì„ ì–¸ì œ ê°œì„ í•  ê²ƒì¸ê°€'ì— ëŒ€í•œ ì˜ì‚¬ê²°ì • ì§€ì›ì…ë‹ˆë‹¤. ì„ ê±°ê¹Œì§€ ë‚¨ì€ ê¸°ê°„, ìº í”„ ì—­ëŸ‰, ì—¬ë¡ ì˜ ê´€ì‹¬ ì´ìŠˆë¥¼ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•˜ì—¬ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ë¥¼ í•´ì„í•˜ê³ , ì´í›„ 90ì¼ ë¡œë“œë§µ(8ë²ˆ ì„¹ì…˜)ì— ë°˜ì˜í•˜ì‹­ì‹œì˜¤.`
    ])}
  </div>`;
}

/* â”€â”€ Section 6: ë©”ì‹œì§€ êµ¬ì¡° ì„¤ê³„ (NEW) â”€â”€ */
function buildSection6_Message(target, col, rank, strat) {
  const topMetrics = METRICS.map(m => ({m, s: target.metrics?.[m]??0})).sort((a,b)=>b.s-a.s).slice(0,3);
  const botMetrics = METRICS.map(m => ({m, s: target.metrics?.[m]??0})).sort((a,b)=>a.s-b.s).slice(0,3);

  const slogans = [
    {
      tag: 'ì •ì±… ì‹¤í–‰í˜•',
      text: `ê²€ì¦ëœ ì‹¤í–‰ë ¥, ${target.name}ì´ ë§Œë“œëŠ” ë³€í™”`,
      sub: `${METRIC_LABELS[topMetrics[0].m]}Â·${METRIC_LABELS[topMetrics[1]?.m||topMetrics[0].m]} ê°•ì  ê¸°ë°˜ ë©”ì‹œì§€`
    },
    {
      tag: 'ì‹ ë¢°Â·ì²­ë ´í˜•',
      text: `ì•½ì†ì„ ì§€í‚¤ëŠ” í›„ë³´, ${target.name}`,
      sub: 'ì±…ì„ì„±Â·ì²­ë ´ì„± ê°•ì¡° â€” ì¤‘ë„ì¸µ í¡ìˆ˜ì— íš¨ê³¼ì '
    },
    {
      tag: 'ë¹„ì „ ë„ì•½í˜•',
      text: `${target.name}ê³¼ í•¨ê»˜, ìš°ë¦¬ ì§€ì—­ì˜ ë¯¸ë˜`,
      sub: 'ë¹„ì „ ëª…í™•ì„±Â·ë¦¬ë”ì‹­ ê°•ì¡° â€” ì§€ì§€ì¸µ ê²°ì§‘ì— íš¨ê³¼ì '
    }
  ];

  const KEYWORD_DB = {
    ê³µìµì„±: ['ì£¼ë¯¼ ì¤‘ì‹¬', 'ëª¨ë‘ë¥¼ ìœ„í•œ ì •ì¹˜', 'ì†Œì™¸ ì—†ëŠ” í–‰ì •'],
    ì •ì±…ì‹¤í–‰ë ¥: ['ì™„ìˆ˜í•˜ëŠ” ì •ì¹˜', 'ê³µì•½ ì´í–‰ë¥  1ìœ„', 'ì•½ì†ì„ ì‹¤ì²œ'],
    ì „ë¬¸ì„±: ['ì „ë¬¸ê°€ í›„ë³´', 'ê²€ì¦ëœ ì—­ëŸ‰', 'í˜„ì¥ ê²½í—˜ 20ë…„'],
    ëŒ€ì‘ì„±: ['ë¹ ë¥¸ ì‘ë‹µ', '24ì‹œê°„ ë¯¼ì› ì²˜ë¦¬', 'í˜„ì¥ ì¦‰ë‹µ'],
    ì±…ì„ì„±: ['ì±…ì„ì§€ëŠ” ì •ì¹˜', 'íˆ¬ëª…í•œ í–‰ì •', 'ê²°ê³¼ë¡œ ì¦ëª…'],
    ì†Œí†µëŠ¥ë ¥: ['í•¨ê»˜ ë§Œë“œëŠ” ì •ì¹˜', 'ì§ì ‘ ì†Œí†µ', 'ê²½ì²­í•˜ëŠ” í›„ë³´'],
    ë¦¬ë”ì‹­: ['ê²°ë‹¨ë ¥ ìˆëŠ” ë¦¬ë”', 'ìœ„ê¸°ë¥¼ ì´ë„ëŠ” í˜', 'ì§€ì—­ì„ ë°”ê¿‰ë‹ˆë‹¤'],
    ë¹„ì „ëª…í™•ì„±: ['5ë…„ í›„ ìš°ë¦¬ ì§€ì—­', 'êµ¬ì²´ì ì¸ ëª©í‘œ', 'ìˆ«ìë¡œ ë§í•˜ëŠ” ì •ì¹˜'],
    ì²­ë ´ì„±: ['ê¹¨ë—í•œ ì •ì¹˜', 'ì´í•´ì¶©ëŒ ì—†ìŒ', 'ì²­ë ´ ì„œì•½'],
    ìœ¤ë¦¬ì„±: ['ì›ì¹™ì„ ì§€í‚¤ëŠ” í›„ë³´', 'ë„ë•ì  ë¦¬ë”ì‹­', 'í–‰ë™í•˜ëŠ” ì–‘ì‹¬']
  };

  const positiveKeywords = topMetrics.flatMap(x => KEYWORD_DB[x.m] || []);
  const avoidTopics = botMetrics.map(x => METRIC_LABELS[x.m]);

  const SPEAK_DO = [
    'ê³µì•½Â·ì •ì±…ì€ í•­ìƒ "ìˆ˜ì¹˜+ê¸°í•œ"ì„ ë¶™ì—¬ì„œ ë§í•˜ê¸° (ì˜ˆ: "2028ë…„ê¹Œì§€ 30% ë‹¬ì„±")',
    'ìƒëŒ€ í›„ë³´ ë¹„íŒ ì‹œ ë°˜ë“œì‹œ ëŒ€ì•ˆ í•¨ê»˜ ì œì‹œ ("Aê°€ ë¬¸ì œì…ë‹ˆë‹¤" â†’ "AëŠ” Bë¡œ í•´ê²°í•©ë‹ˆë‹¤")',
    'ì§€ì—­ í˜„ì•ˆ ì–¸ê¸‰ ì‹œ ì§ì ‘ ë°©ë¬¸Â·í™•ì¸í•œ êµ¬ì²´ ì‚¬ë¡€ ì¸ìš©',
    `ê°•ì  ì§€í‘œ(${topMetrics.map(x=>METRIC_LABELS[x.m]).join(', ')}) ê´€ë ¨ ë°œì–¸ì€ ìì‹  ìˆê²Œ, ìˆ˜ì¹˜ë¡œ ë’·ë°›ì¹¨`,
    'ìœ ê¶Œìì˜ ë§ì„ ë¨¼ì € ê²½ì²­ â†’ ê³µê° â†’ í•´ê²°ì±… ìˆœì„œë¡œ ì†Œí†µ'
  ];

  const SPEAK_DONT = [
    `${avoidTopics.join(', ')} ê´€ë ¨ ì¦‰í¥ ë°œì–¸ ê¸ˆì§€ â€” ì‚¬ì „ ì¤€ë¹„ëœ ë‹µë³€ ì‚¬ìš© í•„ìˆ˜`,
    'ë°ì´í„°Â·ê·¼ê±° ì—†ëŠ” ë¹„êµ ë°œì–¸ (ì˜ˆ: "ì €ë§Œì´ ìœ ì¼í•˜ê²Œâ€¦") ê¸ˆì§€',
    'ê°ì •ì  ë°˜ì‘Â·ê³ ì„±Â·ë°˜ë§Â·ì¸ì‹ ê³µê²© ì ˆëŒ€ ê¸ˆì§€',
    'ë¯¸í™•ì¸ ì •ë³´ ê¸°ë°˜ ë°œì–¸, í™•ì¸ ì „ ì˜í˜¹ ì–¸ê¸‰ ê¸ˆì§€',
    'ì•½ì  í•­ëª© ë°©ì–´ì  íƒœë„ â€” ì˜¤íˆë ¤ ê³µì„¸ë¥¼ ìœ ë°œí•¨, ì¸ì • í›„ ê°œì„  ê³„íš ì œì‹œ'
  ];

  const SNS_RULES = [
    { platform: 'ìœ íŠœë¸Œ', icon: 'ğŸ“¹', color:'#dc2626', rules: ['60ì´ˆ ì‡¼ì¸  ìš°ì„  ì œì‘', 'ì •ì±… ì„¤ëª… + í˜„ì¥ ìŠ¤í† ë¦¬ ê²°í•©', 'ëŒ“ê¸€ ì§ì ‘ ë‹µë³€ (ì£¼ 2íšŒ ì´ìƒ)', 'ë¼ì´ë¸Œ ë°©ì†¡ ì›” 1íšŒ'] },
    { platform: 'ì¸ìŠ¤íƒ€ê·¸ë¨', icon: 'ğŸ“¸', color:'#e1306c', rules: ['ê°ì„± ì‚¬ì§„ + ìŠ¬ë¡œê±´ ì¹´ë“œë‰´ìŠ¤', 'ìŠ¤í† ë¦¬ ì¼ìƒ ê³µìœ  (1ì¼ 1~2íšŒ)', 'ë¦´ìŠ¤ í˜„ì¥ ë°©ë¬¸ ì˜ìƒ', 'í•´ì‹œíƒœê·¸ ì „ëµ ì„¤ì •'] },
    { platform: 'í˜ì´ìŠ¤ë¶', icon: 'ğŸ‘¥', color:'#2563eb', rules: ['5060ì„¸ëŒ€ íƒ€ê²Ÿ ì •ì±… í…ìŠ¤íŠ¸', 'ì§€ì—­ í–‰ì‚¬Â·ë¯¼ì› ì²˜ë¦¬ ê³µìœ ', 'ì§€ì§€ì ê·¸ë£¹ ê´€ë¦¬', 'ë§í¬ ê¸°ì‚¬ ê³µìœ  ì§‘ì¤‘'] },
    { platform: 'X(íŠ¸ìœ„í„°)', icon: 'ğŸ¦', color:'#1da1f2', rules: ['ì´ìŠˆ ì„ ì œ ëŒ€ì‘ (1ì‹œê°„ ë‚´)', '140ì í•µì‹¬ ë©”ì‹œì§€ í›ˆë ¨', 'ì–¸ë¡  ê¸°ì‚¬ ë§í¬ + í•œì¤„ ì…ì¥', 'ê²½ìŸ í›„ë³´ ëŒ€ì‘ ì‹ ì¤‘í•˜ê²Œ'] }
  ];

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#1e3a8a,#7c3aed)">
      <div class="s-num">6</div>ğŸ’¬ ë©”ì‹œì§€ êµ¬ì¡° ì„¤ê³„
    </div>

    <div class="card">
      <div class="card-title">ğŸ¯ ìŠ¬ë¡œê±´ í›„ë³´ 3ì•ˆ</div>
      <div style="display:flex;flex-direction:column;gap:10px">
        ${slogans.map((s,i) => `
        <div class="msg-slogan-box" style="${i===1?'opacity:.88':i===2?'opacity:.78':''}">
          <div class="msg-slogan-label">ì•ˆ ${i+1} Â· ${s.tag}</div>
          <div class="msg-slogan-text">"${s.text}"</div>
          <div class="msg-slogan-sub">${s.sub}</div>
        </div>`).join('')}
      </div>
    </div>

    <div class="card">
      <div class="card-title">ğŸ”‘ í•µì‹¬ ë©”ì‹œì§€ í‚¤ì›Œë“œ ë±…í¬</div>
      <div style="margin-bottom:16px">
        <div style="font-size:12px;font-weight:700;color:#16a34a;margin-bottom:6px">âœ… ì ê·¹ ì‚¬ìš© í‚¤ì›Œë“œ (ê°•ì  ê¸°ë°˜)</div>
        <div class="keyword-grid">
          ${positiveKeywords.map(k => `<span class="keyword-chip" style="background:#dcfce7;color:#166534">${k}</span>`).join('')}
        </div>
      </div>
      <div>
        <div style="font-size:12px;font-weight:700;color:#dc2626;margin-bottom:6px">âš ï¸ ì‹ ì¤‘ ì ‘ê·¼ ì˜ì—­ (ì•½ì  ë…¸ì¶œ ë°©ì§€)</div>
        <div class="keyword-grid">
          ${avoidTopics.map(k => `<span class="keyword-chip" style="background:#fee2e2;color:#991b1b">${k} ê´€ë ¨ ì¦‰í¥ ë°œì–¸</span>`).join('')}
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">ğŸ—£ï¸ ë°œì–¸ ê°€ì´ë“œ</div>
      <div style="margin-bottom:18px">
        <div style="font-size:12px;font-weight:700;color:#16a34a;margin-bottom:8px">âœ… DO â€” ì´ë ‡ê²Œ ë§í•˜ì„¸ìš”</div>
        ${SPEAK_DO.map(t => `<div class="speak-row"><span class="speak-label" style="background:#dcfce7;color:#166534">DO</span><span class="speak-text">${t}</span></div>`).join('')}
      </div>
      <div>
        <div style="font-size:12px;font-weight:700;color:#dc2626;margin-bottom:8px">âŒ DON'T â€” í”¼í•´ì•¼ í•  ë°œì–¸</div>
        ${SPEAK_DONT.map(t => `<div class="speak-row"><span class="speak-label" style="background:#fee2e2;color:#991b1b">DON'T</span><span class="speak-text">${t}</span></div>`).join('')}
      </div>
    </div>

    <div class="card">
      <div class="card-title">ğŸ“± í”Œë«í¼ë³„ SNS í†¤ì•¤ë§¤ë„ˆ ê°€ì´ë“œ</div>
      <div class="sns-grid">
        ${SNS_RULES.map(s => `
        <div class="sns-card" style="border-top:3px solid ${s.color}">
          <div class="sns-platform" style="color:${s.color}">${s.icon} ${s.platform}</div>
          ${s.rules.map(r => `<div class="sns-rule">â€¢ ${r}</div>`).join('')}
        </div>`).join('')}
      </div>
    </div>
    ${summaryBox('ë©”ì‹œì§€ êµ¬ì¡° ì„¤ê³„ ì¢…í•© ì„¤ëª…', [
      `ë©”ì‹œì§€ êµ¬ì¡° ì„¤ê³„ ì„¹ì…˜ì€ ${target.name} í›„ë³´ì˜ ê°•ì  í•­ëª©ì—ì„œ ë„ì¶œëœ ìŠ¬ë¡œê±´ 3ì•ˆ, í‚¤ì›Œë“œ ë±…í¬, ë°œì–¸ ê°€ì´ë“œ, SNS í†¤ì•¤ë§¤ë„ˆë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ìŠ¬ë¡œê±´ 3ì•ˆì€ ê°ê° 'ì •ì±… ì‹¤í–‰í˜•', 'ì‹ ë¢°Â·ì²­ë ´í˜•', 'ë¹„ì „ ë„ì•½í˜•'ìœ¼ë¡œ íƒ€ê²Ÿ ìœ ê¶Œìì¸µê³¼ ì„ ê±° ì‹œê¸°ì— ë”°ë¼ ì„ íƒì ìœ¼ë¡œ í™œìš©í•˜ì‹­ì‹œì˜¤. ë‹¨ì¼ ìŠ¬ë¡œê±´ì„ ê³ ì§‘í•˜ê¸°ë³´ë‹¤ ìƒí™©ì— ë§ê²Œ ì¡°í•©í•˜ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.`,
      `í‚¤ì›Œë“œ ë±…í¬ì—ì„œ 'ì ê·¹ ì‚¬ìš© í‚¤ì›Œë“œ'ëŠ” ê°•ì  í•­ëª©ì—ì„œ ì§ì ‘ ì¶”ì¶œëœ ê²ƒìœ¼ë¡œ, ì–¸ë¡  ì¸í„°ë·°Â·ìœ ì„¸Â·SNS ëª¨ë“  ì±„ë„ì—ì„œ ì¼ê´€ë˜ê²Œ í™œìš©í•´ì•¼ í•©ë‹ˆë‹¤. ë°˜ëŒ€ë¡œ 'ì‹ ì¤‘ ì ‘ê·¼ ì˜ì—­'ì— í‘œì‹œëœ í•­ëª© ê´€ë ¨ ì¦‰í¥ ë°œì–¸ì€ ìƒëŒ€ í›„ë³´ì˜ ê³µì„¸ ì†Œì¬ê°€ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë°˜ë“œì‹œ ì‚¬ì „ ì¤€ë¹„ëœ ë‹µë³€ë§Œ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.`,
      `ë°œì–¸ ê°€ì´ë“œì˜ DO/DON'T ì›ì¹™ì€ ìº í”„ ì „ì²´ê°€ ìˆ™ì§€í•´ì•¼ í•˜ëŠ” ê¸°ë³¸ ê·œì¹™ì…ë‹ˆë‹¤. íŠ¹íˆ ìˆ˜ì¹˜ ì—†ëŠ” ë¹„êµ ë°œì–¸, ê°ì •ì  ë°˜ì‘, ë¯¸í™•ì¸ ì •ë³´ ì–¸ê¸‰ì€ ì„ ê±° ìš´ë™ì—ì„œ ê°€ì¥ í”í•œ ì‹¤ìˆ˜ì´ì ì¹˜ëª…ì ì¸ ë¦¬ìŠ¤í¬ì…ë‹ˆë‹¤. ìº í”„ ë‚´ ëª¨ë“  ëŒ€ë³€ì¸ê³¼ ìœ ì„¸ ìŠ¤íƒœí”„ê°€ ì´ ê°€ì´ë“œë¥¼ ê³µìœ í•˜ì—¬ ì¼ê´€ëœ ë©”ì‹œì§€ë¥¼ ìœ ì§€í•˜ì‹­ì‹œì˜¤.`,
      `SNS í”Œë«í¼ë³„ í†¤ì•¤ë§¤ë„ˆëŠ” ê° í”Œë«í¼ì˜ ì£¼ìš” ì´ìš©ìì¸µê³¼ ì½˜í…ì¸  ì†Œë¹„ ë°©ì‹ì— ë§ê²Œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ìœ íŠœë¸ŒëŠ” ì‡¼ì¸ Â·ë¼ì´ë¸Œ, ì¸ìŠ¤íƒ€ê·¸ë¨ì€ ê°ì„± ì´ë¯¸ì§€, í˜ì´ìŠ¤ë¶ì€ ì •ì±… í…ìŠ¤íŠ¸, XëŠ” ì´ìŠˆ ì„ ì œ ëŒ€ì‘ì— ì§‘ì¤‘í•˜ì‹­ì‹œì˜¤. í”Œë«í¼ë³„ë¡œ ë™ì¼ ë©”ì‹œì§€ë¥¼ í˜•ì‹ë§Œ ë°”ê¿” ê³µìœ í•˜ëŠ” 'í¬ë¡œìŠ¤í¬ìŠ¤íŒ…'ì„ ê¸°ë³¸ ìš´ì˜ ë°©ì‹ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.`
    ])}
  </div>`;
}

/* â”€â”€ Section 7: ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„ (êµ¬ Section 5) â”€â”€ */
function buildSection7_Attack(target, col, candidates) {
  const ATTACK_DB = {
    ê³µìµì„±: { point: 'ì§€ì—­ ì†Œì™¸ ê³„ì¸µ ë°©ì¹˜ ì˜í˜¹', scenario: '"íŠ¹ì • ì§€ì—­Â·ê³„ì¸µë§Œ ì±™ê¸´ë‹¤"ëŠ” í”„ë ˆì„ ê³µì„¸ ì˜ˆìƒ', defense: 'ê³µìµ ì‚¬ì—… ìˆ˜í˜œ ëŒ€ìƒ ë°ì´í„° ê³µê°œ, ì†Œì™¸ ì§€ì—­ ë°©ë¬¸ ì¼ì • ì„ ì œ í™ë³´' },
    ì •ì±…ì‹¤í–‰ë ¥: { point: 'ê³µì•½ ë¶ˆì´í–‰ ê³µê²©', scenario: '"ë§ë§Œ ë§ê³  ì´í–‰ë¥ ì´ ë‚®ë‹¤"ëŠ” ì´ì „ ê³µì•½ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê³µì„¸ ì˜ˆìƒ', defense: 'ê³µì•½ ì´í–‰ë¥  í˜„í™© ì„ ì œ ê³µê°œ, ë¯¸ì´í–‰ ê±´ ì´ìœ  ë° ëŒ€ì•ˆ ëª…í™• ì„¤ëª…' },
    ì „ë¬¸ì„±: { point: 'ìê²©Â·ì „ë¬¸ì„± ë¶€ì¡± ì˜í˜¹', scenario: '"í•´ë‹¹ ë¶„ì•¼ ê²½í—˜ì´ ë¶€ì¡±í•˜ë‹¤"ëŠ” ê²€ì¦ ê³µì„¸ ì˜ˆìƒ', defense: 'ê´€ë ¨ ì´ë ¥Â·ìê²© ì§‘ì¤‘ í™ë³´, ì „ë¬¸ê°€ ì¶”ì²œì‚¬Â·í˜‘ë ¥ ì‚¬ë¡€ ê³µê°œ' },
    ëŒ€ì‘ì„±: { point: 'ë¯¼ì› ë¬´ëŒ€ì‘Â·ëŠ‘ì¥ ëŒ€ì‘ ì§€ì ', scenario: '"ë¯¼ì›ì„ ë¬´ì‹œí•œë‹¤"ëŠ” SNS í™•ì‚° ê°€ëŠ¥', defense: 'ì‘ë‹µ ì†ë„ ê°œì„  ì²´ê³„ ê³µê°œ, ì²˜ë¦¬ ì™„ë£Œ ê±´ ìˆ˜ì¹˜ ì œì‹œ' },
    ì±…ì„ì„±: { point: 'ê³¼ê±° ì•½ì† ìœ„ë°˜ ê³µê²©', scenario: '"ì „ì—ë„ ì§€í‚¤ì§€ ì•Šì•˜ë‹¤"ëŠ” ì•„ì¹´ì´ë¸Œ ê³µì„¸ ì˜ˆìƒ', defense: 'ì „ì²´ ê³µì•½ ì´í–‰ í˜„í™©í‘œ ì„ ì œ ê³µê°œ, ë³€ê²½ ì‚¬ìœ  íˆ¬ëª… ì„¤ëª…' },
    ì†Œí†µëŠ¥ë ¥: { point: 'ë¶ˆí†µÂ·ì—˜ë¦¬íŠ¸ ì´ë¯¸ì§€ ê³µê²©', scenario: '"í˜„ì¥ì„ ëª¨ë¥¸ë‹¤", "ì˜¤ë§Œí•˜ë‹¤"ëŠ” í”„ë ˆì„ ìœ í¬ ì˜ˆìƒ', defense: 'í˜„ì¥ ë°©ë¬¸ ë¹ˆë„ ìˆ˜ì¹˜ ê³µê°œ, ì‹œë¯¼ ê°„ë‹´íšŒ ì •ê¸° ê°œìµœ' },
    ë¦¬ë”ì‹­: { point: 'ìš°ìœ ë¶€ë‹¨Â·ê²°ë‹¨ë ¥ ë¶€ì¬ ê³µê²©', scenario: '"ì¤‘ìš”í•œ ìˆœê°„ì— ê²°ì •ì„ ëª» í•œë‹¤"ëŠ” ë¹„íŒ ì˜ˆìƒ', defense: 'ê³¼ê±° ê²°ë‹¨ ì‚¬ë¡€ ìŠ¤í† ë¦¬ ë°œêµ´, ì…ì¥ ëª…í™•í™” ë°œì–¸ ê°•í™”' },
    ë¹„ì „ëª…í™•ì„±: { point: 'ì¶”ìƒì  ë¹„ì „Â·ì‹¤í˜„ ë¶ˆê°€ ê³µì•½ ì§€ì ', scenario: '"ë§ì´ ì¢‹ì„ ë¿ êµ¬ì²´ì„±ì´ ì—†ë‹¤"ëŠ” ë¹„íŒ ì˜ˆìƒ', defense: 'ìˆ˜ì¹˜í˜• ëª©í‘œ ì¬ì„¤ì •Â·ê³µí‘œ, ë‹¨ê³„ë³„ ë¡œë“œë§µ ê³µê°œ' },
    ì²­ë ´ì„±: { point: 'ì´í•´ì¶©ëŒÂ·ì¬ì • íˆ¬ëª…ì„± ì˜í˜¹', scenario: 'ì¬ì‚°Â·í›„ì›ê¸ˆ ê´€ë ¨ ì˜í˜¹ ì œê¸° ê°€ëŠ¥ì„±', defense: 'ì¬ì‚° ê³µê°œ ìë°œì  ì—…ë°ì´íŠ¸, ì´í•´ì¶©ëŒ ë°©ì§€ ì„œì•½ì„œ ê³µê°œ' },
    ìœ¤ë¦¬ì„±: { point: 'ê³¼ê±° í–‰ë™Â·ë°œì–¸ ë…¼ë€ ì¬ì†Œí™˜', scenario: 'ê³¼ê±° SNSÂ·ë°œì–¸ ì•„ì¹´ì´ë¸Œ ë°œêµ´ ê³µì„¸ ì˜ˆìƒ', defense: 'ê³¼ê±° ë…¼ë€ ì‚¬ì „ íŒŒì•…Â·í•´ëª…ë¬¸ ì¤€ë¹„, í–‰ë™ê°•ë ¹ ì¬ì„œì•½ ê³µê°œ' }
  };

  const riskMetrics = METRICS.map(m => ({ m, s: target.metrics?.[m]??0 })).sort((a,b)=>a.s-b.s).slice(0,5);

  const cards = riskMetrics.map((x) => {
    const db = ATTACK_DB[x.m];
    const level = x.s < 70 ? { label:'ê³ ìœ„í—˜', color:'#dc2626', bg:'#fee2e2' }
                : x.s < 78 ? { label:'ì¤‘ìœ„í—˜', color:'#d97706', bg:'#fffbeb' }
                : { label:'ì €ìœ„í—˜', color:'#16a34a', bg:'#f0fdf4' };
    return `
    <div class="attack-card" style="border-left-color:${level.color}">
      <div class="attack-head">
        <span class="attack-level" style="background:${level.bg};color:${level.color}">${level.label}</span>
        <span class="attack-point">${db.point}</span>
        <span style="margin-left:auto;font-size:12px;color:var(--text-muted)">${METRIC_LABELS[x.m]} ${x.s}ì </span>
      </div>
      <div class="attack-scenario">ğŸ“Œ ì˜ˆìƒ ê³µê²©: ${db.scenario}</div>
      <div class="defense-row">ğŸ›¡ï¸ <strong>ë°©ì–´ ì „ëµ:</strong> ${db.defense}</div>
    </div>`;
  }).join('');

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#7f1d1d,#dc2626)">
      <div class="s-num">7</div>âš”ï¸ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„ Â· ë°©ì–´ ì „ëµ
    </div>
    <div class="insight-box" style="background:#fff1f2;border-color:#fda4af;color:#9f1239;margin-bottom:16px">
      í•˜ìœ„ ì ìˆ˜ í•­ëª©ì€ <strong>ìƒëŒ€ í›„ë³´ì˜ ê³µê²© í¬ì¸íŠ¸</strong>ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      ì˜ˆìƒ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ì™€ ë°©ì–´ ì „ëµì„ ì‚¬ì „ì— ì¤€ë¹„í•˜ì„¸ìš”.
    </div>
    ${cards}
    ${(()=>{
      const riskMetrics = METRICS.map(m=>({m,s:target.metrics?.[m]??0})).sort((a,b)=>a.s-b.s).slice(0,3);
      const highRisk = riskMetrics.filter(x=>x.s<70).map(x=>METRIC_LABELS[x.m]);
      const midRisk = riskMetrics.filter(x=>x.s>=70&&x.s<78).map(x=>METRIC_LABELS[x.m]);
      return summaryBox('ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„ Â· ë°©ì–´ ì „ëµ ì¢…í•© ì„¤ëª…', [
        `ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„ì€ ${target.name}ì˜ í•˜ìœ„ ì ìˆ˜ í•­ëª©ì—ì„œ ìƒëŒ€ í›„ë³´ê°€ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ê³µì„¸ë¥¼ ê°€í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì‚¬ì „ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤. ${highRisk.length>0?`íŠ¹íˆ <strong>${highRisk.join(', ')}</strong>ì€(ëŠ”) 70ì  ë¯¸ë§Œì˜ 'ê³ ìœ„í—˜' í•­ëª©ìœ¼ë¡œ, ê³µê²©ì´ ì‹œì‘ë  ê²½ìš° ì¦‰ê° ëŒ€ì‘í•  ìˆ˜ ìˆëŠ” ë°©ì–´ ìë£Œë¥¼ ë¯¸ë¦¬ ì¤€ë¹„í•´ì•¼ í•©ë‹ˆë‹¤.`:'í˜„ì¬ ëª¨ë“  í•­ëª©ì´ 70ì  ì´ìƒìœ¼ë¡œ ê³ ìœ„í—˜ í•­ëª©ì€ ì—†ìŠµë‹ˆë‹¤.'}`,
        `${midRisk.length>0?`<strong>${midRisk.join(', ')}</strong>ì€(ëŠ”) 'ì¤‘ìœ„í—˜' í•­ëª©ì…ë‹ˆë‹¤. ê³µê²©ì´ ì˜ˆìƒë˜ëŠ” ì‹œì (ì£¼ìš” í† ë¡ íšŒ, ì–¸ë¡  ì§‘ì¤‘ ê¸°ê°„)ì— ì•ì„œ ì„ ì œì  í•´ëª… ìë£Œì™€ ìˆ˜ì¹˜ ê·¼ê±°ë¥¼ ë°°í¬í•¨ìœ¼ë¡œì¨ ê³µê²©ì˜ íš¨ê³¼ë¥¼ ì‚¬ì „ ì°¨ë‹¨í•˜ëŠ” 'ë°©ì–´ì  ì„ ì œ ê³µê°œ' ì „ëµì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.`:'ì¤‘ìœ„í—˜ í•­ëª©ì— ëŒ€í•´ì„œë„ ë°©ì–´ íƒœì„¸ë¥¼ ìœ ì§€í•˜ì‹­ì‹œì˜¤.'}`,
        `ë°©ì–´ ì „ëµì˜ í•µì‹¬ ì›ì¹™ì€ 'ê³µê²©ë°›ì€ í›„ í•´ëª…í•˜ëŠ” ê²ƒë³´ë‹¤ ê³µê²©ë°›ê¸° ì „ íˆ¬ëª…í•˜ê²Œ ê³µê°œí•˜ëŠ” ê²ƒì´ ë‚«ë‹¤'ëŠ” ê²ƒì…ë‹ˆë‹¤. ì•½ì  í•­ëª©ì— ëŒ€í•œ ë°ì´í„°ì™€ ê°œì„  ê³„íšì„ ë¨¼ì € ê³µê°œí•¨ìœ¼ë¡œì¨ 'ìˆ¨ê¸¸ ê²ƒì´ ì—†ëŠ” í›„ë³´'ë¼ëŠ” ì´ë¯¸ì§€ë¥¼ êµ¬ì¶•í•˜ë©´ ìƒëŒ€ì˜ ê³µì„¸ ì†Œì¬ë¥¼ ë¬´ë ¥í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
        `ê° ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ì— ëŒ€í•´ ìº í”„ ëŒ€ë³€ì¸ì€ 30ì´ˆ ë‚´ ì¦‰ë‹µ ê°€ëŠ¥í•œ 'í•µì‹¬ ë°©ì–´ ë©”ì‹œì§€'ë¥¼ ì•”ê¸°í•˜ê³ , ìƒì„¸ ìë£ŒëŠ” ë³´ë„ìë£Œ í˜•íƒœë¡œ ì‚¬ì „ ì¤€ë¹„í•´ë‘ì‹­ì‹œì˜¤. ìœ„ê¸° ìƒí™©ì—ì„œì˜ ì´ˆê¸° ëŒ€ì‘ ì†ë„ê°€ ì—¬ë¡ ì˜ íë¦„ì„ ê²°ì •í•©ë‹ˆë‹¤. êµ¬ì²´ì ì¸ ìœ„ê¸° ë‹¨ê³„ë³„ ëŒ€ì‘ ë°©ë²•ì€ ë¦¬ìŠ¤í¬ ëŒ€ì‘ ë§¤ë‰´ì–¼(9ë²ˆ ì„¹ì…˜)ì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.`
      ]);
    })()}
  </div>`;
}

/* â”€â”€ Section 8: 90ì¼ ì‹¤í–‰ í”Œëœ + ìº í”„ ì¡°ì§ë³„ ë¶„ë°° (êµ¬ Section 6) â”€â”€ */
function buildSection8_Plan(target, col, rank, strat) {
  const plans = {
    1: [
      { phase:'1~30ì¼ (ì¦‰ì‹œ ì‹¤í–‰)', color:'#dc2626', tasks:[
        'ì·¨ì•½ ì§€í‘œ Top 3 ë°©ì–´ ìº í˜ì¸ ê¸°íš ë° ì‹¤í–‰',
        'ì§€ì§€ì¸µ í•µì‹¬ ëª…ë‹¨ íŒŒì•… ë° ê°ì‚¬ ì†Œí†µ í–‰ì‚¬ ê°œìµœ',
        'ê³µê²© ì˜ˆìƒ í¬ì¸íŠ¸ ì‚¬ì „ í•´ëª… ìë£Œ ì¤€ë¹„',
        'SNS ë°œì–¸ ì‚¬ì „ ê²€í†  ì²´ê³„ êµ¬ì¶•',
        'ì–¸ë¡  ê¸ì • ê¸°ì‚¬ ì†Œì¬ ë°°í¬ ì¼ì • ìˆ˜ë¦½'
      ]},
      { phase:'31~60ì¼ (ê°•í™”)', color:'#d97706', tasks:[
        'ê³µì•½ ì´í–‰ í˜„í™© 100ì¼ ë¦¬í¬íŠ¸ ë°œê°„',
        'ì¤‘ë„ì¸µ ìœ ì…ì„ ìœ„í•œ ì •ì±… í† ë¡ íšŒ ê°œìµœ',
        'ì§€ì—­ í˜„ì•ˆ ì´ìŠˆ ì„ ì  ë³´ë„ìë£Œ ë°œì†¡',
        '2ìœ„ í›„ë³´ ì „ëµ ëª¨ë‹ˆí„°ë§ ë° ëŒ€ì‘ ì¤€ë¹„',
        'ì§€ì§€ì¸µ ëŒ€ìƒ ê²°ì§‘ ì´ë²¤íŠ¸ ê°œìµœ'
      ]},
      { phase:'61~90ì¼ (ë§ˆë¬´ë¦¬)', color:'#16a34a', tasks:[
        'ìµœì¢… ë¹„ì „ ì„ ì–¸ í¼í¬ë¨¼ìŠ¤ ê¸°íš',
        'í•µì‹¬ ì§€ì§€ì¸µ íˆ¬í‘œ ë…ë ¤ ìº í˜ì¸',
        'ë§ˆì§€ë§‰ ì´ìŠˆ ëŒ€ì‘ ì‹œë®¬ë ˆì´ì…˜ ì ê²€',
        'ë¯¸ë””ì–´ ë…¸ì¶œ ì§‘ì¤‘ ë§ˆë¬´ë¦¬ ì „ëµ ì‹¤í–‰',
        'ì•ˆì „í•œ ìŠ¹ë¦¬ë¥¼ ìœ„í•œ ì‹¤ìˆ˜ ìµœì†Œí™” ì²´ê³„ ì ê²€'
      ]}
    ],
    2: [
      { phase:'1~30ì¼ (ê²©ì°¨ ì¶•ì†Œ)', color:'#dc2626', tasks:[
        '1ìœ„ ëŒ€ë¹„ ê²©ì°¨ 3ì  ì´ë‚´ í•­ëª© ì§‘ì¤‘ ê³µëµ ì‹œì‘',
        'í•˜ìœ„ ì§€í‘œ ì›ì¸ ë¶„ì„ í›„ ê°œì„  ìº í˜ì¸ ì‹¤í–‰',
        'ì°¨ë³„í™” ë©”ì‹œì§€ ë°œêµ´ ë° ë¸Œëœë”© ì¬ì„¤ì •',
        'ì§€ì—­ í˜„ì•ˆ ê´€ë ¨ ì„ ì œ ì…ì¥ í‘œëª…',
        'í•µì‹¬ ì§€ì§€ì¸µ ê²°ì§‘ ì†Œí†µ í–‰ì‚¬ ê°œìµœ'
      ]},
      { phase:'31~60ì¼ (ì—­ì „ ì‹œë„)', color:'#d97706', tasks:[
        'ìŠ¹ë¶€ì²˜ í•­ëª© ì§‘ì¤‘ í™ë³´ ìº í˜ì¸ ì‹¤í–‰',
        '1ìœ„ í›„ë³´ ì•½ì  ë¶„ì„ ê¸°ë°˜ ë¹„êµ ë©”ì‹œì§€ ì„¤ê³„',
        'ê³µì•½ ì´í–‰ë ¥Â·ì „ë¬¸ì„± ì¦ë¹™ ìë£Œ ëŒ€ëŸ‰ ë°°í¬',
        'ì¤‘ë„ì¸µ ìœ ì…ì„ ìœ„í•œ ì •ì±… ì´ìŠˆ ì„ ì ',
        'ì–¸ë¡  ì¸í„°ë·°Â·ê¸°ê³ ë¬¸ ë…¸ì¶œ ì§‘ì¤‘'
      ]},
      { phase:'61~90ì¼ (ìµœì¢… ì—­ì „)', color:'#16a34a', tasks:[
        'ì§€ì§€ìœ¨ ê²©ì°¨ í˜„í™© ì ê²€ ë° ì „ëµ ì¬ì¡°ì •',
        'í•µì‹¬ ì´ìŠˆ ìµœì¢… ì„ ì  ìº í˜ì¸',
        'íˆ¬í‘œì¸µ ì „í™˜ì„ ìœ„í•œ ì§ì ‘ ì†Œí†µ ê°•í™”',
        'ë§ˆì§€ë§‰ ì—­ì „ ê¸°íšŒ ì´ìŠˆ í¬ì°© ëŒ€ë¹„',
        'ì§€ì§€ì¸µ íˆ¬í‘œìœ¨ ê·¹ëŒ€í™” ìº í˜ì¸'
      ]}
    ],
    3: [
      { phase:'1~30ì¼ (ì¸ì§€ë„ ì í”„)', color:'#7c3aed', tasks:[
        'ê¸°ì¡´ ë©”ì‹œì§€ ì „ë©´ ì¬ì„¤ê³„, ë‹¨ë¬¸Â·ê°ì„± ìŠ¬ë¡œê±´ í™•ì •',
        'ë°”ì´ëŸ´ ê°€ëŠ¥í•œ SNS ì½˜í…ì¸  ì§‘ì¤‘ ì œì‘ (ì£¼ 3ê±´ ì´ìƒ)',
        'íƒ€ê²Ÿ ìœ ê¶Œì 3ê°œ ê·¸ë£¹ ì„ ì • ë° ë§ì¶¤ ì†Œí†µ ì‹œì‘',
        'ì§€ì—­ ì¸ì‚¬Â·ë‹¨ì²´ì™€ ê³µë™ í–‰ë³´ ê¸°íš',
        'ì–¸ë¡  ë…¸ì¶œ 0â†’1 ì „ëµ: ì§€ì—­ ì´ìŠˆ ì„ ì  ì‹œë„'
      ]},
      { phase:'31~60ì¼ (ì°¨ë³„í™” ê°•í™”)', color:'#d97706', tasks:[
        'ì°¨ë³„í™” ê°•ì  í•­ëª© ì§‘ì¤‘ í™ë³´ ìº í˜ì¸',
        'íƒ€ê²Ÿ ì§€ì§€ì¸µ í–‰ì‚¬Â·ê°„ë‹´íšŒ ì§‘ì¤‘ ê°œìµœ',
        'íƒ€í›„ë³´ ëŒ€ë¹„ ì°¨ë³„ì„± ë©”ì‹œì§€ ë¹„êµ ìë£Œ ë°°í¬',
        'ì´ìŠˆ ì„ ì  ì„±ê³µ ì‚¬ë¡€ ì¶•ì  ë° í™ë³´',
        'ì§€ì—­ ë§¤ì²´ ì¸í„°ë·° ì§‘ì¤‘ í™•ë³´'
      ]},
      { phase:'61~90ì¼ (ê²°ì§‘)', color:'#16a34a', tasks:[
        'í™•ë³´ëœ ì§€ì§€ì¸µ ê²°ì§‘ ì§‘ì¤‘ ê´€ë¦¬',
        'ìµœí›„ ì´ìŠˆ ì„ ì  ì‹œë„',
        'íˆ¬í‘œ ë…ë ¤ ì§ì ‘ ì†Œí†µ ê°•í™”',
        'í¬ì§€ì…˜ ë³€í™” ì„±ê³¼ ì´ì •ë¦¬ ë°°í¬',
        'ë§ˆì§€ë§‰ ì¸ìƒ ê´€ë¦¬ ë° ë§ˆë¬´ë¦¬ ìº í˜ì¸'
      ]}
    ]
  };

  const planData = plans[rank <= 2 ? rank : 3];

  // ìº í”„ ì¡°ì§ë³„ ì‹¤í–‰ ë¶„ë°°
  const orgRows = [
    { role: 'ì„ ëŒ€ìœ„ì¥Â·ì´ê´„', icon: 'ğŸ‘‘', color:'#1e3a8a',
      p1: 'ì „ëµ ë°©í–¥ í™•ì •, í•µì‹¬ ì´ìŠˆ ì˜ì‚¬ê²°ì •',
      p2: 'ì „ëµ ì¡°ì • íšŒì˜ ì£¼ì¬ (ì£¼ 1íšŒ)',
      p3: 'ìµœì¢… ê²°ê³¼ ì ê²€, íˆ¬í‘œìœ¨ ê´€ë¦¬' },
    { role: 'í™ë³´Â·ì–¸ë¡ íŒ€', icon: 'ğŸ“¡', color:'#7c3aed',
      p1: 'ë³´ë„ìë£Œ ë°°í¬ (ì£¼ 3íšŒ), ì–¸ë¡  ì¸í„°ë·° ì„¸íŒ…',
      p2: 'ì´ìŠˆ ì„ ì  ê¸°ì‚¬ ì§‘ì¤‘ ë°°í¬, ë°˜ë°•ë¬¸ ì¤€ë¹„',
      p3: 'ë§ˆë¬´ë¦¬ ê¸ì • ê¸°ì‚¬ ì§‘ì¤‘, TV ì¶œì—° ì¡°ìœ¨' },
    { role: 'SNSÂ·ë””ì§€í„¸íŒ€', icon: 'ğŸ“±', color:'#2563eb',
      p1: 'ì¼ì¼ ì½˜í…ì¸  ì œì‘, ëŒ“ê¸€ ëª¨ë‹ˆí„°ë§',
      p2: 'ë°”ì´ëŸ´ ì˜ìƒ ìº í˜ì¸, ê´‘ê³  ì§‘í–‰',
      p3: 'íˆ¬í‘œ ë…ë ¤ ì½˜í…ì¸  ì§‘ì¤‘, ë¼ì´ë¸Œ ë°©ì†¡' },
    { role: 'ì •ì±…Â·ê³µì•½íŒ€', icon: 'ğŸ“‹', color:'#16a34a',
      p1: 'ê³µì•½ ìˆ˜ì¹˜í™”, ì´í–‰ë¥  ì¶”ì  ìë£Œ ì¤€ë¹„',
      p2: 'í† ë¡ íšŒ ë‹µë³€ ì¤€ë¹„, ì •ì±… íŒ©íŠ¸ì²´í¬ ëŒ€ì‘',
      p3: 'ìµœì¢… ê³µì•½ì§‘ ë°°í¬, ìˆ˜ì¹˜í˜• ì„±ê³¼ ì •ë¦¬' },
    { role: 'í˜„ì¥Â·ì¡°ì§íŒ€', icon: 'ğŸ˜ï¸', color:'#d97706',
      p1: 'ì§€ì—­êµ¬ í–‰ì‚¬ ê´€ë¦¬, ì§€ì§€ì DB êµ¬ì¶•',
      p2: 'íƒ€ê²Ÿ ì§€ì—­ ì§‘ì¤‘ ë°©ë¬¸, ê°„ë‹´íšŒ ìš´ì˜',
      p3: 'ì§€ì§€ì¸µ íˆ¬í‘œ ë…ë ¤ ì§ì ‘ ì—°ë½' },
    { role: 'ë²•ë¬´Â·ë¦¬ìŠ¤í¬íŒ€', icon: 'âš–ï¸', color:'#dc2626',
      p1: 'ì„ ê±°ë²• ê²€í† , ë¦¬ìŠ¤í¬ ì´ìŠˆ ì‚¬ì „ ìŠ¤í¬ë¦¬ë‹',
      p2: 'ìƒëŒ€ ê³µì„¸ ë²•ì  ëŒ€ì‘ ê²€í† ',
      p3: 'ìœ„ë°˜ ì‚¬í•­ ìµœì¢… ì ê²€, ì„ ê±° ë‹¹ì¼ ë²•ì  ëŒ€ì‘ ì¤€ë¹„' }
  ];

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#1e3a8a,#1d4ed8)">
      <div class="s-num">8</div>ğŸ“… 90ì¼ ì•¡ì…˜ ë¡œë“œë§µ Â· ìº í”„ ì¡°ì§ë³„ ì‹¤í–‰ ë¶„ë°°
    </div>
    <div class="insight-box" style="margin-bottom:16px">
      ë°ì´í„° ê¸°ë°˜ ì „ëµì  ì„ íƒì§€ë¥¼ ì œì‹œí•©ë‹ˆë‹¤. êµ¬ì²´ì  ì‹¤í–‰ì€ í˜„ì¥ ìƒí™©ì— ë§ê²Œ ì¡°ì •í•˜ì„¸ìš”.
    </div>

    ${planData.map(p => `
    <div class="plan-phase">
      <div class="plan-phase-header" style="background:${p.color}">
        ğŸ“Œ ${p.phase}
      </div>
      <div class="plan-phase-body">
        ${p.tasks.map(t => `<div class="plan-task">${t}</div>`).join('')}
      </div>
    </div>`).join('')}

    <!-- ìº í”„ ì¡°ì§ë³„ ì‹¤í–‰ ë¶„ë°°í‘œ -->
    <div class="card" style="margin-top:8px">
      <div class="card-title">ğŸ›ï¸ ìº í”„ ì¡°ì§ë³„ ì‹¤í–‰ ë¶„ë°°í‘œ</div>
      <div class="org-table-wrap">
        <table class="org-table">
          <thead>
            <tr>
              <th>ì¡°ì§</th>
              <th>1~30ì¼</th>
              <th>31~60ì¼</th>
              <th>61~90ì¼</th>
            </tr>
          </thead>
          <tbody>
            ${orgRows.map(r => `
            <tr>
              <td><span class="org-role" style="color:${r.color}">${r.icon} ${r.role}</span></td>
              <td style="font-size:12px;color:var(--text-muted)">${r.p1}</td>
              <td style="font-size:12px;color:var(--text-muted)">${r.p2}</td>
              <td style="font-size:12px;color:var(--text-muted)">${r.p3}</td>
            </tr>`).join('')}
          </tbody>
        </table>
      </div>
    </div>

    <div class="insight-box" style="background:#f8fafc;border-color:var(--border);color:var(--text-muted);font-size:12px;margin-top:16px">
      âš ï¸ <strong>ì¤‘ìš” ì•ˆë‚´:</strong> ë³¸ ë³´ê³ ì„œëŠ” ê³µê°œëœ ë°ì´í„° ê¸°ë°˜ì˜ ê°ê´€ì  ë¶„ì„ì´ë©°,
      íŠ¹ì • í›„ë³´ì— ëŒ€í•œ ì§€ì§€ ë˜ëŠ” ì„ ê±° ê²°ê³¼ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      ì „ëµì  ì„ íƒì§€ ì œì‹œì™€ ì˜ì‚¬ê²°ì • ì§€ì›ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.
      ì„ ê±° ê´€ë ¨ ë²•ë ¹ ì¤€ìˆ˜ëŠ” í›„ë³´ìì™€ ìº í”„ì˜ ì±…ì„ì…ë‹ˆë‹¤.
    </div>
    ${summaryBox('90ì¼ ì•¡ì…˜ ë¡œë“œë§µ Â· ìº í”„ ì¡°ì§ë³„ ë¶„ë°° ì¢…í•© ì„¤ëª…', [
      `90ì¼ ë¡œë“œë§µì€ ì„ ê±° ìº í”„ê°€ ì§€ê¸ˆ ë‹¹ì¥ ì‹¤í–‰í•´ì•¼ í•  ê³¼ì œë¥¼ 30ì¼ ë‹¨ìœ„ë¡œ êµ¬ë¶„í•˜ì—¬ ì œì‹œí•©ë‹ˆë‹¤. 1~30ì¼ì€ 'ì¦‰ì‹œ ì‹¤í–‰' ë‹¨ê³„ë¡œ ê¸´ê¸‰ ëŒ€ì‘ê³¼ ë°©í–¥ ì„¤ì •ì— ì§‘ì¤‘í•˜ê³ , 31~60ì¼ì€ 'ê°•í™” ë° í™•ì¥' ë‹¨ê³„ë¡œ ì „ëµì„ ì‹¬í™”í•˜ë©°, 61~90ì¼ì€ 'ë§ˆë¬´ë¦¬ ì§‘ì¤‘' ë‹¨ê³„ë¡œ íˆ¬í‘œìœ¨ ê·¹ëŒ€í™”ì— ì´ë ¥ì„ ê¸°ìš¸ì´ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.`,
      `ìº í”„ ì¡°ì§ë³„ ì‹¤í–‰ ë¶„ë°°í‘œëŠ” ê° ë¶€ì„œê°€ 30ì¼ ë‹¨ìœ„ë¡œ ë¬´ì—‡ì„ í•´ì•¼ í•˜ëŠ”ì§€ë¥¼ ëª…í™•íˆ ì •ì˜í•©ë‹ˆë‹¤. ì—­í•  ì¤‘ë³µê³¼ ê³µë°±ì„ ì—†ì• ëŠ” ê²ƒì´ ì¡°ì§ ìš´ì˜ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ì„ ëŒ€ìœ„ì¥ì€ ì „ëµ ë°©í–¥ê³¼ ìµœì¢… ì˜ì‚¬ê²°ì •ì— ì§‘ì¤‘í•˜ê³ , ê° íŒ€ì¥ì€ ì†Œê´€ ì—…ë¬´ì˜ ì¼ì • ì¤€ìˆ˜ì™€ ê²°ê³¼ ë³´ê³ ì— ì±…ì„ì„ ì§€ëŠ” ìˆ˜ì§ì -ìˆ˜í‰ì  í˜‘ì—… êµ¬ì¡°ë¥¼ êµ¬ì¶•í•˜ì‹­ì‹œì˜¤.`,
      `ë¡œë“œë§µ ì‹¤í–‰ì—ì„œ ê°€ì¥ í”í•œ ì‹¤íŒ¨ ì›ì¸ì€ 'ê³„íšì€ ìˆìœ¼ë‚˜ ì‹¤í–‰ ì±…ì„ìê°€ ë¶ˆëª…í™•í•œ ê²ƒ'ì…ë‹ˆë‹¤. ê° íƒœìŠ¤í¬ë§ˆë‹¤ ë‹´ë‹¹ìì™€ ì™„ë£Œ ê¸°ì¤€ì„ ëª…ì‹œí•˜ê³ , ì£¼ 1íšŒ ì§„í–‰ ìƒí™©ì„ ì ê²€í•˜ëŠ” 'ì „ëµ ì ê²€ ë¯¸íŒ…'ì„ ì •ë¡€í™”í•˜ì‹­ì‹œì˜¤. ì‹¤í–‰ ê²°ê³¼ë¥¼ ì§€ì†ì ìœ¼ë¡œ í”¼ë“œë°±í•˜ì—¬ ì¤‘ê°„ì— ì „ëµì„ ìœ ì—°í•˜ê²Œ ì¡°ì •í•  ìˆ˜ ìˆëŠ” ì²´ê³„ë¥¼ ê°–ì¶”ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.`,
      `90ì¼ ë¡œë“œë§µì€ ê³ ì •ëœ ê³„íšì´ ì•„ë‹Œ 'ì‚´ì•„ìˆëŠ” ì „ëµ ë¬¸ì„œ'ì…ë‹ˆë‹¤. ì—¬ë¡  ë³€í™”, ê²½ìŸ í›„ë³´ì˜ ì›€ì§ì„, ì´ìŠˆ ë°œìƒ ë“± ì™¸ë¶€ ë³€ìˆ˜ì— ë”°ë¼ ìš°ì„ ìˆœìœ„ë¥¼ ì‹ ì†í•˜ê²Œ ì¬ì¡°ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ë¡œë“œë§µì„ ê¸°ë°˜ìœ¼ë¡œ ë¦¬ìŠ¤í¬ ë°œìƒ ì‹œ ëŒ€ì‘ ë§¤ë‰´ì–¼(9ë²ˆ ì„¹ì…˜)ê³¼ ì—°ê³„í•˜ì—¬ ìœ„ê¸° ìƒí™©ì—ì„œë„ ì „ëµì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ì‹­ì‹œì˜¤.`
    ])}
  </div>`;
}

/* â”€â”€ Section 9: ë¦¬ìŠ¤í¬ ë°œìƒ ì‹œ ëŒ€ì‘ ë§¤ë‰´ì–¼ (NEW) â”€â”€ */
function buildSection9_RiskManual(target, col) {
  const risks = [
    {
      type: 'ë°œì–¸ ì‹¤ìˆ˜Â·ë…¼ë€ ë°œìƒ',
      icon: 'ğŸ”Š', color: '#dc2626',
      steps: [
        { time: 'ì¦‰ì‹œ (1ì‹œê°„ ë‚´)', text: 'ê´€ë ¨ìÂ·ìº í”„ ìƒí™© íŒŒì•…, SNS í™•ì‚° ëª¨ë‹ˆí„°ë§ ì‹œì‘, ì™¸ë¶€ ë¯¸ë””ì–´ ëŒ€ì‘ ì¼ì›í™”(ëŒ€ë³€ì¸ë§Œ)' },
        { time: '6ì‹œê°„ ë‚´', text: 'íŒ©íŠ¸ í™•ì¸ ì™„ë£Œ í›„ ê³µì‹ í•´ëª… ë˜ëŠ” ì‚¬ê³¼ë¬¸ ì´ˆì•ˆ ì‘ì„± (ë²•ë¥ íŒ€ ê²€í† )' },
        { time: '24ì‹œê°„ ë‚´', text: 'ê³µì‹ ì…ì¥ë¬¸ ë°œí‘œ, ê¸°ì ë¸Œë¦¬í•‘ ë˜ëŠ” SNS ì§ì ‘ ì…ì¥ ê³µì§€, í›„ì† ì§ˆë¬¸ ì‚¬ì „ ì¤€ë¹„' },
        { time: '72ì‹œê°„ ë‚´', text: 'í˜„ì¥ ë°©ë¬¸Â·ê¸ì • í–‰ì‚¬ë¡œ ì´ë¯¸ì§€ ë³µêµ¬, ì§€ì§€ì¸µ ì•ˆì‹¬ ë©”ì‹œì§€ ë°œì†¡, ëª¨ë‹ˆí„°ë§ ì§€ì†' }
      ]
    },
    {
      type: 'ê²½ìŸ í›„ë³´ í—ˆìœ„ ê³µì„¸Â·í‘ìƒ‰ì„ ì „',
      icon: 'âš”ï¸', color: '#7c3aed',
      steps: [
        { time: 'ì¦‰ì‹œ', text: 'í—ˆìœ„ ë‚´ìš© ìŠ¤í¬ë¦°ìƒ·Â·ì•„ì¹´ì´ë¸Œ ìˆ˜ì§‘, ë²•ë¥ íŒ€ ëŒ€ì‘ ê²€í†  ì‹œì‘, í™•ì‚° ë²”ìœ„ íŒŒì•…' },
        { time: '6ì‹œê°„ ë‚´', text: 'ë°˜ë°• íŒ©íŠ¸ ìë£Œ ì¤€ë¹„ (í—ˆìœ„ í¬ì¸íŠ¸ë³„ ê·¼ê±° ì²¨ë¶€), ê³µì‹ ë°˜ë°•ë¬¸ ì‘ì„±' },
        { time: '24ì‹œê°„ ë‚´', text: 'ë³´ë„ìë£Œ ë°°í¬ + SNS ë°˜ë°• ê²Œì‹œ, ê²½ìš°ì— ë”°ë¼ ì„ ê´€ìœ„ ì‹ ê³ Â·ë²•ì  ëŒ€ì‘ ê²€í† ' },
        { time: '72ì‹œê°„ ë‚´', text: 'ì§€ì§€ì ì•ˆì‹¬ ì†Œí†µ ë©”ì‹œì§€ ë°œì†¡, ì´ìŠˆ ì „í™˜ ê¸ì • ì½˜í…ì¸  ì§‘ì¤‘ ë°°í¬' }
      ]
    },
    {
      type: 'ì—¬ë¡ ì¡°ì‚¬ í•˜ë½Â·ì§€ì§€ìœ¨ ê¸‰ë½',
      icon: 'ğŸ“‰', color: '#d97706',
      steps: [
        { time: 'ì¦‰ì‹œ', text: 'ì¡°ì‚¬ í‘œë³¸Â·ë°©ë²•ë¡  ê²€í† , í•˜ë½ ì›ì¸ ë‚´ë¶€ ë¶„ì„ íšŒì˜ ì†Œì§‘, íŒ¨ë‹‰ ê¸ˆì§€' },
        { time: '6ì‹œê°„ ë‚´', text: 'í•µì‹¬ ì§€ì§€ì¸µ ëŒ€ìƒ ê¸´ê¸‰ ì†Œí†µ (ì „í™”Â·ë¬¸ì), í•˜ë½ ìš”ì¸ ê´€ë ¨ ê³µì•½ ì…ì¥ ì •ë¦¬' },
        { time: '24ì‹œê°„ ë‚´', text: 'í˜„ì¥ ë°©ë¬¸Â·ë¯¼ì‹¬ ì²­ì·¨ í–‰ì‚¬ ê¸°íš, ì–¸ë¡  ì„ ì œ ì¸í„°ë·° ì¶”ì§„, í¬ì§€ì…˜ ì¬ê°•ì¡°' },
        { time: '72ì‹œê°„ ë‚´', text: 'ì§€ì§€ì¸µ ê²°ì§‘ ì´ë²¤íŠ¸ ê°œìµœ, ì¤‘ë„ì¸µ í¡ìˆ˜ ìƒˆ ê³µì•½ ë°œí‘œ ê²€í† ' }
      ]
    },
    {
      type: 'ë‚´ë¶€ ê°ˆë“±Â·ì¡°ì§ ë¶„ì—´ ìœ ì¶œ',
      icon: 'ğŸ’¥', color: '#dc2626',
      steps: [
        { time: 'ì¦‰ì‹œ', text: 'ê´€ë ¨ì ì†Œì§‘ ë¹„ê³µê°œ íšŒì˜, ì–¸ë¡  ì ‘ì´‰ ì¼ì›í™” (ëŒ€ë³€ì¸ë§Œ), ì™¸ë¶€ í™•ì‚° ì°¨ë‹¨' },
        { time: '6ì‹œê°„ ë‚´', text: 'ë‚´ë¶€ ê°ˆë“± ë´‰í•© í˜‘ì˜, ì‚¬ì‹¤ê´€ê³„ ì •ë¦¬, ìƒëŒ€ ìº í”„ í™œìš© ê°€ëŠ¥ì„± ì°¨ë‹¨' },
        { time: '24ì‹œê°„ ë‚´', text: 'í†µí•© ë©”ì‹œì§€ ë°œí‘œ (ë‚´ë¶€ ê²°ì† ê°•ì¡°), í•„ìš”ì‹œ ì—­í•  êµ¬ì¡° ì¡°ì •' },
        { time: '72ì‹œê°„ ë‚´', text: 'ì „ëµ íšŒì˜ ì¬ì •ë¹„, ì¬ë°œ ë°©ì§€ ë‚´ê·œ ì„¤ì •, ì§€ì§€ì¸µ ì‹ ë¢° íšŒë³µ ë©”ì‹œì§€' }
      ]
    },
    {
      type: 'ì–¸ë¡  ì•…ì„± ë³´ë„Â·í”„ë ˆì„ ì„¤ì •',
      icon: 'ğŸ“°', color: '#1e3a8a',
      steps: [
        { time: 'ì¦‰ì‹œ', text: 'ë³´ë„ ë‚´ìš© íŒ©íŠ¸ ì²´í¬, ì˜¤ë³´ ì—¬ë¶€ í™•ì¸, í•´ë‹¹ ë§¤ì²´ í¸ì§‘êµ­ í•­ì˜ ì—¬ë¶€ ê²€í† ' },
        { time: '6ì‹œê°„ ë‚´', text: 'ë°˜ë°• ë³´ë„ìë£Œ ë°œì†¡, ìš°í˜¸ ì–¸ë¡ ë§¤ì²´ ì—­ë³´ë„Â·ì¸í„°ë·° ìš”ì²­' },
        { time: '24ì‹œê°„ ë‚´', text: 'ì§ì ‘ SNS í•´ëª… ê²Œì‹œ, ìœ íŠœë¸ŒÂ·ë¼ì´ë¸Œ ë“± ì§ì ‘ ì†Œí†µ ì±„ë„ë¡œ ì‚¬ì‹¤ ì „ë‹¬' },
        { time: '72ì‹œê°„ ë‚´', text: 'í”„ë ˆì„ ì „í™˜ì„ ìœ„í•œ ìƒˆ ì´ìŠˆ ì„ ì , ë³´ë„ ëª¨ë‹ˆí„°ë§ ê°•í™”' }
      ]
    }
  ];

  const cards = risks.map(r => `
  <div class="risk-card">
    <div class="risk-header" style="background:${r.color}">
      ${r.icon} ${r.type}
    </div>
    <div class="risk-body">
      <div class="risk-timeline">
        ${r.steps.map(s => `
        <div class="risk-step">
          <span class="risk-step-time" style="background:${r.color}22;color:${r.color}">${s.time}</span>
          <span class="risk-step-text">${s.text}</span>
        </div>`).join('')}
      </div>
    </div>
  </div>`).join('');

  return `
  <div class="report-section">
    <div class="s-header" style="background:linear-gradient(90deg,#7f1d1d,#dc2626)">
      <div class="s-num">9</div>ğŸš¨ ë¦¬ìŠ¤í¬ ë°œìƒ ì‹œ ëŒ€ì‘ ë§¤ë‰´ì–¼
    </div>
    <div class="insight-box" style="background:#fff1f2;border-color:#fda4af;color:#9f1239;margin-bottom:16px">
      ìœ„ê¸°ëŠ” ì˜ˆê³  ì—†ì´ ì˜µë‹ˆë‹¤. <strong>ìœ í˜•ë³„ ë‹¨ê³„ë³„ ëŒ€ì‘ ë§¤ë‰´ì–¼</strong>ì„ ì‚¬ì „ì— ìˆ™ì§€í•˜ê³  ìº í”„ ì „ì²´ê°€ ê³µìœ í•˜ì„¸ìš”.
      ê³¨ë“ íƒ€ì„ì„ ë†“ì¹˜ë©´ ì´ìŠˆê°€ êµ³ì–´ì§‘ë‹ˆë‹¤.
    </div>
    ${cards}
    ${summaryBox('ë¦¬ìŠ¤í¬ ë°œìƒ ì‹œ ëŒ€ì‘ ë§¤ë‰´ì–¼ ì¢…í•© ì„¤ëª…', [
      `ë¦¬ìŠ¤í¬ ëŒ€ì‘ ë§¤ë‰´ì–¼ì€ ë°œì–¸ ì‹¤ìˆ˜, ìƒëŒ€ í›„ë³´ ê³µì„¸, ì§€ì§€ìœ¨ ê¸‰ë½, ë‚´ë¶€ ê°ˆë“±, ì–¸ë¡  ì•…ì„± ë³´ë„ ë“± 5ê°€ì§€ ìœ„ê¸° ìœ í˜•ë³„ë¡œ ì¦‰ì‹œÂ·6ì‹œê°„Â·24ì‹œê°„Â·72ì‹œê°„ì˜ 4ë‹¨ê³„ ëŒ€ì‘ ì ˆì°¨ë¥¼ ì œì‹œí•©ë‹ˆë‹¤. ìœ„ê¸° ëŒ€ì‘ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ 'ì†ë„'ì™€ 'ì¼ê´€ì„±'ì…ë‹ˆë‹¤. ì²« ëŒ€ì‘ì´ ëŠë¦¬ê±°ë‚˜ í˜¼ì„ ì´ ìƒê¸°ë©´ ì´ìŠˆê°€ ì¦í­ë˜ì–´ í†µì œ ë¶ˆëŠ¥ ìƒíƒœë¡œ ì•…í™”ë©ë‹ˆë‹¤.`,
      `ê° ìœ„ê¸° ë‹¨ê³„ì—ì„œ 'ì¦‰ì‹œ(1ì‹œê°„ ë‚´)' ì¡°ì¹˜ëŠ” í™•ì‚° ì°¨ë‹¨ê³¼ ìƒí™© íŒŒì•…ì— ì§‘ì¤‘í•˜ë©°, ì´ ì‹œì ì—ì„œì˜ ì–´ë–¤ ê³µì‹ ë°œì–¸ë„ ì™¸ë¶€ë¡œ ë‚˜ê°€ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤. ëª¨ë“  ì–¸ë¡  ë° SNS ëŒ€ì‘ì€ ë°˜ë“œì‹œ ëŒ€ë³€ì¸ì„ í†µí•´ ì¼ì›í™”í•˜ì‹­ì‹œì˜¤. '6ì‹œê°„ ë‚´'ì—ëŠ” íŒ©íŠ¸ í™•ì¸ì„ ì™„ë£Œí•˜ê³  ê³µì‹ ì…ì¥ì„ ê²°ì •í•˜ë©°, '24ì‹œê°„ ë‚´'ì—ëŠ” ê³µì‹ ë°œí‘œë¡œ ì´ìŠˆë¥¼ ë§¤ë“­ì§“ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.`,
      `ë‚´ë¶€ ê°ˆë“± ìœ ì¶œê³¼ ë°œì–¸ ì‹¤ìˆ˜ëŠ” ì„ ê±° ìš´ë™ì—ì„œ ê°€ì¥ ë¹ˆë²ˆí•˜ê²Œ ë°œìƒí•˜ëŠ” ìœ„ê¸° ìœ í˜•ì…ë‹ˆë‹¤. ì´ë¥¼ ì˜ˆë°©í•˜ê¸° ìœ„í•´ ìº í”„ ë‚´ ì •ë³´ ê³µìœ  ì›ì¹™ì„ ëª…í™•íˆ í•˜ê³ , ëª¨ë“  ê³µê°œ ë°œì–¸ ì „ ëŒ€ë³€ì¸ ê²€í†  ì ˆì°¨ë¥¼ ì˜ë¬´í™”í•˜ì‹­ì‹œì˜¤. ì˜ˆë°©ì´ ì‚¬í›„ ëŒ€ì‘ë³´ë‹¤ í›¨ì”¬ íš¨ê³¼ì ì´ê³  ìì› ì†Œëª¨ê°€ ì ìŠµë‹ˆë‹¤.`,
      `ì´ ë§¤ë‰´ì–¼ì„ ìº í”„ ì „ì²´ê°€ ì¸ì‡„í•˜ì—¬ ë¹„ì¹˜í•˜ê³  ì •ê¸°ì ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜ í›ˆë ¨ì„ ì‹¤ì‹œí•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. ì‹¤ì œ ìœ„ê¸° ìƒí™©ì—ì„œëŠ” íŒë‹¨ë ¥ì´ ì €í•˜ë˜ë¯€ë¡œ ë§¤ë‰´ì–¼ëŒ€ë¡œ ì›€ì§ì´ëŠ” 'ë£¨í‹´í™”ëœ ìœ„ê¸° ëŒ€ì‘'ì´ ìµœì„ ì…ë‹ˆë‹¤. ë³¸ ë³´ê³ ì„œ ì „ë°˜ì— ê±¸ì¹œ ì „ëµì„ ì¢…í•© ì´í–‰í•¨ìœ¼ë¡œì¨ ìœ„ê¸° ë°œìƒ ê°€ëŠ¥ì„± ìì²´ë¥¼ ë‚®ì¶”ëŠ” ê²ƒì´ ê¶ê·¹ì ì¸ ëª©í‘œì…ë‹ˆë‹¤.`
    ])}
  </div>`;
}

/* â”€â”€ ë ˆì´ë” ì°¨íŠ¸ â”€â”€ */
function renderRadar(target, col, candidates) {
  const ctx = document.getElementById('stratRadar');
  if (!ctx) return;
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: METRICS.map(m => METRIC_LABELS[m]),
      datasets: [
        {
          label: target.name,
          data: METRICS.map(m => target.metrics?.[m]??0),
          borderColor: col.border,
          backgroundColor: col.bg,
          borderWidth: 3,
          pointRadius: 4,
          pointBackgroundColor: col.border,
        },
        ...candidates.filter(c => c !== target).map((c,i) => {
          const oc = CANDIDATE_COLORS[(candidates.indexOf(c)) % 5];
          return {
            label: c.name,
            data: METRICS.map(m => c.metrics?.[m]??0),
            borderColor: oc.border + '80',
            backgroundColor: 'transparent',
            borderWidth: 1.5,
            pointRadius: 2,
            borderDash: [4,3],
            pointBackgroundColor: oc.border,
          };
        })
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      scales: {
        r: {
          min: 50, max: 100,
          ticks: { stepSize: 10, font: { size: 9 } },
          pointLabels: { font: { size: 10, weight: '600' } },
          grid: { color: '#e2e8f0' }
        }
      },
      plugins: {
        legend: { position: 'bottom', labels: { font: { size: 11 }, padding: 10 } }
      }
    }
  });
}

/* â”€â”€ í‘œì§€ show/hide í—¬í¼ â”€â”€ */
const _cover = document.getElementById('sc-print-cover');

function _showCover() {
  if (!_cover) return;
  _cover.style.display      = 'flex';
  _cover.style.flexDirection = 'column';
  _cover.style.minHeight    = '95vh';
  _cover.style.pageBreakAfter = 'always';
  _cover.style.breakAfter   = 'page';
}
function _hideCover() {
  if (_cover) _cover.style.display = 'none';
}

// beforeprint / afterprint ì´ë²¤íŠ¸ (Ctrl+P ë“± ì§ì ‘ ì¸ì‡„ ì‹œì—ë„ ì‘ë™)
window.addEventListener('beforeprint', _showCover);
window.addEventListener('afterprint',  _hideCover);

/* â”€â”€ PDF ì €ì¥ â”€â”€ */
async function printStrategy() {
  // í˜„ì¬ ì„ íƒëœ í›„ë³´ ì´ë¦„ì„ íŒŒì¼ëª…ì— ë°˜ì˜
  const candidateName = _stratData?.candidates?.[_activeIdx]?.name || 'í›„ë³´';
  const origTitle = document.title;
  document.title = `${candidateName}_ë‹¹ì„ ì „ëµë³´ê³ ì„œ`;
  // 1) ìº”ë²„ìŠ¤ â†’ ì´ë¯¸ì§€ ë³€í™˜ (ì°¨íŠ¸ ì¸ì‡„ìš©)
  const canvases = Array.from(document.querySelectorAll('canvas'));
  const replacements = [];
  for (const canvas of canvases) {
    const rect = canvas.getBoundingClientRect();
    const img = document.createElement('img');
    img.src = canvas.toDataURL('image/png', 1.0);
    img.style.cssText = `width:100%;height:${rect.height}px;display:block;object-fit:contain`;
    replacements.push({ canvas, img, parent: canvas.parentNode });
    canvas.parentNode.replaceChild(img, canvas);
  }
  // 2) í‘œì§€ í‘œì‹œ
  _showCover();
  await new Promise(r => setTimeout(r, 300));
  // 3) ì¸ì‡„
  window.print();
  document.title = origTitle;
  // 4) ë³µì› (afterprint ì´ë²¤íŠ¸ê°€ ë°œí™”í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì € ëŒ€ë¹„)
  setTimeout(() => {
    _hideCover();
    replacements.forEach(({ img, canvas, parent }) => {
      try { if (img.parentNode === parent) parent.replaceChild(canvas, img); } catch(e) {}
    });
  }, 1500);
}
</script>
</body>
</html>
