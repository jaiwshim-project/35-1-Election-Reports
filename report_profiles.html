<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>í›„ë³´ í”„ë¡œíŒŒì¼ Â· ElectionAI</title>
<link rel="stylesheet" href="css/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
.profile-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px,1fr)); gap: 24px; }
.profile-card { background: white; border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); border: 1px solid var(--border); }
.profile-card-header { padding: 20px 24px 16px; color: white; }
.profile-card-header .rank-badge {
  background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.5);
  width: 32px; height: 32px; border-radius: 50%; display: inline-flex;
  align-items: center; justify-content: center; font-weight: 900; font-size: 14px; margin-bottom: 10px;
}
.profile-card-header h2 { font-size: 22px; font-weight: 900; margin-bottom: 2px; }
.profile-card-header .party { opacity: .85; font-size: 13px; }
.profile-card-header .score-row { display: flex; align-items: baseline; gap: 8px; margin-top: 10px; }
.profile-card-header .big-score { font-size: 42px; font-weight: 900; }
.profile-card-header .grade { font-size: 14px; opacity: .85; }
.profile-card-body { padding: 20px 24px; }

.info-row { display: flex; gap: 8px; margin-bottom: 8px; font-size: 13px; }
.info-label { color: var(--text-muted); width: 56px; flex-shrink: 0; }
.info-value { color: var(--text); flex: 1; }

.divider { border: none; border-top: 1px solid var(--border); margin: 14px 0; }

.mini-chart-wrap { height: 200px; margin-bottom: 14px; }

.kw-section { margin-bottom: 12px; }
.kw-title { font-size: 12px; font-weight: 700; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: .5px; }

.summary-text { font-size: 13px; line-height: 1.7; color: var(--text-muted); }

/* íƒ­ */
.tab-bar { display: flex; gap: 4px; margin-bottom: 20px; background: #f1f5f9; padding: 4px; border-radius: var(--radius-sm); }
.tab-btn {
  flex: 1; padding: 8px 12px; border: none; background: none; cursor: pointer;
  font-family: inherit; font-size: 13px; font-weight: 600; color: var(--text-muted);
  border-radius: 6px; transition: all 0.2s;
}
.tab-btn.active { background: white; color: var(--primary); box-shadow: 0 1px 4px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<header class="app-header">
  <div class="header-inner">
    <div class="header-logo">âš–ï¸ Election<span>AI</span></div>
    <div class="header-subtitle">AI ê¸°ë°˜ ì„ ê±° í›„ë³´ì ë¹„êµ ë¶„ì„ í”Œë«í¼</div>
    <div class="header-date" id="header-date"></div>
  </div>
</header>
<nav class="main-nav"><div class="nav-inner" id="main-nav"></div></nav>

<div class="page-container">
  <div class="page-title">
    <h1>ğŸ‘¤ í›„ë³´ì í”„ë¡œíŒŒì¼</h1>
    <p>í›„ë³´ìë³„ ìƒì„¸ í‰ê°€ í”„ë¡œíŒŒì¼ ë° ê°•ì Â·ì•½ì  ë¶„ì„</p>
  </div>
  <div id="page-content"></div>
</div>

<button class="print-btn" onclick="window.open('report_full.html','_blank')" title="ì „ì²´ PDF ë³´ê³ ì„œ">ğŸ“¥</button>

<script src="js/shared.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const data = requireData();
  if (!data) return;

  const { candidates } = data;
  const totalRanks = calcTotalRankings(candidates);
  let html = '';

  // â”€â”€ í”„ë¡œíŒŒì¼ ì¹´ë“œ ê·¸ë¦¬ë“œ â”€â”€
  html += `<div class="profile-grid">`;
  candidates.forEach((c, i) => {
    const col = CANDIDATE_COLORS[i % 5];
    const rank = totalRanks[i];
    const g = scoreGrade(c.total_score);
    const scores = METRICS.map(m => c.metrics?.[m] ?? 0);
    const avgMetric = scores.reduce((a,b)=>a+b,0)/scores.length;
    const topMetrics = METRICS.map(m => ({ m, s: c.metrics?.[m]??0 })).sort((a,b)=>b.s-a.s).slice(0,3);
    const botMetrics = METRICS.map(m => ({ m, s: c.metrics?.[m]??0 })).sort((a,b)=>a.s-b.s).slice(0,3);

    html += `
    <div class="profile-card">
      <div class="profile-card-header" style="background:linear-gradient(135deg,${col.border}dd,${col.border})">
        <div class="rank-badge">${rank}</div>
        <h2>${c.name}</h2>
        <div class="party">${c.party} Â· ${c.position || ''}</div>
        <div class="score-row">
          <div class="big-score">${c.total_score}</div>
          <div class="grade">ì  Â· ${g.label}ë“±ê¸‰ (${g.desc})</div>
        </div>
      </div>
      <div class="profile-card-body">

        <!-- ê¸°ë³¸ ì •ë³´ -->
        ${c.education ? `<div class="info-row"><span class="info-label">í•™ë ¥</span><span class="info-value">${c.education}</span></div>` : ''}
        ${c.career ? `<div class="info-row"><span class="info-label">ê²½ë ¥</span><span class="info-value">${c.career}</span></div>` : ''}

        <hr class="divider">

        <!-- ë¯¸ë‹ˆ ë ˆì´ë” ì°¨íŠ¸ -->
        <div class="mini-chart-wrap">
          <canvas id="radar_${i}"></canvas>
        </div>

        <!-- í‰ê·  ì§€í‘œ ì ìˆ˜ -->
        <div style="text-align:center;margin-bottom:12px;font-size:12px;color:var(--text-muted)">
          10ê°œ í•­ëª© í‰ê· : <strong style="color:${col.border};font-size:14px">${avgMetric.toFixed(1)}ì </strong>
        </div>

        <hr class="divider">

        <!-- ê°•ì  -->
        <div class="kw-section">
          <div class="kw-title">âœ… ê°•ì  í•­ëª©</div>
          <div class="tag-list">
            ${topMetrics.map(x => `<span class="tag tag-strength">${METRIC_LABELS[x.m]} ${x.s}</span>`).join('')}
            ${(c.strengths||[]).map(s => `<span class="tag tag-strength">${s}</span>`).join('')}
          </div>
        </div>

        <!-- ì•½ì  -->
        <div class="kw-section">
          <div class="kw-title">âš ï¸ ê°œì„  í•„ìš” í•­ëª©</div>
          <div class="tag-list">
            ${botMetrics.map(x => `<span class="tag tag-weakness">${METRIC_LABELS[x.m]} ${x.s}</span>`).join('')}
            ${(c.weaknesses||[]).map(s => `<span class="tag tag-weakness">${s}</span>`).join('')}
          </div>
        </div>

        <!-- ìš”ì•½ -->
        ${c.summary ? `<hr class="divider"><p class="summary-text">${c.summary}</p>` : ''}

        <!-- AI ì ìˆ˜ -->
        <hr class="divider">
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;text-align:center">
          ${AI_MODELS.map(m => `
            <div style="background:#f8fafc;border-radius:var(--radius-sm);padding:6px 4px">
              <div style="font-size:10px;color:var(--text-muted);font-weight:600">${AI_LABELS[m]}</div>
              <div style="font-size:15px;font-weight:800;color:${col.border}">${c.ai_scores?.[m] ?? '-'}</div>
            </div>`).join('')}
        </div>

      </div>
    </div>`;
  });

  html += `</div>`;

  // â”€â”€ í•­ëª©ë³„ ìµœê³ /ìµœì € â”€â”€
  html += `<div class="card" style="margin-top:24px">
    <div class="card-title">ğŸ“Š 10ê°œ í•­ëª© ê°œì¸ë³„ ë¹„êµ ë¶„ì„</div>
    <div class="table-wrap"><table>
      <thead><tr><th>í•­ëª©</th>`;
  candidates.forEach((c,i) => {
    html += `<th style="color:${CANDIDATE_COLORS[i%5].border}">${c.name}</th>`;
  });
  html += `<th>í•­ëª© í‰ê· </th></tr></thead><tbody>`;

  METRICS.forEach(m => {
    const scores = candidates.map(c => c.metrics?.[m] ?? 0);
    const avg = scores.reduce((a,b)=>a+b,0)/scores.length;
    const max = Math.max(...scores);
    html += `<tr><td><strong>${METRIC_LABELS[m]}</strong></td>`;
    scores.forEach((s,i) => {
      const col = CANDIDATE_COLORS[i%5];
      const isMax = s === max;
      html += `<td style="${isMax?`color:${col.border};font-weight:800`:''}">${s}${isMax?' ğŸ†':''}</td>`;
    });
    html += `<td style="color:var(--text-muted)">${avg.toFixed(1)}</td></tr>`;
  });
  html += `</tbody></table></div></div>`;

  document.getElementById('page-content').innerHTML = html;

  // â”€â”€ ë¯¸ë‹ˆ ë ˆì´ë” ì°¨íŠ¸ ë Œë”ë§ â”€â”€
  candidates.forEach((c, i) => {
    const col = CANDIDATE_COLORS[i % 5];
    new Chart(document.getElementById(`radar_${i}`), {
      type: 'radar',
      data: {
        labels: METRICS.map(m => METRIC_LABELS[m]),
        datasets: [{
          label: c.name,
          data: METRICS.map(m => c.metrics?.[m] ?? 0),
          borderColor: col.border,
          backgroundColor: col.bg,
          borderWidth: 2,
          pointRadius: 3,
          pointBackgroundColor: col.border,
        }]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        scales: {
          r: {
            min: 40, max: 100, ticks: { display: false },
            pointLabels: { font: { size: 10 } },
            grid: { color: '#e2e8f0' }
          }
        },
        plugins: { legend: { display: false } }
      }
    });
  });
});
</script>
</body>
</html>
