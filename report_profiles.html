<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>í›„ë³´ í”„ë¡œíŒŒì¼ Â· ElectionAI</title>
<link rel="stylesheet" href="css/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
.profile-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px,1fr)); gap: 24px; }
.profile-card { background: white; border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); border: 1px solid var(--border); }
.profile-card-header { padding: 20px 24px 16px; color: white; }
.profile-card-header .rank-badge {
  background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.5);
  width: 32px; height: 32px; border-radius: 50%; display: inline-flex;
  align-items: center; justify-content: center; font-weight: 900; font-size: 14px; margin-bottom: 10px;
}
.profile-card-header h2 { font-size: 22px; font-weight: 900; margin-bottom: 2px; }
.profile-card-header .party { opacity: .85; font-size: 13px; }
.profile-card-header .score-row { display: flex; align-items: baseline; gap: 8px; margin-top: 10px; }
.profile-card-header .big-score { font-size: 42px; font-weight: 900; }
.profile-card-header .grade { font-size: 14px; opacity: .85; }
.profile-card-body { padding: 20px 24px; }

.info-row { display: flex; gap: 8px; margin-bottom: 8px; font-size: 13px; }
.info-label { color: var(--text-muted); width: 56px; flex-shrink: 0; }
.info-value { color: var(--text); flex: 1; }

.divider { border: none; border-top: 1px solid var(--border); margin: 14px 0; }

.mini-chart-wrap { height: 200px; margin-bottom: 14px; }

.kw-section { margin-bottom: 12px; }
.kw-title { font-size: 12px; font-weight: 700; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: .5px; }

.summary-text { font-size: 13px; line-height: 1.7; color: var(--text-muted); }

/* íƒ­ */
.tab-bar { display: flex; gap: 4px; margin-bottom: 20px; background: #f1f5f9; padding: 4px; border-radius: var(--radius-sm); }
.tab-btn {
  flex: 1; padding: 8px 12px; border: none; background: none; cursor: pointer;
  font-family: inherit; font-size: 13px; font-weight: 600; color: var(--text-muted);
  border-radius: 6px; transition: all 0.2s;
}
.tab-btn.active { background: white; color: var(--primary); box-shadow: 0 1px 4px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<header class="app-header">
  <div class="header-inner">
    <div class="header-logo">âš–ï¸ Election<span>AI</span></div>
    <div class="header-subtitle">AI ê¸°ë°˜ ì„ ê±° í›„ë³´ì ë¹„êµ ë¶„ì„ í”Œë«í¼</div>
    <div class="header-date" id="header-date"></div>
  </div>
</header>
<nav class="main-nav"><div class="nav-inner" id="main-nav"></div></nav>

<div class="page-container">
  <div class="page-title">
    <h1>ğŸ‘¤ í›„ë³´ì í”„ë¡œíŒŒì¼</h1>
    <p>í›„ë³´ìë³„ ìƒì„¸ í‰ê°€ í”„ë¡œíŒŒì¼ ë° ê°•ì Â·ì•½ì  ë¶„ì„</p>
  </div>
  <div id="page-content"></div>
</div>

<button class="print-btn" onclick="window.open('report_full.html','_blank')" title="ì „ì²´ PDF ë³´ê³ ì„œ">ğŸ“¥</button>

<script src="js/shared.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const data = requireData();
  if (!data) return;

  const { candidates } = data;
  const totalRanks = calcTotalRankings(candidates);
  let html = '';

  // â”€â”€ í”„ë¡œíŒŒì¼ ì¹´ë“œ ê·¸ë¦¬ë“œ â”€â”€
  html += `<div class="profile-grid">`;
  candidates.forEach((c, i) => {
    const col = CANDIDATE_COLORS[i % 5];
    const rank = totalRanks[i];
    const g = scoreGrade(c.total_score);
    const scores = METRICS.map(m => c.metrics?.[m] ?? 0);
    const avgMetric = scores.reduce((a,b)=>a+b,0)/scores.length;
    const topMetrics = METRICS.map(m => ({ m, s: c.metrics?.[m]??0 })).sort((a,b)=>b.s-a.s).slice(0,3);
    const botMetrics = METRICS.map(m => ({ m, s: c.metrics?.[m]??0 })).sort((a,b)=>a.s-b.s).slice(0,3);

    html += `
    <div class="profile-card">
      <div class="profile-card-header" style="background:linear-gradient(135deg,${col.border}dd,${col.border})">
        <div class="rank-badge">${rank}</div>
        <h2>${c.name}</h2>
        <div class="party">${c.party} Â· ${c.position || ''}</div>
        <div class="score-row">
          <div class="big-score">${c.total_score}</div>
          <div class="grade">ì  Â· ${g.label}ë“±ê¸‰ (${g.desc})</div>
        </div>
      </div>
      <div class="profile-card-body">

        <!-- ê¸°ë³¸ ì •ë³´ -->
        ${c.education ? `<div class="info-row"><span class="info-label">í•™ë ¥</span><span class="info-value">${c.education}</span></div>` : ''}
        ${c.career ? `<div class="info-row"><span class="info-label">ê²½ë ¥</span><span class="info-value">${c.career}</span></div>` : ''}

        <hr class="divider">

        <!-- ë¯¸ë‹ˆ ë ˆì´ë” ì°¨íŠ¸ -->
        <div class="mini-chart-wrap">
          <canvas id="radar_${i}"></canvas>
        </div>

        <!-- í‰ê·  ì§€í‘œ ì ìˆ˜ -->
        <div style="text-align:center;margin-bottom:12px;font-size:12px;color:var(--text-muted)">
          10ê°œ í•­ëª© í‰ê· : <strong style="color:${col.border};font-size:14px">${avgMetric.toFixed(1)}ì </strong>
        </div>

        <hr class="divider">

        <!-- ê°•ì  -->
        <div class="kw-section">
          <div class="kw-title">âœ… ê°•ì  í•­ëª©</div>
          <div class="tag-list">
            ${topMetrics.map(x => `<span class="tag tag-strength">${METRIC_LABELS[x.m]} ${x.s}</span>`).join('')}
            ${(c.strengths||[]).map(s => `<span class="tag tag-strength">${s}</span>`).join('')}
          </div>
        </div>

        <!-- ì•½ì  -->
        <div class="kw-section">
          <div class="kw-title">âš ï¸ ê°œì„  í•„ìš” í•­ëª©</div>
          <div class="tag-list">
            ${botMetrics.map(x => `<span class="tag tag-weakness">${METRIC_LABELS[x.m]} ${x.s}</span>`).join('')}
            ${(c.weaknesses||[]).map(s => `<span class="tag tag-weakness">${s}</span>`).join('')}
          </div>
        </div>

        <!-- ìš”ì•½ -->
        ${c.summary ? `<hr class="divider"><p class="summary-text">${c.summary}</p>` : ''}

        <!-- AI ì ìˆ˜ -->
        <hr class="divider">
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;text-align:center">
          ${AI_MODELS.map(m => `
            <div style="background:#f8fafc;border-radius:var(--radius-sm);padding:6px 4px">
              <div style="font-size:10px;color:var(--text-muted);font-weight:600">${AI_LABELS[m]}</div>
              <div style="font-size:15px;font-weight:800;color:${col.border}">${c.ai_scores?.[m] ?? '-'}</div>
            </div>`).join('')}
        </div>

      </div>
    </div>`;
  });

  html += `</div>`;

  // â”€â”€ í”„ë¡œíŒŒì¼ ì¹´ë“œ ì¢…í•© ì„¤ëª… â”€â”€
  {
    const totalRanksArr = [...candidates].map((c,i)=>({...c,i})).sort((a,b)=>b.total_score-a.total_score);
    const top = totalRanksArr[0];
    const topCol = CANDIDATE_COLORS[top.i%5];
    const topMetrics = METRICS.map(m=>({m,s:top.metrics?.[m]??0})).sort((a,b)=>b.s-a.s).slice(0,3);
    const avgAll = Math.round(candidates.reduce((a,c)=>a+c.total_score,0)/candidates.length);
    const aboveAvg = candidates.filter(c=>c.total_score>=avgAll).map(c=>c.name);
    html += summaryBox('í›„ë³´ì í”„ë¡œíŒŒì¼ ì¢…í•© ì„¤ëª…', [
      `ê° í›„ë³´ì í”„ë¡œíŒŒì¼ ì¹´ë“œëŠ” ì¢…í•© ì ìˆ˜, AI ëª¨ë¸ë³„ ì ìˆ˜, 10ê°œ í•­ëª© ë ˆì´ë” ì°¨íŠ¸, ê°•ì Â·ì•½ì  í‚¤ì›Œë“œë¥¼ í†µí•©ì ìœ¼ë¡œ ì œì‹œí•©ë‹ˆë‹¤. <strong>${top.name}</strong>(${top.party})ì´(ê°€) <strong>${top.total_score}ì </strong>ìœ¼ë¡œ 1ìœ„ë¥¼ ê¸°ë¡í–ˆìœ¼ë©°, íŠ¹íˆ <strong>${topMetrics.map(x=>METRIC_LABELS[x.m]).join(', ')}</strong> í•­ëª©ì—ì„œ ë‘ë“œëŸ¬ì§„ ì—­ëŸ‰ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.`,
      `ì „ì²´ í›„ë³´ í‰ê·  ì ìˆ˜ì¸ <strong>${avgAll}ì </strong> ì´ìƒì„ ê¸°ë¡í•œ í›„ë³´ëŠ” <strong>${aboveAvg.join(', ')}</strong>ì…ë‹ˆë‹¤. ê° í›„ë³´ì˜ ë¯¸ë‹ˆ ë ˆì´ë” ì°¨íŠ¸ì—ì„œëŠ” ê°œì¸ë³„ë¡œ ê°•ì¡°ë˜ëŠ” ì—­ëŸ‰ê³¼ ê°œì„ ì´ í•„ìš”í•œ ì˜ì—­ì´ ì‹œê°ì ìœ¼ë¡œ êµ¬ë¶„ë˜ì–´, í›„ë³´ì ê°„ ì—­ëŸ‰ êµ¬ì¡°ì˜ ì°¨ì´ë¥¼ ì§ê´€ì ìœ¼ë¡œ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
      `AI ëª¨ë¸ 4ê°œ(Claude, ChatGPT, Gemini, Grok)ê°€ ê°ê° ë¶€ì—¬í•œ ì ìˆ˜ë¥¼ ì¹´ë“œ í•˜ë‹¨ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª¨ë¸ ê°„ ì ìˆ˜ ì°¨ì´ê°€ í° í›„ë³´ëŠ” í‰ê°€ ê¸°ì¤€ì— ë”°ë¼ íŒë‹¨ì´ ê°ˆë¦¬ëŠ” 'ë…¼ìŸì  í”„ë¡œíŒŒì¼'ì„ ê°€ì§€ë©°, ì ìˆ˜ ì°¨ì´ê°€ ì‘ì€ í›„ë³´ëŠ” AI ëª¨ë¸ ì „ì²´ì— ê±¸ì³ ì¼ê´€ì ìœ¼ë¡œ í‰ê°€ë˜ëŠ” 'ì•ˆì •ì  í”„ë¡œíŒŒì¼'ì„ ë³´ì…ë‹ˆë‹¤.`,
      `ê°•ì Â·ì•½ì  íƒœê·¸ëŠ” í•´ë‹¹ í›„ë³´ì˜ ê³µê°œëœ í™œë™ ê¸°ë¡ê³¼ AI ë¶„ì„ì„ ê¸°ë°˜ìœ¼ë¡œ ë„ì¶œëœ ê²ƒì…ë‹ˆë‹¤. ê°•ì  í•­ëª©ì€ ìœ ê¶Œì ì†Œí†µì—ì„œ ì ê·¹ì ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ë©”ì‹œì§€ ìì›ì´ ë˜ë©°, ì•½ì  í•­ëª©ì€ ìƒëŒ€ í›„ë³´ì˜ ê³µì„¸ ëŒ€ìƒì´ ë  ìˆ˜ ìˆì–´ ì‚¬ì „ ëŒ€ì‘ ì „ëµ ìˆ˜ë¦½ì´ í•„ìš”í•©ë‹ˆë‹¤.`
    ]);
  }

  // â”€â”€ í•­ëª©ë³„ ìµœê³ /ìµœì € â”€â”€
  html += `<div class="card" style="margin-top:24px">
    <div class="card-title">ğŸ“Š 10ê°œ í•­ëª© ê°œì¸ë³„ ë¹„êµ ë¶„ì„</div>
    <div class="table-wrap"><table>
      <thead><tr><th>í•­ëª©</th>`;
  candidates.forEach((c,i) => {
    html += `<th style="color:${CANDIDATE_COLORS[i%5].border}">${c.name}</th>`;
  });
  html += `<th>í•­ëª© í‰ê· </th></tr></thead><tbody>`;

  METRICS.forEach(m => {
    const scores = candidates.map(c => c.metrics?.[m] ?? 0);
    const avg = scores.reduce((a,b)=>a+b,0)/scores.length;
    const max = Math.max(...scores);
    html += `<tr><td><strong>${METRIC_LABELS[m]}</strong></td>`;
    scores.forEach((s,i) => {
      const col = CANDIDATE_COLORS[i%5];
      const isMax = s === max;
      html += `<td style="${isMax?`color:${col.border};font-weight:800`:''}">${s}${isMax?' ğŸ†':''}</td>`;
    });
    html += `<td style="color:var(--text-muted)">${avg.toFixed(1)}</td></tr>`;
  });
  html += `</tbody></table></div></div>`;

  // â”€â”€ êµì°¨ë¶„ì„ ì¢…í•© ì„¤ëª… â”€â”€
  {
    const metricLeaders = METRICS.map(m => {
      const scores = candidates.map((c,i)=>({name:c.name,s:c.metrics?.[m]??0,i}));
      const max = Math.max(...scores.map(x=>x.s));
      return { m, leader: scores.find(x=>x.s===max), max, min: Math.min(...scores.map(x=>x.s)), gap: max - Math.min(...scores.map(x=>x.s)) };
    });
    const topCompetitive = metricLeaders.sort((a,b)=>a.gap-b.gap).slice(0,2);
    const topDominant = [...metricLeaders].sort((a,b)=>b.gap-a.gap).slice(0,2);
    const uniqueLeaders = [...new Set(metricLeaders.map(x=>x.leader.name))];
    html += summaryBox('10ê°œ í•­ëª© ê°œì¸ë³„ êµì°¨ë¶„ì„ ì¢…í•© ì„¤ëª…', [
      `10ê°œ í•­ëª© ê°œì¸ë³„ êµì°¨ë¶„ì„í‘œëŠ” ê° í›„ë³´ì˜ í•­ëª©ë³„ ì ìˆ˜ë¥¼ ë‚˜ë€íˆ ë°°ì¹˜í•˜ì—¬, ì–´ëŠ í•­ëª©ì—ì„œ ëˆ„ê°€ ì•ì„œê³  ë’¤ì²˜ì§€ëŠ”ì§€ë¥¼ ì§ì ‘ ë¹„êµí•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. í•­ëª©ë³„ 1ìœ„ë¥¼ ì°¨ì§€í•˜ëŠ” í›„ë³´ê°€ ë¶„ì‚°ë˜ì–´ ìˆì„ìˆ˜ë¡ ì„ ê±° ê²½ìŸ êµ¬ë„ê°€ ë‹¤ì›í™”ë©ë‹ˆë‹¤. ì´ë²ˆ ë¶„ì„ì—ì„œëŠ” <strong>${uniqueLeaders.join(', ')}</strong>ì´(ê°€) í•­ëª©ë³„ 1ìœ„ë¥¼ ë‚˜ëˆ  ê°€ì¡ŒìŠµë‹ˆë‹¤.`,
      `í•­ëª© ê°„ ê²½ìŸì´ ê°€ì¥ ì¹˜ì—´í•œ êµ¬ê°„ì€ <strong>${topCompetitive.map(x=>METRIC_LABELS[x.m]).join(', ')}</strong>ìœ¼ë¡œ, í›„ë³´ ê°„ ì ìˆ˜ ì°¨ì´ê°€ ${topCompetitive.map(x=>x.gap+'ì ').join(', ')}ì— ë¶ˆê³¼í•©ë‹ˆë‹¤. ì´ í•­ëª©ë“¤ì€ ì„ ê±° ê²°ê³¼ì— ê²°ì •ì  ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆëŠ” 'ìŠ¹ë¶€ì²˜'ë¡œ, í•´ë‹¹ í•­ëª©ì—ì„œì˜ ì¸ìƒì ì¸ ê³µì•½ ì´í–‰ ë˜ëŠ” ì´ë¯¸ì§€ ê°œì„ ì´ ì „ì²´ ìˆœìœ„ë¥¼ ë’¤í”ë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
      `ë°˜ëŒ€ë¡œ <strong>${topDominant.map(x=>METRIC_LABELS[x.m]).join(', ')}</strong> í•­ëª©ì—ì„œëŠ” í›„ë³´ ê°„ ê²©ì°¨ê°€ ${topDominant.map(x=>x.gap+'ì ').join(', ')}ìœ¼ë¡œ íŠ¹ì • í›„ë³´ì˜ ìš°ìœ„ê°€ ëšœë ·í•©ë‹ˆë‹¤. ì´ í•­ëª©ë“¤ì€ ë¦¬ë” í›„ë³´ì˜ í•µì‹¬ ì°¨ë³„í™” ìì‚°ì´ ë˜ë©°, ë‚˜ë¨¸ì§€ í›„ë³´ë“¤ì—ê²ŒëŠ” ì¥ê¸°ì  ì—­ì „ì„ ìœ„í•´ ì§‘ì¤‘ ê³µëµì´ í•„ìš”í•œ ì˜ì—­ì…ë‹ˆë‹¤.`,
      `í•­ëª© í‰ê· ê°’ê³¼ ê°œì¸ ì ìˆ˜ë¥¼ ëŒ€ì¡°í•˜ë©´ ì „ì²´ ìˆ˜ì¤€ ëŒ€ë¹„ ê° í›„ë³´ì˜ ìƒëŒ€ì  ìœ„ì¹˜ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•­ëª© í‰ê·  ì´ìƒì„ ì§€ì†ì ìœ¼ë¡œ ìœ ì§€í•˜ëŠ” í›„ë³´ëŠ” ì „ëµì  ì•ˆì •ì„±ì´ ë†’ê³ , íŠ¹ì • í•­ëª©ì—ì„œë§Œ í‰ê· ì„ ìƒíšŒí•˜ëŠ” í›„ë³´ëŠ” í•´ë‹¹ ì—­ëŸ‰ì„ ì§‘ì¤‘ í™ë³´í•˜ëŠ” 'ì„ íƒê³¼ ì§‘ì¤‘' ì „ëµì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.`
    ]);
  }

  document.getElementById('page-content').innerHTML = html;

  // â”€â”€ ë¯¸ë‹ˆ ë ˆì´ë” ì°¨íŠ¸ ë Œë”ë§ â”€â”€
  candidates.forEach((c, i) => {
    const col = CANDIDATE_COLORS[i % 5];
    new Chart(document.getElementById(`radar_${i}`), {
      type: 'radar',
      data: {
        labels: METRICS.map(m => METRIC_LABELS[m]),
        datasets: [{
          label: c.name,
          data: METRICS.map(m => c.metrics?.[m] ?? 0),
          borderColor: col.border,
          backgroundColor: col.bg,
          borderWidth: 2,
          pointRadius: 3,
          pointBackgroundColor: col.border,
        }]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        scales: {
          r: {
            min: 40, max: 100, ticks: { display: false },
            pointLabels: { font: { size: 10 } },
            grid: { color: '#e2e8f0' }
          }
        },
        plugins: { legend: { display: false } }
      }
    });
  });
});
</script>
</body>
</html>
