<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ì ìˆ˜ ìƒì„¸ Â· ElectionAI</title>
<link rel="stylesheet" href="css/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
.heatmap-cell {
  font-weight: 700; font-size: 13px;
  padding: 10px 14px !important;
  transition: all 0.2s;
}
.metric-section { margin-bottom: 28px; }
.metric-title {
  font-size: 15px; font-weight: 700; color: var(--primary-dark);
  margin-bottom: 10px; display: flex; align-items: center; gap: 8px;
}
.metric-bar-row { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
.metric-bar-name { width: 80px; font-size: 13px; font-weight: 600; flex-shrink: 0; }
.metric-bar-wrap { flex: 1; }
.metric-bar-score { width: 36px; text-align: right; font-size: 13px; font-weight: 700; }
.avg-line { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
</style>
</head>
<body>

<header class="app-header">
  <div class="header-inner">
    <div class="header-logo">âš–ï¸ Election<span>AI</span></div>
    <div class="header-subtitle">AI ê¸°ë°˜ ì„ ê±° í›„ë³´ì ë¹„êµ ë¶„ì„ í”Œë«í¼</div>
    <div class="header-date" id="header-date"></div>
  </div>
</header>
<nav class="main-nav"><div class="nav-inner" id="main-nav"></div></nav>

<div class="page-container">
  <div class="page-title">
    <h1>ğŸ“ˆ 10ê°œ í•­ëª© ìƒì„¸ ì ìˆ˜</h1>
    <p>í•­ëª©ë³„ í›„ë³´ì ì ìˆ˜ ë¹„êµ ë° ì—´ì§€ë„ ë¶„ì„</p>
  </div>
  <div id="page-content"></div>
</div>

<button class="print-btn" onclick="window.open('report_full.html','_blank')" title="ì „ì²´ PDF ë³´ê³ ì„œ">ğŸ“¥</button>

<script src="js/shared.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const data = requireData();
  if (!data) return;

  const { candidates } = data;
  const n = candidates.length;
  let html = '';

  // â”€â”€ íˆíŠ¸ë§µ í…Œì´ë¸” â”€â”€
  html += `<div class="card">
    <div class="card-title">ğŸ”¥ ì ìˆ˜ íˆíŠ¸ë§µ (í•­ëª© Ã— í›„ë³´ì)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>í‰ê°€ í•­ëª©</th>`;
  candidates.forEach((c,i) => {
    html += `<th style="color:${CANDIDATE_COLORS[i%5].border}">${c.name}</th>`;
  });
  html += `<th>í‰ê· </th><th>ìµœê³ </th><th>ìµœì €</th></tr></thead><tbody>`;

  METRICS.forEach(m => {
    const scores = candidates.map(c => c.metrics?.[m] ?? 0);
    const avg = scores.reduce((a,b)=>a+b,0)/n;
    const max = Math.max(...scores);
    const min = Math.min(...scores);
    html += `<tr><td><strong>${METRIC_LABELS[m]}</strong></td>`;
    scores.forEach((s,i) => {
      // ì ìˆ˜ì— ë”°ë¥¸ ë°°ê²½ìƒ‰ ê³„ì‚°
      const ratio = (s - 50) / 50; // 50~100 ë²”ìœ„ë¥¼ 0~1ë¡œ ì •ê·œí™”
      const col = CANDIDATE_COLORS[i%5];
      const isMax = s === max;
      const isMin = s === min;
      const bg = isMax ? col.light : isMin ? '#fff7ed' : '';
      const fw = isMax || isMin ? 'font-weight:800;' : '';
      html += `<td class="heatmap-cell" style="background:${bg};${fw}">${s}${isMax?'â–²':isMin?'â–¼':''}</td>`;
    });
    html += `<td style="color:var(--text-muted)">${avg.toFixed(1)}</td>
      <td style="color:var(--success);font-weight:700">${max}</td>
      <td style="color:var(--danger);font-weight:700">${min}</td></tr>`;
  });

  // ì¢…í•© í–‰
  html += `<tr style="background:#f8fafc;border-top:2px solid var(--border)">
    <td><strong>ì¢…í•© ì ìˆ˜ (AI)</strong></td>`;
  candidates.forEach(c => {
    html += `<td style="font-weight:800;font-size:14px">${c.total_score || '-'}</td>`;
  });
  html += `<td colspan="3"></td></tr>`;

  html += `</tbody></table></div>
    <div class="insight-box">â–² í•´ë‹¹ í•­ëª© ìµœê³  ì ìˆ˜ &nbsp;|&nbsp; â–¼ í•´ë‹¹ í•­ëª© ìµœì € ì ìˆ˜</div>
  </div>`;

  // â”€â”€ ê·¸ë£¹ ë§‰ëŒ€ ì°¨íŠ¸ â”€â”€
  html += `<div class="card"><div class="card-title">ğŸ“Š í•­ëª©ë³„ ê·¸ë£¹ ë§‰ëŒ€ê·¸ë˜í”„</div>
    <div class="chart-container" style="height:420px">
      <canvas id="groupedBar"></canvas>
    </div></div>`;

  // â”€â”€ í•­ëª©ë³„ ë°” ì°¨íŠ¸ (í›„ë³´ ë¹„êµ) â”€â”€
  html += `<div class="card"><div class="card-title">ğŸ“‹ í•­ëª©ë³„ í›„ë³´ì ì ìˆ˜ ìƒì„¸</div>`;
  METRICS.forEach(m => {
    const scores = candidates.map(c => c.metrics?.[m] ?? 0);
    const avg = scores.reduce((a,b)=>a+b,0)/n;
    html += `<div class="metric-section">
      <div class="metric-title">${METRIC_LABELS[m]}</div>`;
    candidates.forEach((c,i) => {
      const s = c.metrics?.[m] ?? 0;
      const col = CANDIDATE_COLORS[i%5];
      html += `<div class="metric-bar-row">
        <div class="metric-bar-name" style="color:${col.border}">${c.name}</div>
        <div class="metric-bar-wrap">
          <div class="progress-bar"><div class="progress-fill" style="width:${s}%;background:${col.border}"></div></div>
        </div>
        <div class="metric-bar-score" style="color:${col.border}">${s}</div>
      </div>`;
    });
    html += `<div class="avg-line">í•­ëª© í‰ê· : ${avg.toFixed(1)}ì </div></div>`;
  });
  html += `</div>`;

  // â”€â”€ í‘œì¤€í¸ì°¨ ë¶„ì„ â”€â”€
  html += `<div class="card"><div class="card-title">ğŸ“ í•­ëª©ë³„ í¸ì°¨ ë¶„ì„ (ê· í˜•ì„±)</div>
    <div class="table-wrap"><table>
      <thead><tr><th>í›„ë³´ì</th>`;
  METRICS.forEach(m => { html += `<th>${METRIC_LABELS[m].split(' ')[0]}</th>`; });
  html += `<th>í‘œì¤€í¸ì°¨</th><th>ê· í˜•ì„±</th></tr></thead><tbody>`;

  candidates.forEach((c,i) => {
    const scores = METRICS.map(m => c.metrics?.[m] ?? 0);
    const avg = scores.reduce((a,b)=>a+b,0)/scores.length;
    const std = Math.sqrt(scores.reduce((s,v)=>s+Math.pow(v-avg,2),0)/scores.length);
    const col = CANDIDATE_COLORS[i%5];
    html += `<tr><td style="color:${col.border};font-weight:700">${c.name}</td>`;
    scores.forEach(s => { html += `<td>${s}</td>`; });
    html += `<td style="font-weight:700">${std.toFixed(1)}</td>
      <td>${std < 5 ? 'ğŸŸ¢ ê· í˜•' : std < 8 ? 'ğŸŸ¡ ë³´í†µ' : 'ğŸ”´ í¸ì¤‘'}</td></tr>`;
  });
  html += `</tbody></table>
    <div class="insight-box">í‘œì¤€í¸ì°¨ê°€ ë‚®ì„ìˆ˜ë¡ í•­ëª© ê°„ ê· í˜•ì´ ì¡íŒ í›„ë³´ì…ë‹ˆë‹¤. ë†’ì„ìˆ˜ë¡ íŠ¹ì • í•­ëª©ì— í¸ì¤‘ë©ë‹ˆë‹¤.</div>
  </div></div>`;

  document.getElementById('page-content').innerHTML = html;

  // â”€â”€ ê·¸ë£¹ ë§‰ëŒ€ ì°¨íŠ¸ ë Œë”ë§ â”€â”€
  new Chart(document.getElementById('groupedBar'), {
    type: 'bar',
    data: {
      labels: METRICS.map(m => METRIC_LABELS[m]),
      datasets: candidates.map((c,i) => ({
        label: c.name,
        data: METRICS.map(m => c.metrics?.[m] ?? 0),
        backgroundColor: CANDIDATE_COLORS[i%5].bg,
        borderColor: CANDIDATE_COLORS[i%5].border,
        borderWidth: 2,
        borderRadius: 4,
      }))
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      scales: {
        x: { ticks: { font: { size: 11 } }, grid: { display: false } },
        y: { min: 50, max: 100, ticks: { font: { size: 11 } }, grid: { color: '#f1f5f9' } }
      },
      plugins: { legend: { position: 'bottom', labels: { font: { size: 12 }, padding: 16 } } }
    }
  });
});
</script>
</body>
</html>
